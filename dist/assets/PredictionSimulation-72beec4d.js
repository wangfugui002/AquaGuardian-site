import{E as a,_ as ie,r as se,o as R,c as P,a as l,b as W,w as V,t as L,d as ze,e as Ue,f as qe,g as Ne,h as Ze,i as b,k as We,G as $e,m as Je,q as At,s as It,u as H,x as Tt,z as M,p as Q,S as Kt,F as je,A as Ve,C as He,T as B,n as K}from"./index-76b2310c.js";import{_ as Qe}from"./返回 (2)-cc03bce6.js";import{i as ct}from"./index-18acf776.js";const mt=window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest,G=document.documentElement.style.pointerEvents==="",$={cors:mt,pointerEvents:G},Ke={attributionWidthOffset:55};let Xt=0;function ft(t){let e="";t.f=t.f||"json";for(const s in t)if(Object.hasOwn(t,s)){const r=t[s],n=Object.prototype.toString.call(r);let o;e.length&&(e+="&"),n==="[object Array]"?o=Object.prototype.toString.call(r[0])==="[object Object]"?JSON.stringify(r):r.join(","):n==="[object Object]"?o=JSON.stringify(r):n==="[object Date]"?o=r.valueOf():o=r,e+=`${encodeURIComponent(s)}=${encodeURIComponent(o)}`}const i="%27";return e.replaceAll("'",i)}function kt(t,e){const i=new window.XMLHttpRequest;return i.onerror=function(){i.onreadystatechange=a.Util.falseFn,t.call(e,{error:{code:500,message:"XMLHttpRequest error"}},null)},i.onreadystatechange=function(){let s,r;if(i.readyState===4){try{s=JSON.parse(i.responseText)}catch{s=null,r={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!r&&s.error&&(r=s.error,s=null),i.onerror=a.Util.falseFn,t.call(e,r,s)}},i.ontimeout=function(){this.onerror()},i}function Xe(t,e,i,s){const r=kt(i,s);return r.open("POST",t),typeof s<"u"&&s!==null&&typeof s.options<"u"&&(r.timeout=s.options.timeout),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),r.send(ft(e)),r}function re(t,e,i,s){const r=kt(i,s);return r.open("GET",`${t}?${ft(e)}`,!0),typeof s<"u"&&s!==null&&typeof s.options<"u"&&(r.timeout=s.options.timeout,s.options.withCredentials&&(r.withCredentials=!0)),r.send(null),r}function ne(t,e,i,s){const r=ft(e),n=kt(i,s),o=`${t}?${r}`.length;if(o<=2e3&&$.cors?n.open("GET",`${t}?${r}`):o>2e3&&$.cors&&(n.open("POST",t),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")),typeof s<"u"&&s!==null&&typeof s.options<"u"&&(n.timeout=s.options.timeout,s.options.withCredentials&&(n.withCredentials=!0)),o<=2e3&&$.cors)n.send(null);else if(o>2e3&&$.cors)n.send(r);else{if(o<=2e3&&!$.cors)return Mt(t,e,i,s);J(`a request to ${t} was longer then 2000 characters and this browser cannot make a cross-domain post request. Please use a proxy https://developers.arcgis.com/esri-leaflet/api-reference/request/`);return}return n}function Mt(t,e,i,s){window._EsriLeafletCallbacks=window._EsriLeafletCallbacks||{};const r=`c${Xt}`;e.callback=`window._EsriLeafletCallbacks.${r}`,window._EsriLeafletCallbacks[r]=function(o){if(window._EsriLeafletCallbacks[r]!==!0){let h;const d=Object.prototype.toString.call(o);d==="[object Object]"||d==="[object Array]"||(h={error:{code:500,message:"Expected array or object as JSONP response"}},o=null),!h&&o.error&&(h=o,o=null),i.call(s,h,o),window._EsriLeafletCallbacks[r]=!0}};const n=a.DomUtil.create("script",null,document.body);return n.type="text/javascript",n.src=`${t}?${ft(e)}`,n.id=r,n.onerror=function(o){if(o&&window._EsriLeafletCallbacks[r]!==!0){const h={error:{code:500,message:"An unknown error occurred"}};i.call(s,h),window._EsriLeafletCallbacks[r]=!0}},a.DomUtil.addClass(n,"esri-leaflet-jsonp"),Xt++,{id:r,url:n.src,abort(){window._EsriLeafletCallbacks._callback[r]({code:0,message:"Request aborted."})}}}const Et=$.cors?re:Mt;Et.CORS=re;Et.JSONP=Mt;function J(...t){console&&console.warn&&console.warn.apply(console,t)}const dt={request:ne,get:Et,post:Xe};/* @preserve
* @terraformer/arcgis - v2.1.1 - MIT
* Copyright (c) 2012-2022 Environmental Systems Research Institute, Inc.
* Tue Aug 02 2022 14:23:48 GMT-0700 (Pacific Daylight Time)
*/var Ye=function(e,i,s,r){var n=(r[0]-s[0])*(e[1]-s[1])-(r[1]-s[1])*(e[0]-s[0]),o=(i[0]-e[0])*(e[1]-s[1])-(i[1]-e[1])*(e[0]-s[0]),h=(r[1]-s[1])*(i[0]-e[0])-(r[0]-s[0])*(i[1]-e[1]);if(h!==0){var d=n/h,c=o/h;if(d>=0&&d<=1&&c>=0&&c<=1)return!0}return!1},ti=function(e,i){for(var s=!1,r=-1,n=e.length,o=n-1;++r<n;o=r)(e[r][1]<=i[1]&&i[1]<e[o][1]||e[o][1]<=i[1]&&i[1]<e[r][1])&&i[0]<(e[o][0]-e[r][0])*(i[1]-e[r][1])/(e[o][1]-e[r][1])+e[r][0]&&(s=!s);return s},ei=function(e,i){for(var s=0;s<e.length;s++)if(e[s]!==i[s])return!1;return!0},oe=function(e,i){for(var s=0;s<e.length-1;s++)for(var r=0;r<i.length-1;r++)if(Ye(e[s],e[s+1],i[r],i[r+1]))return!0;return!1},Pt=function(e){return ei(e[0],e[e.length-1])||e.push(e[0]),e},Dt=function(e){var i=0,s=0,r=e.length,n=e[s],o;for(s;s<r-1;s++)o=e[s+1],i+=(o[0]-n[0])*(o[1]+n[1]),n=o;return i>=0},ae=function(e){var i={};for(var s in e)e.hasOwnProperty(s)&&(i[s]=e[s]);return i},ii=function(e,i){var s=oe(e,i),r=ti(e,i[0]);return!!(!s&&r)},si=function(e){for(var i=[],s=[],r,n,o,h=0;h<e.length;h++){var d=Pt(e[h].slice(0));if(!(d.length<4))if(Dt(d)){var c=[d.slice().reverse()];i.push(c)}else s.push(d.slice().reverse())}for(var m=[];s.length;){o=s.pop();var w=!1;for(r=i.length-1;r>=0;r--)if(n=i[r][0],ii(n,o)){i[r].push(o),w=!0;break}w||m.push(o)}for(;m.length;){o=m.pop();var D=!1;for(r=i.length-1;r>=0;r--)if(n=i[r][0],oe(n,o)){i[r].push(o),D=!0;break}D||i.push([o.reverse()])}return i.length===1?{type:"Polygon",coordinates:i[0]}:{type:"MultiPolygon",coordinates:i}},ri=function(e,i){for(var s=i?[i,"OBJECTID","FID"]:["OBJECTID","FID"],r=0;r<s.length;r++){var n=s[r];if(n in e&&(typeof e[n]=="string"||typeof e[n]=="number"))return e[n]}throw Error("No valid id attribute found")},ni=function t(e,i){var s={};if(e.features){s.type="FeatureCollection",s.features=[];for(var r=0;r<e.features.length;r++)s.features.push(t(e.features[r],i))}if(typeof e.x=="number"&&typeof e.y=="number"&&(s.type="Point",s.coordinates=[e.x,e.y],typeof e.z=="number"&&s.coordinates.push(e.z)),e.points&&(s.type="MultiPoint",s.coordinates=e.points.slice(0)),e.paths&&(e.paths.length===1?(s.type="LineString",s.coordinates=e.paths[0].slice(0)):(s.type="MultiLineString",s.coordinates=e.paths.slice(0))),e.rings&&(s=si(e.rings.slice(0))),typeof e.xmin=="number"&&typeof e.ymin=="number"&&typeof e.xmax=="number"&&typeof e.ymax=="number"&&(s.type="Polygon",s.coordinates=[[[e.xmax,e.ymax],[e.xmin,e.ymax],[e.xmin,e.ymin],[e.xmax,e.ymin],[e.xmax,e.ymax]]]),(e.geometry||e.attributes)&&(s.type="Feature",s.geometry=e.geometry?t(e.geometry):null,s.properties=e.attributes?ae(e.attributes):null,e.attributes))try{s.id=ri(e.attributes,i)}catch{}return JSON.stringify(s.geometry)===JSON.stringify({})&&(s.geometry=null),e.spatialReference&&e.spatialReference.wkid&&e.spatialReference.wkid!==4326&&console.warn("Object converted in non-standard crs - "+JSON.stringify(e.spatialReference)),s},le=function(e){var i=[],s=e.slice(0),r=Pt(s.shift().slice(0));if(r.length>=4){Dt(r)||r.reverse(),i.push(r);for(var n=0;n<s.length;n++){var o=Pt(s[n].slice(0));o.length>=4&&(Dt(o)&&o.reverse(),i.push(o))}}return i},oi=function(e){for(var i=[],s=0;s<e.length;s++)for(var r=le(e[s]),n=r.length-1;n>=0;n--){var o=r[n].slice(0);i.push(o)}return i},ai=function t(e,i){i=i||"OBJECTID";var s={wkid:4326},r={},n;switch(e.type){case"Point":r.x=e.coordinates[0],r.y=e.coordinates[1],e.coordinates[2]!=null&&(r.z=e.coordinates[2]),r.spatialReference=s;break;case"MultiPoint":r.points=e.coordinates.slice(0),e.coordinates[0][2]!=null&&(r.hasZ=!0),r.spatialReference=s;break;case"LineString":r.paths=[e.coordinates.slice(0)],e.coordinates[0][2]!=null&&(r.hasZ=!0),r.spatialReference=s;break;case"MultiLineString":r.paths=e.coordinates.slice(0),e.coordinates[0][0][2]!=null&&(r.hasZ=!0),r.spatialReference=s;break;case"Polygon":r.rings=le(e.coordinates.slice(0)),e.coordinates[0][0][2]!=null&&(r.hasZ=!0),r.spatialReference=s;break;case"MultiPolygon":r.rings=oi(e.coordinates.slice(0)),e.coordinates[0][0][0][2]!=null&&(r.hasZ=!0),r.spatialReference=s;break;case"Feature":e.geometry&&(r.geometry=t(e.geometry,i)),r.attributes=e.properties?ae(e.properties):{},e.id&&(r.attributes[i]=e.id);break;case"FeatureCollection":for(r=[],n=0;n<e.features.length;n++)r.push(t(e.features[n],i));break;case"GeometryCollection":for(r=[],n=0;n<e.geometries.length;n++)r.push(t(e.geometries[n],i));break}return r};const li='Powered by <a href="https://www.esri.com">Esri</a>';function pt(t,e){return ai(t,e)}function ui(t,e){return ni(t,e)}function Yt(t){if(t.xmin!=="NaN"&&t.ymin!=="NaN"&&t.xmax!=="NaN"&&t.ymax!=="NaN"){const e=a.latLng(t.ymin,t.xmin),i=a.latLng(t.ymax,t.xmax);return a.latLngBounds(e,i)}return null}function ue(t){return t=a.latLngBounds(t),{xmin:t.getSouthWest().lng,ymin:t.getSouthWest().lat,xmax:t.getNorthEast().lng,ymax:t.getNorthEast().lat,spatialReference:{wkid:4326}}}const ce=/^(OBJECTID|FID|OID|ID)$/i;function ci(t){let e;if(t.objectIdFieldName)e=t.objectIdFieldName;else if(t.fields){for(let i=0;i<=t.fields.length-1;i++)if(t.fields[i].type==="esriFieldTypeOID"){e=t.fields[i].name;break}if(!e){for(let i=0;i<=t.fields.length-1;i++)if(t.fields[i].name.match(ce)){e=t.fields[i].name;break}}}return e}function hi(t){for(const e in t.attributes)if(e.match(ce))return e}function yt(t,e){let i;const s=t.features||t.results,r=s&&s.length;e?i=e:i=ci(t);const n={type:"FeatureCollection",features:[]};if(r)for(let o=s.length-1;o>=0;o--){const h=ui(s[o],i||hi(s[o]));n.features.push(h)}return n}function Bt(t){return t=a.Util.trim(t),t[t.length-1]!=="/"&&(t+="/"),t}function gt(t){if(t.url.indexOf("?")!==-1){t.requestParams=t.requestParams||{};const e=t.url.substring(t.url.indexOf("?")+1);t.url=t.url.split("?")[0],t.requestParams=JSON.parse(`{"${decodeURI(e).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')}"}`)}return t.url=Bt(t.url.split("?")[0]),t}function di(t){return/^(?!.*utility\.arcgis\.com).*\.arcgis\.com.*FeatureServer/i.test(t)}function te(t){let e;switch(t){case"Point":e="esriGeometryPoint";break;case"MultiPoint":e="esriGeometryMultipoint";break;case"LineString":e="esriGeometryPolyline";break;case"MultiLineString":e="esriGeometryPolyline";break;case"Polygon":e="esriGeometryPolygon";break;case"MultiPolygon":e="esriGeometryPolygon";break}return e}function Ft(t){return`${t.getSize().x-Ke.attributionWidthOffset}px`}function vt(t){if(t.attributionControl){if(t.attributionControl._esriAttributionLayerCount||(t.attributionControl._esriAttributionLayerCount=0),t.attributionControl._esriAttributionLayerCount===0){if(!t.attributionControl._esriAttributionAddedOnce){const e=document.createElement("style");e.type="text/css",e.innerHTML=".esri-truncated-attribution:hover {white-space: normal;}",document.getElementsByTagName("head")[0].appendChild(e);const i=document.createElement("style");i.type="text/css",i.innerHTML=`.esri-truncated-attribution {vertical-align: -3px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;display: inline-block;transition: 0s white-space;transition-delay: 1s;max-width: ${Ft(t)};}`,document.getElementsByTagName("head")[0].appendChild(i),t.on("resize",s=>{t.attributionControl&&(t.attributionControl._container.style.maxWidth=Ft(s.target))}),t.attributionControl._esriAttributionAddedOnce=!0}a.DomUtil.addClass(t.attributionControl._container,"esri-truncated-attribution:hover"),a.DomUtil.addClass(t.attributionControl._container,"esri-truncated-attribution")}t.attributionControl._esriAttributionLayerCount=t.attributionControl._esriAttributionLayerCount+1}}function pi(){return li}function _t(t){t.attributionControl&&(t.attributionControl._esriAttributionLayerCount&&t.attributionControl._esriAttributionLayerCount===1&&(a.DomUtil.removeClass(t.attributionControl._container,"esri-truncated-attribution:hover"),a.DomUtil.removeClass(t.attributionControl._container,"esri-truncated-attribution")),t.attributionControl._esriAttributionLayerCount=t.attributionControl._esriAttributionLayerCount-1)}function he(t){const e={geometry:null,geometryType:null};if(t instanceof a.LatLngBounds)return e.geometry=ue(t),e.geometryType="esriGeometryEnvelope",e;if(t.getLatLng&&(t=t.getLatLng()),t instanceof a.LatLng&&(t={type:"Point",coordinates:[t.lng,t.lat]}),t instanceof a.GeoJSON&&(t=t.getLayers()[0].feature.geometry,e.geometry=pt(t),e.geometryType=te(t.type)),t.toGeoJSON&&(t=t.toGeoJSON()),t.type==="Feature"&&(t=t.geometry),t.type==="Point"||t.type==="LineString"||t.type==="Polygon"||t.type==="MultiPolygon")return e.geometry=pt(t),e.geometryType=te(t.type),e;J("invalid geometry passed to spatial query. Should be L.LatLng, L.LatLngBounds, L.Marker or a GeoJSON Point, Line, Polygon or MultiPolygon object")}function mi(t,e){$.cors&&ne(t,{},a.Util.bind((i,s)=>{if(i)return;e._esriAttributions=[];for(let n=0;n<s.contributors.length;n++){const o=s.contributors[n];for(let h=0;h<o.coverageAreas.length;h++){const d=o.coverageAreas[h],c=a.latLng(d.bbox[0],d.bbox[1]),m=a.latLng(d.bbox[2],d.bbox[3]);e._esriAttributions.push({attribution:o.attribution,score:d.score,bounds:a.latLngBounds(c,m),minZoom:d.zoomMin,maxZoom:d.zoomMax})}}e._esriAttributions.sort((n,o)=>o.score-n.score),Ot({target:e})},this))}function Ot(t){const e=t.target,i=e._esriAttributions;if(!e||!e.attributionControl)return;const s=e.attributionControl._container.querySelector(".esri-dynamic-attribution");if(s&&i){let r="";const n=e.getBounds(),o=a.latLngBounds(n.getSouthWest().wrap(),n.getNorthEast().wrap()),h=e.getZoom();for(let d=0;d<i.length;d++){const c=i[d],m=c.attribution;!r.match(m)&&c.bounds.intersects(o)&&h>=c.minZoom&&h<=c.maxZoom&&(r+=`, ${m}`)}r=`${pi()} | ${r.substr(2)}`,s.innerHTML=r,s.style.maxWidth=Ft(e),e.fire("attributionupdated",{attribution:r})}}const Gt=a.Class.extend({options:{proxy:!1,useCors:mt},generateSetter(t,e){return a.Util.bind(function(i){return this.params[t]=i,this},e)},initialize(t){if(t.request&&t.options?(this._service=t,a.Util.setOptions(this,t.options)):(a.Util.setOptions(this,t),this.options.url=Bt(t.url)),this.params=a.Util.extend({},this.params||{}),this.setters)for(const e in this.setters){const i=this.setters[e];this[e]=this.generateSetter(i,this)}},token(t){return this._service?this._service.authenticate(t):this.params.token=t,this},apikey(t){return this.token(t)},format(t){return this.params.returnUnformattedValues=!t,this},request(t,e){return this.options.requestParams&&a.Util.extend(this.params,this.options.requestParams),this._service?this._service.request(this.path,this.params,t,e):this._request("request",this.path,this.params,t,e)},_request(t,e,i,s,r){const n=this.options.proxy?`${this.options.proxy}?${this.options.url}${e}`:this.options.url+e;return(t==="get"||t==="request")&&!this.options.useCors?dt.get.JSONP(n,i,s,r):dt[t](n,i,s,r)}}),fi=Gt.extend({setters:{offset:"resultOffset",limit:"resultRecordCount",fields:"outFields",precision:"geometryPrecision",featureIds:"objectIds",returnGeometry:"returnGeometry",returnM:"returnM",transform:"datumTransformation",token:"token"},path:"query",params:{returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*"},within(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelContains",this},intersects(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelIntersects",this},contains(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelWithin",this},crosses(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelCrosses",this},touches(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelTouches",this},overlaps(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelOverlaps",this},bboxIntersects(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelEnvelopeIntersects",this},indexIntersects(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelIndexIntersects",this},nearby(t,e){return t=a.latLng(t),this.params.geometry=[t.lng,t.lat],this.params.geometryType="esriGeometryPoint",this.params.spatialRel="esriSpatialRelIntersects",this.params.units="esriSRUnit_Meter",this.params.distance=e,this.params.inSR=4326,this},where(t){return this.params.where=t,this},between(t,e){return this.params.time=[t.valueOf(),e.valueOf()],this},simplify(t,e){const i=Math.abs(t.getBounds().getWest()-t.getBounds().getEast());return this.params.maxAllowableOffset=i/t.getSize().y*e,this},orderBy(t,e){return e=e||"ASC",this.params.orderByFields=this.params.orderByFields?`${this.params.orderByFields},`:"",this.params.orderByFields+=[t,e].join(" "),this},run(t,e){return this._cleanParams(),this.options.isModern||di(this.options.url)&&this.options.isModern===void 0?(this.params.f="geojson",this.request(function(i,s){this._trapSQLerrors(i),t.call(e,i,s,s)},this)):this.request(function(i,s){this._trapSQLerrors(i),t.call(e,i,s&&yt(s),s)},this)},count(t,e){return this._cleanParams(),this.params.returnCountOnly=!0,this.request(function(i,s){t.call(this,i,s&&s.count,s)},e)},ids(t,e){return this._cleanParams(),this.params.returnIdsOnly=!0,this.request(function(i,s){t.call(this,i,s&&s.objectIds,s)},e)},bounds(t,e){return this._cleanParams(),this.params.returnExtentOnly=!0,this.request((i,s)=>{s&&s.extent&&Yt(s.extent)?t.call(e,i,Yt(s.extent),s):(i={message:"Invalid Bounds"},t.call(e,i,null,s))},e)},distinct(){return this.params.returnGeometry=!1,this.params.returnDistinctValues=!0,this},pixelSize(t){const e=a.point(t);return this.params.pixelSize=[e.x,e.y],this},layer(t){return this.path=`${t}/query`,this},_trapSQLerrors(t){t&&t.code==="400"&&J("one common syntax error in query requests is encasing string values in double quotes instead of single quotes")},_cleanParams(){delete this.params.returnIdsOnly,delete this.params.returnExtentOnly,delete this.params.returnCountOnly},_setGeometryParams(t){this.params.inSR=4326;const e=he(t);this.params.geometry=e.geometry,this.params.geometryType=e.geometryType}});function zt(t){return new fi(t)}const yi=Gt.extend({setters:{contains:"contains",text:"searchText",fields:"searchFields",spatialReference:"sr",sr:"sr",layers:"layers",returnGeometry:"returnGeometry",maxAllowableOffset:"maxAllowableOffset",precision:"geometryPrecision",dynamicLayers:"dynamicLayers",returnZ:"returnZ",returnM:"returnM",gdbVersion:"gdbVersion",token:"token"},path:"find",params:{sr:4326,contains:!0,returnGeometry:!0,returnZ:!0,returnM:!1},layerDefs(t,e){return this.params.layerDefs=this.params.layerDefs?`${this.params.layerDefs};`:"",this.params.layerDefs+=[t,e].join(":"),this},simplify(t,e){const i=Math.abs(t.getBounds().getWest()-t.getBounds().getEast());return this.params.maxAllowableOffset=i/t.getSize().y*e,this},run(t,e){return this.request((i,s)=>{t.call(e,i,s&&yt(s),s)},e)}});function gi(t){return new yi(t)}const de=Gt.extend({path:"identify",between(t,e){return this.params.time=[t.valueOf(),e.valueOf()],this}}),vi=de.extend({setters:{layers:"layers",precision:"geometryPrecision",tolerance:"tolerance",returnGeometry:"returnGeometry"},params:{sr:4326,layers:"all",tolerance:3,returnGeometry:!0},on(t){const e=ue(t.getBounds()),i=t.getSize();return this.params.imageDisplay=[i.x,i.y,96],this.params.mapExtent=[e.xmin,e.ymin,e.xmax,e.ymax],this},at(t){return t.length===2&&(t=a.latLng(t)),this._setGeometryParams(t),this},layerDef(t,e){return this.params.layerDefs=this.params.layerDefs?`${this.params.layerDefs};`:"",this.params.layerDefs+=[t,e].join(":"),this},simplify(t,e){const i=Math.abs(t.getBounds().getWest()-t.getBounds().getEast());return this.params.maxAllowableOffset=i/t.getSize().y*e,this},run(t,e){return this.request((i,s)=>{if(i)t.call(e,i,void 0,s);else{const r=yt(s);s.results=s.results.reverse();for(let n=0;n<r.features.length;n++){const o=r.features[n];o.layerId=s.results[n].layerId}t.call(e,void 0,r,s)}})},_setGeometryParams(t){const e=he(t);this.params.geometry=e.geometry,this.params.geometryType=e.geometryType}});function _i(t){return new vi(t)}const bi=de.extend({setters:{setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setPixelSize:"pixelSize",returnCatalogItems:"returnCatalogItems",returnGeometry:"returnGeometry"},params:{returnGeometry:!1},at(t){return t=a.latLng(t),this.params.geometry=JSON.stringify({x:t.lng,y:t.lat,spatialReference:{wkid:4326}}),this.params.geometryType="esriGeometryPoint",this},getMosaicRule(){return this.params.mosaicRule},getRenderingRule(){return this.params.renderingRule},getPixelSize(){return this.params.pixelSize},run(t,e){return this.request(function(i,s){t.call(e,i,s&&this._responseToGeoJSON(s),s)},this)},_responseToGeoJSON(t){const e=t.location,i=t.catalogItems,s=t.catalogItemVisibilities,r={pixel:{type:"Feature",geometry:{type:"Point",coordinates:[e.x,e.y]},crs:{type:"EPSG",properties:{code:e.spatialReference.wkid}},properties:{OBJECTID:t.objectId,name:t.name,value:t.value},id:t.objectId}};if(t.properties&&t.properties.Values&&(r.pixel.properties.values=t.properties.Values),i&&i.features&&(r.catalogItems=yt(i),s&&s.length===r.catalogItems.features.length))for(let n=s.length-1;n>=0;n--)r.catalogItems.features[n].properties.catalogItemVisibility=s[n];return r}});function wi(t){return new bi(t)}const Ut=a.Evented.extend({options:{proxy:!1,useCors:mt,timeout:0},initialize(t){t=t||{},this._requestQueue=[],this._authenticating=!1,a.Util.setOptions(this,t),this.options.url=Bt(this.options.url)},get(t,e,i,s){return this._request("get",t,e,i,s)},post(t,e,i,s){return this._request("post",t,e,i,s)},request(t,e,i,s){return this._request("request",t,e,i,s)},metadata(t,e){return this._request("get","",{},t,e)},authenticate(t){return this._authenticating=!1,this.options.token=t,this._runQueue(),this},getTimeout(){return this.options.timeout},setTimeout(t){this.options.timeout=t},_request(t,e,i,s,r){this.fire("requeststart",{url:this.options.url+e,params:i,method:t},!0);const n=this._createServiceCallback(t,e,i,s,r);if(this.options.token&&(i.token=this.options.token),this.options.requestParams&&a.Util.extend(i,this.options.requestParams),this._authenticating)this._requestQueue.push([t,e,i,s,r]);else{const o=this.options.proxy?`${this.options.proxy}?${this.options.url}${e}`:this.options.url+e;return(t==="get"||t==="request")&&!this.options.useCors?dt.get.JSONP(o,i,n,r):dt[t](o,i,n,r)}},_createServiceCallback(t,e,i,s,r){return a.Util.bind(function(n,o){n&&(n.code===499||n.code===498)&&(this._authenticating=!0,this._requestQueue.push([t,e,i,s,r]),this.fire("authenticationrequired",{authenticate:a.Util.bind(this.authenticate,this)},!0),n.authenticate=a.Util.bind(this.authenticate,this)),s.call(r,n,o),n?this.fire("requesterror",{url:this.options.url+e,params:i,message:n.message,code:n.code,method:t},!0):this.fire("requestsuccess",{url:this.options.url+e,params:i,response:o,method:t},!0),this.fire("requestend",{url:this.options.url+e,params:i,method:t},!0)},this)},_runQueue(){for(let t=this._requestQueue.length-1;t>=0;t--){const e=this._requestQueue[t],i=e.shift();this[i].apply(this,e)}this._requestQueue=[]}}),xi=Ut.extend({identify(){return _i(this)},find(){return gi(this)},query(){return zt(this)}});function pe(t){return new xi(t)}const Li=Ut.extend({query(){return zt(this)},identify(){return wi(this)}});function Si(t){return new Li(t)}const Ci=Ut.extend({options:{idAttribute:"OBJECTID"},query(){return zt(this)},addFeature(t,e,i){this.addFeatures(t,e,i)},addFeatures(t,e,i){const s=t.features?t.features:[t];for(let r=s.length-1;r>=0;r--)delete s[r].id;return t=pt(t),t=s.length>1?t:[t],this.post("addFeatures",{features:t},(r,n)=>{const o=n&&n.addResults?n.addResults.length>1?n.addResults:n.addResults[0]:void 0;e&&e.call(i,r||n.addResults[0].error,o)},i)},updateFeature(t,e,i){this.updateFeatures(t,e,i)},updateFeatures(t,e,i){const s=t.features?t.features:[t];return t=pt(t,this.options.idAttribute),t=s.length>1?t:[t],this.post("updateFeatures",{features:t},(r,n)=>{const o=n&&n.updateResults?n.updateResults.length>1?n.updateResults:n.updateResults[0]:void 0;e&&e.call(i,r||n.updateResults[0].error,o)},i)},deleteFeature(t,e,i){this.deleteFeatures(t,e,i)},deleteFeatures(t,e,i){return this.post("deleteFeatures",{objectIds:t},(s,r)=>{const n=r&&r.deleteResults?r.deleteResults.length>1?r.deleteResults:r.deleteResults[0]:void 0;e&&e.call(i,s||r.deleteResults[0].error,n)},i)}});function Ai(t){return new Ci(t)}const x=window.location.protocol!=="https:"?"http:":"https:",ee=a.TileLayer.extend({statics:{TILES:{Streets:{urlTemplate:`${x}//{s}.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Street_Map"}},Topographic:{urlTemplate:`${x}//{s}.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Topo_Map"}},Oceans:{urlTemplate:`${x}//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/Ocean_Basemap"}},OceansLabels:{urlTemplate:`${x}//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:G?"esri-labels":"tilePane",attribution:""}},NationalGeographic:{urlTemplate:`${x}//{s}.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"National Geographic, DeLorme, HERE, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, increment P Corp."}},DarkGray:{urlTemplate:`${x}//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},DarkGrayLabels:{urlTemplate:`${x}//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:G?"esri-labels":"tilePane",attribution:""}},Gray:{urlTemplate:`${x}//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},GrayLabels:{urlTemplate:`${x}//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:G?"esri-labels":"tilePane",attribution:""}},Imagery:{urlTemplate:`${x}//{s}.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"DigitalGlobe, GeoEye, i-cubed, USDA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}},ImageryLabels:{urlTemplate:`${x}//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:G?"esri-labels":"tilePane",attribution:""}},ImageryTransportation:{urlTemplate:`${x}//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:G?"esri-labels":"tilePane",attribution:""}},ShadedRelief:{urlTemplate:`${x}//{s}.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS"}},ShadedReliefLabels:{urlTemplate:`${x}//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places_Alternate/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:12,subdomains:["server","services"],pane:G?"esri-labels":"tilePane",attribution:""}},Terrain:{urlTemplate:`${x}//{s}.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS, NOAA"}},TerrainLabels:{urlTemplate:`${x}//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:13,subdomains:["server","services"],pane:G?"esri-labels":"tilePane",attribution:""}},USATopo:{urlTemplate:`${x}//{s}.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:15,subdomains:["server","services"],attribution:"USGS, National Geographic Society, i-cubed"}},ImageryClarity:{urlTemplate:`${x}//clarity.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community"}},Physical:{urlTemplate:`${x}//{s}.arcgisonline.com/arcgis/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:8,subdomains:["server","services"],attribution:"U.S. National Park Service"}},ImageryFirefly:{urlTemplate:`${x}//fly.maptiles.arcgis.com/arcgis/rest/services/World_Imagery_Firefly/MapServer/tile/{z}/{y}/{x}`,options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}}}},initialize(t,e){let i;if(typeof t=="object"&&t.urlTemplate&&t.options)i=t;else if(typeof t=="string"&&ee.TILES[t])i=ee.TILES[t];else throw new Error('L.esri.BasemapLayer: Invalid parameter. Use one of "Streets", "Topographic", "Oceans", "OceansLabels", "NationalGeographic", "Physical", "Gray", "GrayLabels", "DarkGray", "DarkGrayLabels", "Imagery", "ImageryLabels", "ImageryTransportation", "ImageryClarity", "ImageryFirefly", ShadedRelief", "ShadedReliefLabels", "Terrain", "TerrainLabels" or "USATopo"');const s=a.Util.extend(i.options,e);a.Util.setOptions(this,s),this.options.ignoreDeprecationWarning||console.warn("WARNING: L.esri.BasemapLayer uses data services that are in mature support and are not being updated. Please use L.esri.Vector.vectorBasemapLayer instead. More info: https://esriurl.com/esri-leaflet-basemap"),this.options.token&&i.urlTemplate.indexOf("token=")===-1&&(i.urlTemplate+=`?token=${this.options.token}`),this.options.proxy&&(i.urlTemplate=`${this.options.proxy}?${i.urlTemplate}`),a.TileLayer.prototype.initialize.call(this,i.urlTemplate,s)},onAdd(t){vt(t),this.options.pane==="esri-labels"&&this._initPane(),this.options.attributionUrl&&mi((this.options.proxy?`${this.options.proxy}?`:"")+this.options.attributionUrl,t),t.on("moveend",Ot),a.TileLayer.prototype.onAdd.call(this,t)},onRemove(t){_t(t),t.off("moveend",Ot),a.TileLayer.prototype.onRemove.call(this,t)},_initPane(){if(!this._map.getPane(this.options.pane)){const t=this._map.createPane(this.options.pane);t.style.pointerEvents="none",t.style.zIndex=500}},getAttribution(){let t;return this.options.attribution&&(t=`<span class="esri-dynamic-attribution">${this.options.attribution}</span>`),t}}),Ii=a.TileLayer.extend({options:{zoomOffsetAllowance:.1,errorTileUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEABAMAAACuXLVVAAAAA1BMVEUzNDVszlHHAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAAAAAAAAAB6mUWpAAAADZJREFUeJztwQEBAAAAgiD/r25IQAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7waBAAABw08RwAAAAABJRU5ErkJggg=="},statics:{MercatorZoomLevels:{0:156543.033928,1:78271.5169639999,2:39135.7584820001,3:19567.8792409999,4:9783.93962049996,5:4891.96981024998,6:2445.98490512499,7:1222.99245256249,8:611.49622628138,9:305.748113140558,10:152.874056570411,11:76.4370282850732,12:38.2185141425366,13:19.1092570712683,14:9.55462853563415,15:4.77731426794937,16:2.38865713397468,17:1.19432856685505,18:.597164283559817,19:.298582141647617,20:.14929107082381,21:.07464553541191,22:.0373227677059525,23:.0186613838529763}},initialize(t){t=a.Util.setOptions(this,t),t.apikey&&(t.token=t.apikey),t=gt(t),this.tileUrl=`${(t.proxy?`${t.proxy}?`:"")+t.url}tile/{z}/{y}/{x}${t.requestParams&&Object.keys(t.requestParams).length>0?a.Util.getParamString(t.requestParams):""}`,t.url.indexOf("{s}")!==-1&&t.subdomains&&(t.url=t.url.replace("{s}",t.subdomains[0])),this.service=pe(t),this.service.addEventParent(this),new RegExp(/tiles.arcgis(online)?\.com/g).test(t.url)&&(this.tileUrl=this.tileUrl.replace("://tiles","://tiles{s}"),t.subdomains=["1","2","3","4"]),this.options.token&&(this.tileUrl+=`?token=${this.options.token}`),a.TileLayer.prototype.initialize.call(this,this.tileUrl,t)},getTileUrl(t){const e=this._getZoomForUrl();return a.Util.template(this.tileUrl,a.Util.extend({s:this._getSubdomain(t),x:t.x,y:t.y,z:this._lodMap&&this._lodMap[e]!==void 0?this._lodMap[e]:e},this.options))},createTile(t,e){const i=document.createElement("img");return a.DomEvent.on(i,"load",a.Util.bind(this._tileOnLoad,this,e,i)),a.DomEvent.on(i,"error",a.Util.bind(this._tileOnError,this,e,i)),this.options.crossOrigin&&(i.crossOrigin=""),i.alt="",!this._lodMap||this._lodMap&&this._lodMap[this._getZoomForUrl()]!==void 0?i.src=this.getTileUrl(t):this.once("lodmap",function(){i.src=this.getTileUrl(t)},this),i},onAdd(t){vt(t),this._lodMap||this.metadata(function(e,i){if(!e&&i.spatialReference){const s=i.spatialReference.latestWkid||i.spatialReference.wkid;if(!this.options.attribution&&t.attributionControl&&i.copyrightText&&(this.options.attribution=i.copyrightText,t.attributionControl.addAttribution(this.getAttribution())),t.options.crs===a.CRS.EPSG3857&&(s===102100||s===3857)){this._lodMap={};const r=i.tileInfo.lods,n=Ii.MercatorZoomLevels;for(let o=0;o<r.length;o++){const h=r[o];for(const d in n){const c=n[d];if(this._withinPercentage(h.resolution,c,this.options.zoomOffsetAllowance)){this._lodMap[d]=h.level;break}}}this.fire("lodmap")}else t.options.crs&&t.options.crs.code&&t.options.crs.code.indexOf(s)>-1||J("L.esri.TiledMapLayer is using a non-mercator spatial reference. Support may be available through Proj4Leaflet https://developers.arcgis.com/esri-leaflet/samples/non-mercator-projection/")}},this),a.TileLayer.prototype.onAdd.call(this,t)},onRemove(t){_t(t),a.TileLayer.prototype.onRemove.call(this,t)},metadata(t,e){return this.service.metadata(t,e),this},identify(){return this.service.identify()},find(){return this.service.find()},query(){return this.service.query()},authenticate(t){const e=`?token=${t}`;return this.tileUrl=this.options.token?this.tileUrl.replace(/\?token=(.+)/g,e):this.tileUrl+e,this.options.token=t,this.service.authenticate(t),this},_withinPercentage(t,e,i){return Math.abs(t/e-1)<i}}),Ti=a.ImageOverlay.extend({onAdd(t){this._topLeft=t.getPixelBounds().min,a.ImageOverlay.prototype.onAdd.call(this,t)},_reset(){this._map.options.crs===a.CRS.EPSG3857?a.ImageOverlay.prototype._reset.call(this):a.DomUtil.setPosition(this._image,this._topLeft.subtract(this._map.getPixelOrigin()))}}),me=a.Layer.extend({options:{opacity:1,position:"front",f:"image",useCors:mt,attribution:null,interactive:!1,alt:""},onAdd(t){vt(t),this.options.zIndex&&(this.options.position=null),this._update=a.Util.throttle(this._update,this.options.updateInterval,this),t.on("moveend",this._update,this),this._currentImage&&this._currentImage._bounds.equals(this._map.getBounds())?t.addLayer(this._currentImage):this._currentImage&&(this._map.removeLayer(this._currentImage),this._currentImage=null),this._update(),this._popup&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this.metadata(function(e,i){!e&&!this.options.attribution&&t.attributionControl&&i.copyrightText&&(this.options.attribution=i.copyrightText,t.attributionControl.addAttribution(this.getAttribution()))},this)},onRemove(t){_t(t),this._currentImage&&this._map.removeLayer(this._currentImage),this._popup&&(this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._map.off("moveend",this._update,this)},bindPopup(t,e){return this._shouldRenderPopup=!1,this._lastClick=!1,this._popup=a.popup(e),this._popupFunction=t,this._map&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this},unbindPopup(){return this._map&&(this._map.closePopup(this._popup),this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._popup=!1,this},bringToFront(){return this.options.position="front",this._currentImage&&(this._currentImage.bringToFront(),this._setAutoZIndex(Math.max)),this},bringToBack(){return this.options.position="back",this._currentImage&&(this._currentImage.bringToBack(),this._setAutoZIndex(Math.min)),this},setZIndex(t){return this.options.zIndex=t,this._currentImage&&this._currentImage.setZIndex(t),this},_setAutoZIndex(t){if(!this._currentImage)return;const e=this._currentImage.getPane().children;let i=-t(-1/0,1/0);for(let s=0,r=e.length,n;s<r;s++)n=e[s].style.zIndex,e[s]!==this._currentImage._image&&n&&(i=t(i,+n));isFinite(i)&&(this.options.zIndex=i+t(-1,1),this.setZIndex(this.options.zIndex))},getAttribution(){return this.options.attribution},getOpacity(){return this.options.opacity},setOpacity(t){return this.options.opacity=t,this._currentImage&&this._currentImage.setOpacity(t),this},getTimeRange(){return[this.options.from,this.options.to]},setTimeRange(t,e){return this.options.from=t,this.options.to=e,this._update(),this},metadata(t,e){return this.service.metadata(t,e),this},authenticate(t){return this.service.authenticate(t),this},redraw(){this._update()},_renderImage(t,e,i){if(this._map){if(i&&(t=`data:${i};base64,${t}`),!t)return;const s=new Ti(t,e,{opacity:0,crossOrigin:this.options.withCredentials?"use-credentials":this.options.useCors,alt:this.options.alt,pane:this.options.pane||this.getPane(),interactive:this.options.interactive}).addTo(this._map);let r;const n=function(){this._map.removeLayer(s),this.fire("error"),s.off("load",r,this)};r=function(o){if(s.off("error",n,this),this._map){const h=o.target,d=this._currentImage;h._bounds.equals(e)&&h._bounds.equals(this._map.getBounds())?(this._currentImage=h,this.options.position==="front"?this.bringToFront():this.options.position==="back"&&this.bringToBack(),this.options.zIndex&&this.setZIndex(this.options.zIndex),this._map&&this._currentImage._map?this._currentImage.setOpacity(this.options.opacity):this._currentImage._map.removeLayer(this._currentImage),d&&this._map&&this._map.removeLayer(d),d&&d._map&&d._map.removeLayer(d)):this._map.removeLayer(h)}this.fire("load",{bounds:e})},s.once("error",n,this),s.once("load",r,this)}},_update(){if(!this._map)return;const t=this._map.getZoom(),e=this._map.getBounds();if(this._animatingZoom||this._map._panTransition&&this._map._panTransition._inProgress)return;if(t>this.options.maxZoom||t<this.options.minZoom){this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null);return}const i=this._buildExportParams();a.Util.extend(i,this.options.requestParams),i?(this._requestExport(i,e),this.fire("loading",{bounds:e})):this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null)},_renderPopup(t,e,i,s){if(t=a.latLng(t),this._shouldRenderPopup&&this._lastClick.equals(t)){const r=this._popupFunction(e,i,s);r&&this._popup.setLatLng(t).setContent(r).openOn(this._map)}},_resetPopupState(t){this._shouldRenderPopup=!1,this._lastClick=t.latlng},_calculateBbox(){const t=this._map.getPixelBounds(),e=this._map.unproject(t.getBottomLeft()),i=this._map.unproject(t.getTopRight()),s=this._map.options.crs.project(i),r=this._map.options.crs.project(e),n=a.bounds(s,r);return[n.getBottomLeft().x,n.getBottomLeft().y,n.getTopRight().x,n.getTopRight().y].join(",")},_calculateImageSize(){const t=this._map.getPixelBounds(),e=this._map.getSize(),i=this._map.unproject(t.getBottomLeft()),s=this._map.unproject(t.getTopRight()),r=this._map.latLngToLayerPoint(s).y,n=this._map.latLngToLayerPoint(i).y;return(r>0||n<e.y)&&(e.y=n-r),`${e.x},${e.y}`}});me.extend({options:{updateInterval:150,format:"jpgpng",transparent:!0,f:"image"},query(){return this.service.query()},identify(){return this.service.identify()},initialize(t){t=gt(t),this.service=Si(t),this.service.addEventParent(this),a.Util.setOptions(this,t)},setPixelType(t){return this.options.pixelType=t,this._update(),this},getPixelType(){return this.options.pixelType},setBandIds(t){return a.Util.isArray(t)?this.options.bandIds=t.join(","):this.options.bandIds=t.toString(),this._update(),this},getBandIds(){return this.options.bandIds},setNoData(t,e){return a.Util.isArray(t)?this.options.noData=t.join(","):this.options.noData=t.toString(),e&&(this.options.noDataInterpretation=e),this._update(),this},getNoData(){return this.options.noData},getNoDataInterpretation(){return this.options.noDataInterpretation},setRenderingRule(t){this.options.renderingRule=t,this._update()},getRenderingRule(){return this.options.renderingRule},setMosaicRule(t){this.options.mosaicRule=t,this._update()},getMosaicRule(){return this.options.mosaicRule},_getPopupData(t){const e=a.Util.bind(function(s,r,n){s||setTimeout(a.Util.bind(function(){this._renderPopup(t.latlng,s,r,n)},this),300)},this),i=this.identify().at(t.latlng);this.options.mosaicRule&&i.setMosaicRule(this.options.mosaicRule),i.run(e),this._shouldRenderPopup=!0,this._lastClick=t.latlng},_buildExportParams(){const t=parseInt(this._map.options.crs.code.split(":")[1],10),e={bbox:this._calculateBbox(),size:this._calculateImageSize(),format:this.options.format,transparent:this.options.transparent,bboxSR:t,imageSR:t};return this.options.from&&this.options.to&&(e.time=`${this.options.from.valueOf()},${this.options.to.valueOf()}`),this.options.pixelType&&(e.pixelType=this.options.pixelType),this.options.interpolation&&(e.interpolation=this.options.interpolation),this.options.compressionQuality&&(e.compressionQuality=this.options.compressionQuality),this.options.bandIds&&(e.bandIds=this.options.bandIds),(this.options.noData===0||this.options.noData)&&(e.noData=this.options.noData),this.options.noDataInterpretation&&(e.noDataInterpretation=this.options.noDataInterpretation),this.service.options.token&&(e.token=this.service.options.token),this.options.renderingRule&&(e.renderingRule=JSON.stringify(this.options.renderingRule)),this.options.mosaicRule&&(e.mosaicRule=JSON.stringify(this.options.mosaicRule)),e},_requestExport(t,e){if(this.options.f==="json")this.service.request("exportImage",t,function(i,s){i||(this.options.token&&(s.href+=`?token=${this.options.token}`),this.options.proxy&&(s.href=`${this.options.proxy}?${s.href}`),this._renderImage(s.href,e))},this);else{t.f="image";let i=`${this.options.url}exportImage${a.Util.getParamString(t)}`;this.options.proxy&&(i=`${this.options.proxy}?${i}`),this._renderImage(i,e)}}});me.extend({options:{updateInterval:150,layers:!1,layerDefs:!1,timeOptions:!1,format:"png32",transparent:!0,f:"json"},initialize(t){t=gt(t),this.service=pe(t),this.service.addEventParent(this),a.Util.setOptions(this,t)},getDynamicLayers(){return this.options.dynamicLayers},setDynamicLayers(t){return this.options.dynamicLayers=t,this._update(),this},getLayers(){return this.options.layers},setLayers(t){return this.options.layers=t,this._update(),this},getLayerDefs(){return this.options.layerDefs},setLayerDefs(t){return this.options.layerDefs=t,this._update(),this},getTimeOptions(){return this.options.timeOptions},setTimeOptions(t){return this.options.timeOptions=t,this._update(),this},query(){return this.service.query()},identify(){return this.service.identify()},find(){return this.service.find()},_getPopupData(t){const e=a.Util.bind(function(s,r,n){s||setTimeout(a.Util.bind(function(){this._renderPopup(t.latlng,s,r,n)},this),300)},this);let i;if(this.options.popup?i=this.options.popup.on(this._map).at(t.latlng):i=this.identify().on(this._map).at(t.latlng),i.params.maxAllowableOffset||i.simplify(this._map,.5),this.options.popup&&this.options.popup.params&&this.options.popup.params.layers||(this.options.layers?i.layers(`visible:${this.options.layers.join(",")}`):i.layers("visible")),this.options.layerDefs&&typeof this.options.layerDefs!="string"&&!i.params.layerDefs)for(const s in this.options.layerDefs)Object.hasOwn(this.options.layerDefs,s)&&i.layerDef(s,this.options.layerDefs[s]);i.run(e),this._shouldRenderPopup=!0,this._lastClick=t.latlng},_buildExportParams(){const t=parseInt(this._map.options.crs.code.split(":")[1],10),e={bbox:this._calculateBbox(),size:this._calculateImageSize(),dpi:96,format:this.options.format,transparent:this.options.transparent,bboxSR:t,imageSR:t};if(this.options.dynamicLayers&&(e.dynamicLayers=this.options.dynamicLayers),this.options.layers){if(this.options.layers.length===0)return;e.layers=`show:${this.options.layers.join(",")}`}return this.options.layerDefs&&(e.layerDefs=typeof this.options.layerDefs=="string"?this.options.layerDefs:JSON.stringify(this.options.layerDefs)),this.options.timeOptions&&(e.timeOptions=JSON.stringify(this.options.timeOptions)),this.options.from&&this.options.to&&(e.time=`${this.options.from.valueOf()},${this.options.to.valueOf()}`),this.service.options.token&&(e.token=this.service.options.token),this.options.proxy&&(e.proxy=this.options.proxy),this.options.disableCache&&(e._ts=Date.now()),e},_requestExport(t,e){if(this.options.f==="json")this.service.request("export",t,function(i,s){i||(this.options.token&&s.href&&(s.href+=`?token=${this.options.token}`),this.options.proxy&&s.href&&(s.href=`${this.options.proxy}?${s.href}`),s.href?this._renderImage(s.href,e):this._renderImage(s.imageData,e,s.contentType))},this);else{t.f="image";let i=`${this.options.url}export${a.Util.getParamString(t)}`;this.options.proxy&&(i=`${this.options.proxy}?${i}`),this._renderImage(i,e)}}});const ht=a.Layer.extend({options:{cellSize:512,updateWhenIdle:a.Browser.mobile,updateInterval:150,noWrap:!1,keepBuffer:1.5},initialize(t){a.Util.setOptions(this,t)},onAdd(){this._cells={},this._activeCells={},this._resetView(),this._update()},onRemove(){this._removeAllCells(),this._cellZoom=void 0},isLoading(){return this._loading},redraw(){return this._map&&(this._removeAllCells(),this._update()),this},getEvents(){const t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=a.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),t},createCell(){return document.createElement("div")},removeCell(){},reuseCell(){},cellLeave(){},cellEnter(){},getCellSize(){const t=this.options.cellSize;return t instanceof a.Point?t:new a.Point(t,t)},_pruneCells(){if(!this._map)return;let t,e;for(t in this._cells)e=this._cells[t],e.retain=e.current;for(t in this._cells)if(e=this._cells[t],e.current&&!e.active){const i=e.coords;this._retainParent(i.x,i.y,i.z,i.z-5)||this._retainChildren(i.x,i.y,i.z,i.z+2)}for(t in this._cells)this._cells[t].retain||this._removeCell(t)},_removeAllCells(){for(const t in this._cells)this._removeCell(t)},_invalidateAll(){this._removeAllCells(),this._cellZoom=void 0},_retainParent(t,e,i,s){const r=Math.floor(t/2),n=Math.floor(e/2),o=i-1,h=new a.Point(+r,+n);h.z=+o;const d=this._cellCoordsToKey(h),c=this._cells[d];return c&&c.active?(c.retain=!0,!0):(c&&c.loaded&&(c.retain=!0),o>s?this._retainParent(r,n,o,s):!1)},_retainChildren(t,e,i,s){for(let r=2*t;r<2*t+2;r++)for(let n=2*e;n<2*e+2;n++){const o=new a.Point(r,n);o.z=i+1;const h=this._cellCoordsToKey(o),d=this._cells[h];if(d&&d.active){d.retain=!0;continue}else d&&d.loaded&&(d.retain=!0);i+1<s&&this._retainChildren(r,n,i+1,s)}},_resetView(t){const e=t&&(t.pinch||t.flyTo);e||this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_setView(t,e,i,s){const r=Math.round(e);s||(this._cellZoom=r,this._abortLoading&&this._abortLoading(),this._resetGrid(),r!==void 0&&this._update(t),i||this._pruneCells(),this._noPrune=!!i)},_resetGrid(){const t=this._map,e=t.options.crs,i=this._cellSize=this.getCellSize(),s=this._cellZoom,r=this._map.getPixelWorldBounds(this._cellZoom);r&&(this._globalCellRange=this._pxBoundsToCellRange(r)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],s).x/i.x),Math.ceil(t.project([0,e.wrapLng[1]],s).x/i.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],s).y/i.x),Math.ceil(t.project([e.wrapLat[1],0],s).y/i.y)]},_onMoveEnd(t){t&&(t.pinch||t.flyTo)||!this._map||this._map._animatingZoom||this._update()},_getCelldPixelBounds(t){const e=this._map,i=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),s=e.getZoomScale(i,this._cellZoom),r=e.project(t,this._cellZoom).floor(),n=e.getSize().divideBy(s*2);return new a.Bounds(r.subtract(n),r.add(n))},_update(t){const e=this._map;if(!e)return;const i=Math.round(e.getZoom());t===void 0&&(t=e.getCenter());const s=this._getCelldPixelBounds(t),r=this._pxBoundsToCellRange(s),n=r.getCenter(),o=[],h=this.options.keepBuffer,d=new a.Bounds(r.getBottomLeft().subtract([h,-h]),r.getTopRight().add([h,-h]));if(!(isFinite(r.min.x)&&isFinite(r.min.y)&&isFinite(r.max.x)&&isFinite(r.max.y)))throw new Error("Attempted to load an infinite number of cells");for(const c in this._cells){const m=this._cells[c].coords;(m.z!==this._cellZoom||!d.contains(new a.Point(m.x,m.y)))&&(this._cells[c].current=!1)}if(Math.abs(i-this._cellZoom)>1){this._setView(t,i);return}for(let c=r.min.y;c<=r.max.y;c++)for(let m=r.min.x;m<=r.max.x;m++){const w=new a.Point(m,c);if(w.z=this._cellZoom,!this._isValidCell(w))continue;const D=this._cells[this._cellCoordsToKey(w)];D?D.current=!0:o.push(w)}if(o.sort((c,m)=>c.distanceTo(n)-m.distanceTo(n)),o.length!==0){this._loading||(this._loading=!0);for(let c=0;c<o.length;c++){const m=this._cellCoordsToKey(o[c]),w=this._keyToCellCoords(m);this._activeCells[w]?this._reuseCell(o[c]):this._createCell(o[c])}}},_isValidCell(t){const e=this._map.options.crs;if(!e.infinite){const s=this._globalCellRange;if(!e.wrapLng&&(t.x<s.min.x||t.x>s.max.x)||!e.wrapLat&&(t.y<s.min.y||t.y>s.max.y))return!1}if(!this.options.bounds)return!0;const i=this._cellCoordsToBounds(t);return a.latLngBounds(this.options.bounds).overlaps(i)},_keyToBounds(t){return this._cellCoordsToBounds(this._keyToCellCoords(t))},_cellCoordsToNwSe(t){const e=this._map,i=this.getCellSize(),s=t.scaleBy(i),r=s.add(i),n=e.unproject(s,t.z),o=e.unproject(r,t.z);return[n,o]},_cellCoordsToBounds(t){const e=this._cellCoordsToNwSe(t);let i=new a.LatLngBounds(e[0],e[1]);return this.options.noWrap||(i=this._map.wrapLatLngBounds(i)),i},_cellCoordsToKey(t){return`${t.x}:${t.y}:${t.z}`},_keyToCellCoords(t){const e=t.split(":"),i=new a.Point(+e[0],+e[1]);return i.z=+e[2],i},_removeCell(t){const e=this._cells[t];if(!e)return;const i=this._keyToCellCoords(t),s=this._wrapCoords(i),r=this._cellCoordsToBounds(this._wrapCoords(i));e.current=!1,delete this._cells[t],this._activeCells[t]=e,this.cellLeave(r,s,t),this.fire("cellleave",{key:t,coords:s,bounds:r})},_reuseCell(t){const e=this._cellCoordsToKey(t);this._cells[e]=this._activeCells[e],this._cells[e].current=!0;const i=this._wrapCoords(t),s=this._cellCoordsToBounds(this._wrapCoords(t));this.cellEnter(s,i,e),this.fire("cellenter",{key:e,coords:i,bounds:s})},_createCell(t){const e=this._cellCoordsToKey(t),i=this._wrapCoords(t),s=this._cellCoordsToBounds(this._wrapCoords(t));this.createCell(s,i,e),this.fire("cellcreate",{key:e,coords:i,bounds:s}),this._cells[e]={coords:t,current:!0},a.Util.requestAnimFrame(this._pruneCells,this)},_cellReady(t,e,i){const s=this._cellCoordsToKey(t);i=this._cells[s],i&&(i.loaded=+new Date,i.active=!0)},_getCellPos(t){return t.scaleBy(this.getCellSize())},_wrapCoords(t){const e=new a.Point(this._wrapX?a.Util.wrapNum(t.x,this._wrapX):t.x,this._wrapY?a.Util.wrapNum(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToCellRange(t){const e=this.getCellSize();return new a.Bounds(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))}});function E(t){this.values=[].concat(t||[])}E.prototype.query=function(t){var e=this.getIndex(t);return this.values[e]};E.prototype.getIndex=function(e){this.dirty&&this.sort();for(var i=0,s=this.values.length-1,r,n;i<=s;)if(r=(i+s)/2|0,n=this.values[Math.round(r)],+n.value<+e)i=r+1;else if(+n.value>+e)s=r-1;else return r;return Math.abs(~s)};E.prototype.between=function(e,i){var s=this.getIndex(e),r=this.getIndex(i);if(s===0&&r===0)return[];for(;this.values[s-1]&&this.values[s-1].value===e;)s--;for(;this.values[r+1]&&this.values[r+1].value===i;)r++;return this.values[r]&&this.values[r].value===i&&this.values[r+1]&&r++,this.values.slice(s,r)};E.prototype.insert=function(e){return this.values.splice(this.getIndex(e.value),0,e),this};E.prototype.bulkAdd=function(e,i){return this.values=this.values.concat([].concat(e||[])),i?this.sort():this.dirty=!0,this};E.prototype.sort=function(){return this.values.sort(function(e,i){return+i.value-+e.value}).reverse(),this.dirty=!1,this};const Rt=ht.extend({options:{attribution:null,where:"1=1",fields:["*"],from:!1,to:!1,timeField:!1,timeFilterMode:"server",simplifyFactor:0,precision:6,fetchAllFeatures:!1},initialize(t){if(ht.prototype.initialize.call(this,t),t=gt(t),t=a.Util.setOptions(this,t),this.service=Ai(t),this.service.addEventParent(this),this.options.fields[0]!=="*"){let e=!1;for(let i=0;i<this.options.fields.length;i++)this.options.fields[i].match(/^(OBJECTID|FID|OID|ID)$/i)&&(e=!0);e===!1&&J("no known esriFieldTypeOID field detected in fields Array.  Please add an attribute field containing unique IDs to ensure the layer can be drawn correctly.")}this.options.timeField.start&&this.options.timeField.end?(this._startTimeIndex=new E,this._endTimeIndex=new E):this.options.timeField&&(this._timeIndex=new E),this._cache={},this._currentSnapshot=[],this._activeRequests=0},onAdd(t){return vt(t),this.service.metadata(function(e,i){if(!e){const s=i.supportedQueryFormats;let r=!1;(this.service.options.isModern===!1||this.options.fetchAllFeatures)&&(r=!0),!r&&s&&s.indexOf("geoJSON")!==-1&&(this.service.options.isModern=!0),i.objectIdField&&(this.service.options.idAttribute=i.objectIdField),!this.options.attribution&&t.attributionControl&&i.copyrightText&&(this.options.attribution=i.copyrightText,t.attributionControl.addAttribution(this.getAttribution()))}},this),t.on("zoomend",this._handleZoomChange,this),ht.prototype.onAdd.call(this,t)},onRemove(t){return _t(t),t.off("zoomend",this._handleZoomChange,this),ht.prototype.onRemove.call(this,t)},getAttribution(){return this.options.attribution},createCell(t,e){this._visibleZoom()&&this._requestFeatures(t,e)},_requestFeatures(t,e,i,s){this._activeRequests++,s=s||0;const r=this.options.where;return this._activeRequests===1&&this.fire("loading",{bounds:t},!0),this._buildQuery(t,s).run(function(n,o,h){h&&h.exceededTransferLimit&&this.fire("drawlimitexceeded"),this.options.where===r&&(!n&&o&&o.features.length&&a.Util.requestAnimFrame(a.Util.bind(function(){this._addFeatures(o.features,e),this._postProcessFeatures(t)},this)),!n&&o&&!o.features.length&&this._postProcessFeatures(t),n&&this._postProcessFeatures(t),i&&i.call(this,n,o),h&&(h.exceededTransferLimit||h.properties&&h.properties.exceededTransferLimit)&&this.options.fetchAllFeatures&&this._requestFeatures(t,e,i,s+o.features.length))},this)},_postProcessFeatures(t){this._activeRequests--,this._activeRequests<=0&&this.fire("load",{bounds:t})},_cacheKey(t){return`${t.z}:${t.x}:${t.y}`},_addFeatures(t,e){let i;e&&(i=this._cacheKey(e),this._cache[i]=this._cache[i]||[]);for(let s=t.length-1;s>=0;s--){const r=t[s].id;this._currentSnapshot.indexOf(r)===-1&&this._currentSnapshot.push(r),typeof i<"u"&&this._cache[i].indexOf(r)===-1&&this._cache[i].push(r)}this.options.timeField&&this._buildTimeIndexes(t),this.createLayers(t)},_buildQuery(t,e){let i=this.service.query().intersects(t).where(this.options.where).fields(this.options.fields).precision(this.options.precision);return this.options.fetchAllFeatures&&!isNaN(parseInt(e))&&(i=i.offset(e)),i.params.resultType="tile",this.options.requestParams&&a.Util.extend(i.params,this.options.requestParams),this.options.simplifyFactor&&i.simplify(this._map,this.options.simplifyFactor),this.options.timeFilterMode==="server"&&this.options.from&&this.options.to&&i.between(this.options.from,this.options.to),i},setWhere(t,e,i){this.options.where=t&&t.length?t:"1=1";const s=[],r=[];let n=0,o=null;const h=a.Util.bind(function(d,c){if(d&&(o=d),c)for(let m=c.features.length-1;m>=0;m--)r.push(c.features[m].id);n--,n<=0&&this._visibleZoom()&&t===this.options.where&&(this._currentSnapshot=r,a.Util.requestAnimFrame(a.Util.bind(function(){this.removeLayers(s),this.addLayers(r),e&&e.call(i,o)},this)))},this);for(let d=this._currentSnapshot.length-1;d>=0;d--)s.push(this._currentSnapshot[d]);this._cache={};for(const d in this._cells){n++;const c=this._keyToCellCoords(d),m=this._cellCoordsToBounds(c);this._requestFeatures(m,c,h)}return this},getWhere(){return this.options.where},getTimeRange(){return[this.options.from,this.options.to]},setTimeRange(t,e,i,s){const r=this.options.from,n=this.options.to;let o=0,h=null;const d=a.Util.bind(function(c){c&&(h=c),this._filterExistingFeatures(r,n,t,e),o--,i&&o<=0&&i.call(s,h)},this);if(this.options.from=t,this.options.to=e,this._filterExistingFeatures(r,n,t,e),this.options.timeFilterMode==="server")for(const c in this._cells){o++;const m=this._keyToCellCoords(c),w=this._cellCoordsToBounds(m);this._requestFeatures(w,m,d)}return this},refresh(){this.setWhere(this.options.where)},_filterExistingFeatures(t,e,i,s){const r=t&&e?this._getFeaturesInTimeRange(t,e):this._currentSnapshot,n=this._getFeaturesInTimeRange(i,s);if(n.indexOf)for(let o=0;o<n.length;o++){const h=r.indexOf(n[o]);h>=0&&r.splice(h,1)}a.Util.requestAnimFrame(a.Util.bind(function(){this.removeLayers(r),this.addLayers(n)},this))},_getFeaturesInTimeRange(t,e){const i=[];let s;if(this.options.timeField.start&&this.options.timeField.end){const r=this._startTimeIndex.between(t,e),n=this._endTimeIndex.between(t,e);s=r.concat(n)}else if(this._timeIndex)s=this._timeIndex.between(t,e);else return J("You must set timeField in the layer constructor in order to manipulate the start and end time filter."),[];for(let r=s.length-1;r>=0;r--)i.push(s[r].id);return i},_buildTimeIndexes(t){let e,i;if(this.options.timeField.start&&this.options.timeField.end){const s=[],r=[];for(e=t.length-1;e>=0;e--)i=t[e],s.push({id:i.id,value:new Date(i.properties[this.options.timeField.start])}),r.push({id:i.id,value:new Date(i.properties[this.options.timeField.end])});this._startTimeIndex.bulkAdd(s),this._endTimeIndex.bulkAdd(r)}else{const s=[];for(e=t.length-1;e>=0;e--)i=t[e],s.push({id:i.id,value:new Date(i.properties[this.options.timeField])});this._timeIndex.bulkAdd(s)}},_featureWithinTimeRange(t){if(!this.options.from||!this.options.to)return!0;const e=+this.options.from.valueOf(),i=+this.options.to.valueOf();if(typeof this.options.timeField=="string"){const s=+t.properties[this.options.timeField];return s>=e&&s<=i}if(this.options.timeField.start&&this.options.timeField.end){const s=+t.properties[this.options.timeField.start],r=+t.properties[this.options.timeField.end];return s>=e&&s<=i||r>=e&&r<=i||s<=e&&r>=i}},_visibleZoom(){if(!this._map)return!1;const t=this._map.getZoom();return!(t>this.options.maxZoom||t<this.options.minZoom)},_handleZoomChange(){if(!this._visibleZoom())this.removeLayers(this._currentSnapshot),this._currentSnapshot=[];else for(const t in this._cells){const e=this._cells[t].coords,i=this._cacheKey(e);this._cache[i]&&this.addLayers(this._cache[i])}},authenticate(t){return this.service.authenticate(t),this},metadata(t,e){return this.service.metadata(t,e),this},query(){return this.service.query()},_getMetadata(t){if(this._metadata){let e;t(e,this._metadata)}else this.metadata(a.Util.bind(function(e,i){this._metadata=i,t(e,this._metadata)},this))},addFeature(t,e,i){this.addFeatures(t,e,i)},addFeatures(t,e,i){this._getMetadata(a.Util.bind(function(s,r){if(s){e&&e.call(this,s,null);return}const n=t.features?t.features:[t];this.service.addFeatures(t,a.Util.bind(function(o,h){if(!o){for(let d=n.length-1;d>=0;d--)n[d].properties[r.objectIdField]=n.length>1?h[d].objectId:h.objectId,n[d].id=n.length>1?h[d].objectId:h.objectId;this._addFeatures(n)}e&&e.call(i,o,h)},this))},this))},updateFeature(t,e,i){this.updateFeatures(t,e,i)},updateFeatures(t,e,i){const s=t.features?t.features:[t];this.service.updateFeatures(t,function(r,n){if(!r){for(let o=s.length-1;o>=0;o--)this.removeLayers([s[o].id],!0);this._addFeatures(s)}e&&e.call(i,r,n)},this)},deleteFeature(t,e,i){this.deleteFeatures(t,e,i)},deleteFeatures(t,e,i){return this.service.deleteFeatures(t,function(s,r){const n=r.length?r:[r];if(!s&&n.length>0)for(let o=n.length-1;o>=0;o--)this.removeLayers([n[o].objectId],!0);e&&e.call(i,s,r)},this)}});Rt.extend({options:{cacheLayers:!0},initialize(t){t.apikey&&(t.token=t.apikey),Rt.prototype.initialize.call(this,t),this._originalStyle=this.options.style,this._layers={}},onRemove(t){for(const e in this._layers)t.removeLayer(this._layers[e]),this.fire("removefeature",{feature:this._layers[e].feature,permanent:!1},!0);return Rt.prototype.onRemove.call(this,t)},createNewLayer(t){const e=a.GeoJSON.geometryToLayer(t,this.options);return e&&(e.defaultOptions=e.options),e},_updateLayer(t,e){let i=[];const s=this.options.coordsToLatLng||a.GeoJSON.coordsToLatLng;switch(e.properties&&(t.feature.properties=e.properties),e.geometry.type){case"Point":i=a.GeoJSON.coordsToLatLng(e.geometry.coordinates),t.setLatLng(i);break;case"LineString":i=a.GeoJSON.coordsToLatLngs(e.geometry.coordinates,0,s),t.setLatLngs(i);break;case"MultiLineString":i=a.GeoJSON.coordsToLatLngs(e.geometry.coordinates,1,s),t.setLatLngs(i);break;case"Polygon":i=a.GeoJSON.coordsToLatLngs(e.geometry.coordinates,1,s),t.setLatLngs(i);break;case"MultiPolygon":i=a.GeoJSON.coordsToLatLngs(e.geometry.coordinates,2,s),t.setLatLngs(i);break}this.redraw(t.feature.id)},createLayers(t){for(let e=t.length-1;e>=0;e--){const i=t[e],s=this._layers[i.id];let r;this._visibleZoom()&&s&&!this._map.hasLayer(s)&&(!this.options.timeField||this._featureWithinTimeRange(i))&&(this._map.addLayer(s),this.fire("addfeature",{feature:s.feature},!0)),s&&(s.setLatLngs||s.setLatLng)&&this._updateLayer(s,i),s||(r=this.createNewLayer(i),r?(r.feature=i,r.addEventParent(this),this.options.onEachFeature&&this.options.onEachFeature(r.feature,r),this._layers[r.feature.id]=r,this.setFeatureStyle(r.feature.id,this.options.style),this.fire("createfeature",{feature:r.feature},!0),this._visibleZoom()&&(!this.options.timeField||this.options.timeField&&this._featureWithinTimeRange(i))&&this._map.addLayer(r)):J("invalid GeoJSON encountered"))}},addLayers(t){for(let e=t.length-1;e>=0;e--){const i=this._layers[t[e]];i&&(!this.options.timeField||this._featureWithinTimeRange(i.feature))&&(this._map.addLayer(i),this.fire("addfeature",{feature:i.feature},!0))}},removeLayers(t,e){for(let i=t.length-1;i>=0;i--){const s=t[i],r=this._layers[s];r&&(this.fire("removefeature",{feature:r.feature,permanent:e},!0),this._map.removeLayer(r)),r&&e&&delete this._layers[s]}},cellEnter(t,e){this._visibleZoom()&&!this._zooming&&this._map&&a.Util.requestAnimFrame(a.Util.bind(function(){const i=this._cacheKey(e),s=this._cellCoordsToKey(e),r=this._cache[i];this._activeCells[s]&&r&&this.addLayers(r)},this))},cellLeave(t,e){this._zooming||a.Util.requestAnimFrame(a.Util.bind(function(){if(this._map){const i=this._cacheKey(e),s=this._cellCoordsToKey(e),r=this._cache[i],n=this._map.getBounds();if(!this._activeCells[s]&&r){let o=!0;for(let h=0;h<r.length;h++){const d=this._layers[r[h]];d&&d.getBounds&&n.intersects(d.getBounds())&&(o=!1)}o&&this.removeLayers(r,!this.options.cacheLayers),!this.options.cacheLayers&&o&&(delete this._cache[i],delete this._cells[s],delete this._activeCells[s])}}},this))},resetStyle(){return this.options.style=this._originalStyle,this.eachFeature(function(t){this.resetFeatureStyle(t.feature.id)},this),this},setStyle(t){return this.options.style=t,this.eachFeature(function(e){this.setFeatureStyle(e.feature.id,t)},this),this},resetFeatureStyle(t){const e=this._layers[t],i=this._originalStyle||a.Path.prototype.options;return e&&(a.Util.extend(e.options,e.defaultOptions),this.setFeatureStyle(t,i)),this},setFeatureStyle(t,e){const i=this._layers[t];return typeof e=="function"&&(e=e(i.feature)),i.setStyle&&i.setStyle(e),this},eachActiveFeature(t,e){if(this._map){const i=this._map.getBounds();for(const s in this._layers)this._currentSnapshot.indexOf(this._layers[s].feature.id)!==-1&&(typeof this._layers[s].getLatLng=="function"&&i.contains(this._layers[s].getLatLng())?t.call(e,this._layers[s]):typeof this._layers[s].getBounds=="function"&&i.intersects(this._layers[s].getBounds())&&t.call(e,this._layers[s]))}return this},eachFeature(t,e){for(const i in this._layers)t.call(e,this._layers[i]);return this},getFeature(t){return this._layers[t]},bringToBack(){this.eachFeature(t=>{t.bringToBack&&t.bringToBack()})},bringToFront(){this.eachFeature(t=>{t.bringToFront&&t.bringToFront()})},redraw(t){return t&&this._redraw(t),this},_redraw(t){const e=this._layers[t],i=e.feature;if(e&&e.setIcon&&this.options.pointToLayer&&this.options.pointToLayer){const r=this.options.pointToLayer(i,a.latLng(i.geometry.coordinates[1],i.geometry.coordinates[0])).options.icon;e.setIcon(r)}if(e&&e.setStyle&&this.options.pointToLayer){const r=this.options.pointToLayer(i,a.latLng(i.geometry.coordinates[1],i.geometry.coordinates[0])).options;this.setFeatureStyle(i.id,r)}e&&e.setStyle&&this.options.style&&this.resetFeatureStyle(i.id)},openPopup(t){return this._popup&&this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map),this},openTooltip(t){return this._tooltip&&this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this)),this}});const Ri={name:"PredictionSimulationHeader",props:{title:{type:String,default:"预警分析"}}},Pi={class:"header"},Di={class:"header-content"},Fi={class:"logo-container"},Oi={class:"title"},ki={class:"title-icons"};function Mi(t,e,i,s,r,n){const o=se("router-link");return R(),P("header",Pi,[l("div",Di,[l("div",Fi,[W(o,{to:"/",class:"back-button",title:"返回主页"},{default:V(()=>e[0]||(e[0]=[l("img",{src:Qe,alt:"返回",width:"32",height:"32"},null,-1)])),_:1,__:[0]})]),l("h1",Oi,L(i.title),1),l("div",ki,[W(o,{to:"/map-editor",class:"action-icon",title:"电子地图编辑"},{default:V(()=>e[1]||(e[1]=[l("img",{src:ze,alt:"电子地图编辑",width:"32",height:"32"},null,-1)])),_:1,__:[1]}),W(o,{to:"/data-management",class:"action-icon",title:"数据管理"},{default:V(()=>e[2]||(e[2]=[l("img",{src:Ue,alt:"数据管理",width:"32",height:"32"},null,-1)])),_:1,__:[2]}),W(o,{to:"/statistics-analysis",class:"action-icon",title:"统计分析"},{default:V(()=>e[3]||(e[3]=[l("img",{src:qe,alt:"统计分析",width:"32",height:"32"},null,-1)])),_:1,__:[3]}),W(o,{to:"/prediction-simulation",class:"action-icon",title:"预警分析"},{default:V(()=>e[4]||(e[4]=[l("img",{src:Ne,alt:"预警分析",width:"32",height:"32"},null,-1)])),_:1,__:[4]}),W(o,{to:"/water-pollution-simulation",class:"action-icon",title:"水污染扩散模拟"},{default:V(()=>e[5]||(e[5]=[l("img",{src:Ze,alt:"水污染扩散模拟",width:"32",height:"32"},null,-1)])),_:1,__:[5]})])])])}const Ei=ie(Ri,[["render",Mi],["__scopeId","data-v-5fcb6549"]]);const Bi={name:"PredictionSimulation",components:{PredictionSimulationHeader:Ei},setup(){let t=null;const e=b(null),i=b(!1),s=b(!1),r=b(!1),n=b(!1),o=b(!1),h=b(null),d=b(null),c=b(!1),m=b(null),w=b(null),D=b(!1),bt=b({x:0,y:0}),wt=b({x:0,y:0}),xt=b({x:0,y:0}),et=b({x:0,y:0}),X=b(null),qt=b(null);let z=null,U=null;const Y=b({district:!0,waterLine:!0,reservoir:!0}),it=b({district:"#b3e5fc",waterLine:"#64B5F6",reservoir:"#26C6DA"});let y={district:null,waterLine:null,reservoir:null},q=[];const N=b({selectedReservoir:"",bufferDistance:1e3,simWaterLevel:105,duration:24,rainfall:10,overlayLayers:{resident:!1,road:!1,farmland:!1}}),O=b({area:0,maxDepth:0,affectedSettlements:0,affectedPopulation:0,affectedFarmland:0,impactLevel:"low",impactAnalysis:""}),st=b(!1),rt=b("depth"),Lt=b(null),St=b(null);let nt=null,ot=null;const fe=()=>{s.value=!s.value},ye={backgroundColor:"#11233b",tooltip:{trigger:"axis"},legend:{data:["历史水位","预测水位","警戒水位"],textStyle:{color:"#fff"},top:10},grid:{left:40,right:20,top:50,bottom:40},xAxis:{type:"category",data:["07-01","07-02","07-03","07-04","07-05","07-06","07-07","07-08","07-09","07-10","07-11","07-12"],axisLine:{lineStyle:{color:"#4bbfff"}},axisLabel:{color:"#fff"}},yAxis:{type:"value",name:"水位 (m)",min:94,max:114,axisLine:{lineStyle:{color:"#4bbfff"}},axisLabel:{color:"#fff"},splitLine:{lineStyle:{color:"#223a5b"}}},series:[{name:"历史水位",type:"line",data:[95.5,96.2,97.1,97.8,98.6,99.3,100.1,101.2,102.3,103.5,104.8,105.02],lineStyle:{color:"#4bbfff"},itemStyle:{color:"#4bbfff"},symbol:"circle",symbolSize:7},{name:"预测水位",type:"line",data:[null,null,null,null,null,null,null,null,null,103.5,107.2,112.5],lineStyle:{color:"#ff5c5c",type:"dashed"},itemStyle:{color:"#ff5c5c"},symbol:"circle",symbolSize:7},{name:"警戒水位",type:"line",data:[110.8,110.8,110.8,110.8,110.8,110.8,110.8,110.8,110.8,110.8,110.8,110.8],lineStyle:{color:"#ffb74d",type:"dotted"},itemStyle:{color:"#ffb74d"},symbol:"none"}]},ge={backgroundColor:"#fff",tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["输入水位 (m)","警戒水位 (m)"],textStyle:{color:"#333"},top:0,right:10},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",data:["主坝","北岸","南岸","泄洪道","入库口"],axisLine:{lineStyle:{color:"#666"}},axisLabel:{color:"#333"}},yAxis:{type:"value",name:"水位 (m)",min:0,max:120,axisLine:{lineStyle:{color:"#666"}},axisLabel:{color:"#333"},splitLine:{lineStyle:{color:"#eee"}}},series:[{name:"输入水位 (m)",type:"bar",barWidth:"40%",data:[{value:102.5,itemStyle:{color:"#D68E5E"}},{value:100.2,itemStyle:{color:"#D68E5E"}},{value:99.8,itemStyle:{color:"#49C7D2"}},{value:104.3,itemStyle:{color:"#D25F5F"}},{value:103.7,itemStyle:{color:"#D68E5E"}}]},{name:"警戒水位 (m)",type:"line",markLine:{silent:!0,lineStyle:{color:"#F4A460",type:"dashed"},data:[{yAxis:110}]},data:[110,110,110,110,110],lineStyle:{color:"#F4A460",type:"dashed",width:2},symbol:"none"}]},ve=()=>{t=B.map("prediction-map",{backgroundColor:"#ffffff",zoomControl:!1}).setView([39.9042,116.4074],9),setTimeout(()=>{B.control.zoom({position:"topleft"}).addTo(t)},200)},Nt=async()=>{try{if(Y.value.district){const v=await(await fetch("./Beijing-GeoJson-Tzy/北京区县界.json")).json();q.forEach(g=>{t&&t.hasLayer(g)&&t.removeLayer(g)}),q=[],y.district=B.geoJSON(v,{style:{fillColor:it.value.district,weight:2.5,opacity:.8,color:it.value.district,fillOpacity:.5,dashArray:"5, 8"},onEachFeature:(g,_)=>{if(g.properties){const f=g.properties.name||g.properties.NAME||g.properties.Name||"未命名区县";_.bindPopup(`<b>区县名称:</b> ${f}`);try{const C=_.getBounds().getCenter(),I=B.divIcon({className:"district-label",html:`<div>${f}</div>`,iconSize:[80,30],iconAnchor:[40,15]}),F=B.marker(C,{icon:I,interactive:!1,zIndexOffset:1e3}).addTo(t);q.push(F)}catch(C){console.error("添加区县标注失败:",C,f)}}}}).addTo(t),y.district.bringToBack()}if(Y.value.waterLine){const v=await(await fetch("./Beijing-GeoJson-Tzy/北京市_水系线数据.json")).json();y.waterLine=B.geoJSON(v,{style:{color:it.value.waterLine,weight:2.5,opacity:.9}}).addTo(t),y.district&&t.hasLayer(y.district)&&(y.waterLine.bringToBack(),y.district.bringToBack())}if(Y.value.reservoir){const v=await(await fetch("./Beijing-GeoJson-Tzy/北京市水库面.geojson")).json();y.reservoir=B.geoJSON(v,{style:g=>({fillColor:"#2196F3",weight:1.5,opacity:.9,color:"#2196F3",fillOpacity:.8}),onEachFeature:(g,_)=>{if(g.properties){const f=g.properties.name||g.properties.NAME||g.properties.Name||g.properties.库名||"未命名水库",C={白河堡水库:{汛限水位:"592.6米",当前水位:"591.64米",历史最高水位:"599.13米",最低水位:"578米",多年平均水位:"591.6米"},密云水库:{汛限水位:"152米",当前水位:"154.79米",历史最高水位:"155.59米",最低水位:"126.0米",多年平均水位:"151.8米"},官厅水库:{汛限水位:"476米",当前水位:"478.23米",历史最高水位:"497.0米",最低水位:"471.47米"},怀柔水库:{汛限水位:"58米",当前水位:"57.26米",历史最高水位:"62.13米"},半城子水库:{汛限水位:"255米",当前水位:"253.98米",历史最高水位:"255米"},北台上水库:{汛限水位:"85米",当前水位:"84.34米",历史最高水位:"84.8米"},崇青水库:{汛限水位:"71.5米",当前水位:"67.41米",历史最高水位:"71.5米"},大宁水库:{汛限水位:"48米",当前水位:"47.96米",历史最高水位:"59.29米"},大水峪水库:{汛限水位:"166.4米",当前水位:"166.45米",历史最高水位:"168.9米"},海子水库:{汛限水位:"106.5米",当前水位:"105.87米",历史最高水位:"108.5米"},黄松峪水库:{汛限水位:"203.0米",当前水位:"200.57米",历史最高水位:"203.0米"},沙厂水库:{汛限水位:"165.5米",当前水位:"163.28米",历史最高水位:"165.5米"},十三陵水库:{汛限水位:"93.0米",当前水位:"91.23米",历史最高水位:"91.81米"},桃峪口水库:{汛限水位:"67.7米",当前水位:"64.59米",历史最高水位:"70.23米"},西峪水库:{汛限水位:"213.5米",当前水位:"212.51米",历史最高水位:"213.5米"},遥桥峪水库:{汛限水位:"464.0米",当前水位:"461.34米",历史最高水位:"464.0米"},斋堂水库:{汛限水位:"453.0米",当前水位:"451.27米",历史最高水位:"461.56米"},珠窝水库:{汛限水位:"348.4米",当前水位:"346.69米",历史最高水位:"352.5米"}},I="res-"+Math.random().toString(36).slice(2,8);let F=`<b>水库名称:</b> ${f}`;if(C[f]){F+="<br><br><b>水位信息:</b><br>";const A=C[f],k=ke(f),tt=k!==null?`${k}米`:A.当前水位;F+=`汛限水位: ${A.汛限水位}<br>`,F+=`历史最高水位: ${A.历史最高水位}<br>`,A.最低水位&&(F+=`最低水位: ${A.最低水位}<br>`),A.多年平均水位&&(F+=`多年平均水位: ${A.多年平均水位}`)}F+=`<div style="margin-top:8px;">
                  <input id="water-input-${I}" type="number" step="0.01" placeholder="请输入当前水位" value="" style="width: 100%; box-sizing: border-box;" />
                  <button id="water-analyze-${I}" style="margin-top:6px; display:flex; align-items:center; gap:6px;">
                    <span>🔍</span><span>预警分析</span>
                  </button>
                </div>`,C[f]&&_.setStyle({fillColor:"#2196F3",color:"#2196F3"}),_.bindPopup(F),_.on("popupopen",()=>{const A=document.getElementById(`water-input-${I}`),k=document.getElementById(`water-analyze-${I}`),tt=document.getElementById(`current-level-${I}`);A&&tt&&A.addEventListener("input",()=>{const T=A.value;tt.textContent=T?`${T}米`:`${(C[f]||{}).当前水位||""}`,T&&jt(f,parseFloat(T))}),k&&A&&k.addEventListener("click",()=>{const T=parseFloat(A.value);if(isNaN(T)){alert("请输入有效的水位");return}jt(f,T);const j=C[f]||{},S=parseFloat((j.汛限水位||"").toString().replace(/[^0-9.\-]/g,""))||0,lt=parseFloat((j.历史最高水位||"").toString().replace(/[^0-9.\-]/g,""))||0,ut=j.多年平均水位?parseFloat((j.多年平均水位||"").toString().replace(/[^0-9.\-]/g,"")):void 0,Z=f==="密云水库"&&T>lt||T>lt?"危险":T>=S?"警戒":"正常",Ge=Z==="危险"?"danger":Z==="警戒"?"warning":"normal",Qt=Z==="危险"?"#F44336":Z==="警戒"?"#FFA500":"#2196F3";_.setStyle({fillColor:Qt,color:Qt}),h.value={pointName:f,inputValue:T,floodLimit:S,maxLevel:lt,avgLevel:ut,status:Z,statusClass:Ge,summary:Z==="危险"?f==="密云水库"?"输入水位已超过历史最高水位，请立即启动危险水位应急响应。":"输入水位已超过历史极值，请立即启动最高级应急响应。":Z==="警戒"?"输入水位已达汛限水位，需加强监测并启动警戒预案。":"输入水位处于安全范围。"},setTimeout(()=>{o.value=!0},1e3)})}),_.on("click",A=>{console.log("点击水库:",f)})}}}).addTo(t),y.waterLine&&t.hasLayer(y.waterLine)&&(y.reservoir.bringToBack(),y.waterLine.bringToBack()),y.district&&t.hasLayer(y.district)&&y.district.bringToBack()}const u=[];if(Object.values(y).forEach(p=>{p&&u.push(p)}),u.length>0){const p=B.featureGroup(u);t.fitBounds(p.getBounds())}}catch(u){console.error("加载预警分析图层失败:",u)}},_e=u=>{Y.value[u]?y[u]?(y[u].addTo(t),u==="district"?(y[u].bringToBack(),q.forEach(p=>{t.hasLayer(p)||p.addTo(t)})):u==="waterLine"?y.district&&t.hasLayer(y.district)&&(y[u].bringToBack(),y.district.bringToBack()):u==="reservoir"&&(y.waterLine&&t.hasLayer(y.waterLine)&&(y[u].bringToBack(),y.waterLine.bringToBack()),y.district&&t.hasLayer(y.district)&&y.district.bringToBack())):Nt():y[u]&&(t.removeLayer(y[u]),u==="district"&&q.forEach(p=>{t.hasLayer(p)&&t.removeLayer(p)}))},be=async()=>{var u,p;i.value=!i.value,i.value&&(await K(),console.log("echartsRef:",X.value,"width:",(u=X.value)==null?void 0:u.offsetWidth,"height:",(p=X.value)==null?void 0:p.offsetHeight),z||(z=ct(X.value)),z.setOption(ye),z.resize())},we=async()=>{r.value=!r.value,r.value&&(await K(),U||(console.log("Initializing monitoring chart..."),U=ct(qt.value)),U.setOption(ge),U.resize())},xe=()=>{n.value=!n.value},Le=()=>{o.value=!1,h.value=null,wt.value={x:0,y:0},d.value&&(d.value.style.transform="translate(0, 0)"),c.value&&w.value&&K(()=>{w.value.style.transform="translate(0, 0)",et.value={x:0,y:0}})},Se=u=>{if(!u.target.closest(".analysis-modal-header"))return;D.value=!0;const p=d.value.getBoundingClientRect();bt.value={x:u.clientX-p.left,y:u.clientY-p.top},document.addEventListener("mousemove",Zt),document.addEventListener("mouseup",Wt),u.preventDefault()},Zt=u=>{if(!D.value)return;const p=u.clientX-bt.value.x,v=u.clientY-bt.value.y,g=d.value.offsetWidth;d.value.offsetHeight;const _=window.innerWidth,f=window.innerHeight,C=Math.max(-g+100,Math.min(_-100,p)),I=Math.max(0,Math.min(f-100,v));wt.value={x:C,y:I},d.value.style.transform=`translate(${C}px, ${I}px)`},Wt=()=>{D.value=!1,document.removeEventListener("mousemove",Zt),document.removeEventListener("mouseup",Wt)},Ce=()=>{c.value=!1,m.value=null,et.value={x:0,y:0},w.value&&(w.value.style.transform="translate(0, 0)"),o.value&&d.value&&K(()=>{d.value.style.transform="translate(0, 0)",wt.value={x:0,y:0}})},Ae=u=>{if(!u.target.closest(".analysis-modal-header"))return;D.value=!0;const p=w.value.getBoundingClientRect();xt.value={x:u.clientX-p.left,y:u.clientY-p.top},document.addEventListener("mousemove",$t),document.addEventListener("mouseup",Jt),u.preventDefault()},$t=u=>{if(!D.value)return;const p=u.clientX-xt.value.x,v=u.clientY-xt.value.y,g=w.value.offsetWidth;w.value.offsetHeight;const _=window.innerWidth,f=window.innerHeight,C=Math.max(-g+100,Math.min(_-100,p)),I=Math.max(0,Math.min(f-100,v));et.value={x:C,y:I},w.value.style.transform=`translate(${C}px, ${I}px)`},Jt=()=>{D.value=!1,document.removeEventListener("mousemove",$t),document.removeEventListener("mouseup",Jt)},Ie=u=>{var I,F,A;const p=((I=h.value)==null?void 0:I.pointName)||"未知水库",v=((F=h.value)==null?void 0:F.inputValue)||0,g=((A=h.value)==null?void 0:A.maxLevel)||0;let _="",f=[];const C=(k,tt,T,j)=>{var ut;const S=T>j+3;return((ut={密云水库:{warning:["加密大坝巡查（2小时一次）","向下游乡镇、北京市水务局滚动报送水情","启动二级应急响应","视雨情提前6小时开启泄洪闸，控制下泄≤100m³/s","保证下游河道不超警戒流量","加强气象监测和预报","检查泄洪设施运行状态","通知密云区防汛指挥部","准备应急抢险物资和队伍"],danger:["开启全部泄洪闸，最大下泄500m³/s","提前24小时组织下游密云、怀柔等区县人员转移","启动一级（最高级）应急响应","实施24小时不间断监测","协调下游河道清障和分洪准备","启动应急广播和预警信号","建立现场指挥部","联系医疗救援和后勤保障队伍","向市委市政府紧急报告"]},十三陵水库:{warning:["加密大坝巡查（2小时一次）","向下游昌平区防汛指挥部滚动报送水情","启动二级应急响应","视雨情提前6小时开启溢洪道，控制下泄≤15m³/s","保证下游东沙河不超警戒流量","加强气象监测和预报","检查泄洪设施运行状态","通知昌平区防汛指挥部","准备应急抢险物资和队伍"],danger:S?["启动特级应急响应（最高级别）","溢洪道全开，下泄30m³/s，启用备用溢洪道","提前36h封闭东沙河沿线道路、转移昌平区沿河5村2000余人","抢险队伍300人、砂石料5000t现场待命","启动国家级应急响应，请求中央支援","建立昌平区应急指挥部，协调全区力量","启用直升机空中监测和救援","组织武警、消防等专业救援力量进驻","建立临时医疗救治点和物资储备中心","实施交通管制，确保救援通道畅通","启动卫星通信和应急通信系统","组织专家团队现场评估大坝安全状况","启动媒体24小时滚动播报，发布紧急通告","协调周边水库联合调度，减轻压力","准备启用下游蓄滞洪区进行分洪"]:["溢洪道全开，下泄25m³/s","提前24小时组织东沙河沿线人员转移","启动一级（最高级）应急响应","实施24小时不间断监测","协调下游河道清障和分洪准备","启动应急广播和预警信号","建立现场指挥部","联系医疗救援和后勤保障队伍","向市委市政府紧急报告"]},官厅水库:{warning:["加密大坝、泄洪闸巡检","向永定河流域防汛指挥部和京津冀三地防指滚动通报","启动二级应急响应","每2小时向各级防汛部门报告水情","检查泄洪设施运行状态","通知下游永定河沿线做好防洪准备","协调河北省张家口市联防联控","准备应急抢险物资和队伍","加强气象水文监测"],danger:S?["京津冀三地联动特级响应（最高级别）","最大下泄3500m³/s，启用所有泄洪设施","永定河泛区、三角淀蓄滞洪区提前分洪","固安、大兴等6乡镇2.1万人提前48h转移","启动国家级应急响应，请求中央支援","建立京津冀三地联合指挥部，协调三省力量","启用备用泄洪通道和应急溢洪道","组织武警、消防、解放军等专业救援力量进驻","启动直升机空中监测和救援","建立跨省市临时医疗救治点和物资储备中心","实施跨省市交通管制，确保救援通道畅通","启动卫星通信和应急通信系统","组织国家级专家团队现场评估大坝安全状况","启动媒体24小时滚动播报，发布紧急通告","协调周边水库联合调度，减轻压力","准备启用更多下游蓄滞洪区进行分洪","建立跨省市应急物资调配机制"]:["开启全部泄洪孔，最大下泄3500m³/s","下游永定河泛区、三角淀蓄滞洪区做好分洪准备","提前48小时组织河北固安、北京大兴等6个乡镇2.1万人转移","启动一级（最高级）应急响应","实施24小时现场指挥","协调京津冀三省市联合调度","启动流域性应急广播系统","建立跨省市医疗救援体系","请求水利部和国家防总支援","向国务院和相关省市政府紧急报告"]},海子水库:{warning:["加密大坝巡查（2小时一次）","向下游平谷区防汛指挥部滚动报送水情","启动二级应急响应","视雨情提前6小时开启泄洪闸，控制下泄≤50m³/s","保证下游河道不超警戒流量","加强气象监测和预报","检查泄洪设施运行状态","通知平谷区防汛指挥部","准备应急抢险物资和队伍"],danger:S?["启动特级应急响应（最高级别）","立即预腾库容，加大下泄削峰","重点河段拉警戒线、设警示标志","加密监测（小时级）","断电时启用备用电源+移动发电机保障闸门启闭","启动国家级应急响应，请求中央支援","建立平谷区应急指挥部，协调全区力量","启用备用泄洪通道和应急溢洪道","组织武警、消防等专业救援力量进驻","启动直升机空中监测和救援","建立临时医疗救治点和物资储备中心","实施交通管制，确保救援通道畅通","启动卫星通信和应急通信系统","组织专家团队现场评估大坝安全状况","启动媒体24小时滚动播报，发布紧急通告","协调周边水库联合调度，减轻压力","准备启用下游蓄滞洪区进行分洪"]:["开启全部泄洪闸，最大下泄200m³/s","提前24小时组织下游平谷区人员转移","启动一级（最高级）应急响应","实施24小时不间断监测","协调下游河道清障和分洪准备","启动应急广播和预警信号","建立现场指挥部","联系医疗救援和后勤保障队伍","向市委市政府紧急报告"]},白河堡水库:{warning:["加密大坝巡查（2小时一次）","向下游乡镇、北京市水务局、官厅水库管理处滚动报送水情","启动二级应急响应","视雨情提前6小时开启泄洪洞，控制下泄≤20m³/s","保证下游河道不超警戒流量","加强气象监测和预报","检查泄洪设施运行状态","通知延庆区防汛指挥部","准备应急抢险物资和队伍"],danger:S?["启动特级应急响应（最高级别）","泄洪洞与输水洞全开，最大下泄80m³/s，启用备用泄洪设施","提前12小时组织白河峡谷及张山营镇5个险村680人转移","请求市防指调派武警水电部队进驻坝区抢险","启动一级（最高级）应急响应，实施24小时不间断监测","启动国家级应急响应，请求中央支援","建立延庆区应急指挥部，协调全区力量","启用备用泄洪通道和应急溢洪道","组织武警、消防等专业救援力量进驻","启动直升机空中监测和救援","建立临时医疗救治点和物资储备中心","实施交通管制，确保救援通道畅通","启动卫星通信和应急通信系统","组织专家团队现场评估大坝安全状况","启动媒体24小时滚动播报，发布紧急通告","协调周边水库联合调度，减轻压力","准备启用下游蓄滞洪区进行分洪"]:["泄洪洞与输水洞全开，最大下泄60m³/s","提前12小时组织白河峡谷及张山营镇5个险村680人转移","请求市防指调派武警水电部队进驻坝区抢险","启动一级（最高级）应急响应","实施24小时不间断监测","协调下游河道清障和分洪准备","启动应急广播和预警信号","建立现场指挥部","联系医疗救援和后勤保障队伍","向市委市政府紧急报告"]},怀柔水库:{warning:["加密大坝巡查（2小时一次）","向下游怀柔区防汛指挥部滚动报送水情","启动二级应急响应","视雨情提前6小时开启泄洪闸，控制下泄≤30m³/s","保证下游河道不超警戒流量","加强气象监测和预报","检查泄洪设施运行状态","通知怀柔区防汛指挥部","准备应急抢险物资和队伍"],danger:S?["启动特级应急响应（最高级别）","泄洪闸全开，最大下泄150m³/s，启用备用泄洪设施","提前24小时组织怀柔区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测，协调下游河道清障","启动国家级应急响应，请求中央支援","建立怀柔区应急指挥部，协调全区力量","启用备用泄洪通道和应急溢洪道","组织武警、消防等专业救援力量进驻","启动直升机空中监测和救援","建立临时医疗救治点和物资储备中心","实施交通管制，确保救援通道畅通","启动卫星通信和应急通信系统","组织专家团队现场评估大坝安全状况","启动媒体24小时滚动播报，发布紧急通告","协调周边水库联合调度，减轻压力","准备启用下游蓄滞洪区进行分洪"]:["开启全部泄洪闸，最大下泄100m³/s","提前24小时组织怀柔区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测","协调下游河道清障和分洪准备","启动应急广播和预警信号","建立现场指挥部","联系医疗救援和后勤保障队伍","向市委市政府紧急报告"]},北台上水库:{warning:["加密大坝巡查（2小时一次）","向下游怀柔区防汛指挥部滚动报送水情","启动二级应急响应","视雨情提前6小时开启泄洪闸，控制下泄≤20m³/s","保证下游河道不超警戒流量","加强气象监测和预报","检查泄洪设施运行状态","通知怀柔区防汛指挥部","准备应急抢险物资和队伍"],danger:S?["启动特级应急响应（最高级别）","泄洪闸全开，最大下泄80m³/s，启用备用泄洪设施","提前24小时组织怀柔区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测，协调下游河道清障","启动国家级应急响应，请求中央支援","建立怀柔区应急指挥部，协调全区力量","启用备用泄洪通道和应急溢洪道","组织武警、消防等专业救援力量进驻","启动直升机空中监测和救援","建立临时医疗救治点和物资储备中心","实施交通管制，确保救援通道畅通","启动卫星通信和应急通信系统","组织专家团队现场评估大坝安全状况","启动媒体24小时滚动播报，发布紧急通告","协调周边水库联合调度，减轻压力","准备启用下游蓄滞洪区进行分洪"]:["开启全部泄洪闸，最大下泄60m³/s","提前24小时组织怀柔区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测","协调下游河道清障和分洪准备","启动应急广播和预警信号","建立现场指挥部","联系医疗救援和后勤保障队伍","向市委市政府紧急报告"]},崇青水库:{warning:["加密大坝巡查（2小时一次）","向下游房山区防汛指挥部滚动报送水情","启动二级应急响应","视雨情提前6小时开启泄洪闸，控制下泄≤25m³/s","保证下游河道不超警戒流量","加强气象监测和预报","检查泄洪设施运行状态","通知房山区防汛指挥部","准备应急抢险物资和队伍"],danger:S?["启动特级应急响应（最高级别）","泄洪闸全开，最大下泄100m³/s，启用备用泄洪设施","提前24小时组织房山区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测，协调下游河道清障","启动国家级应急响应，请求中央支援","建立房山区应急指挥部，协调全区力量","启用备用泄洪通道和应急溢洪道","组织武警、消防等专业救援力量进驻","启动直升机空中监测和救援","建立临时医疗救治点和物资储备中心","实施交通管制，确保救援通道畅通","启动卫星通信和应急通信系统","组织专家团队现场评估大坝安全状况","启动媒体24小时滚动播报，发布紧急通告","协调周边水库联合调度，减轻压力","准备启用下游蓄滞洪区进行分洪"]:["开启全部泄洪闸，最大下泄80m³/s","提前24小时组织房山区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测","协调下游河道清障和分洪准备","启动应急广播和预警信号","建立现场指挥部","联系医疗救援和后勤保障队伍","向市委市政府紧急报告"]},大宁水库:{warning:["加密大坝巡查（2小时一次）","向下游丰台区防汛指挥部滚动报送水情","启动二级应急响应","视雨情提前6小时开启泄洪闸，控制下泄≤30m³/s","保证下游河道不超警戒流量","加强气象监测和预报","检查泄洪设施运行状态","通知丰台区防汛指挥部","准备应急抢险物资和队伍"],danger:S?["启动特级应急响应（最高级别）","泄洪闸全开，最大下泄120m³/s，启用备用泄洪设施","提前24小时组织丰台区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测，协调下游河道清障","启动国家级应急响应，请求中央支援","建立丰台区应急指挥部，协调全区力量","启用备用泄洪通道和应急溢洪道","组织武警、消防等专业救援力量进驻","启动直升机空中监测和救援","建立临时医疗救治点和物资储备中心","实施交通管制，确保救援通道畅通","启动卫星通信和应急通信系统","组织专家团队现场评估大坝安全状况","启动媒体24小时滚动播报，发布紧急通告","协调周边水库联合调度，减轻压力","准备启用下游蓄滞洪区进行分洪"]:["开启全部泄洪闸，最大下泄100m³/s","提前24小时组织丰台区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测","协调下游河道清障和分洪准备","启动应急广播和预警信号","建立现场指挥部","联系医疗救援和后勤保障队伍","向市委市政府紧急报告"]},大水峪水库:{warning:["加密大坝巡查（2小时一次）","向下游怀柔区防汛指挥部滚动报送水情","启动二级应急响应","视雨情提前6小时开启泄洪闸，控制下泄≤25m³/s","保证下游河道不超警戒流量","加强气象监测和预报","检查泄洪设施运行状态","通知怀柔区防汛指挥部","准备应急抢险物资和队伍"],danger:S?["启动特级应急响应（最高级别）","泄洪闸全开，最大下泄100m³/s，启用备用泄洪设施","提前24小时组织怀柔区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测，协调下游河道清障","启动国家级应急响应，请求中央支援","建立怀柔区应急指挥部，协调全区力量","启用备用泄洪通道和应急溢洪道","组织武警、消防等专业救援力量进驻","启动直升机空中监测和救援","建立临时医疗救治点和物资储备中心","实施交通管制，确保救援通道畅通","启动卫星通信和应急通信系统","组织专家团队现场评估大坝安全状况","启动媒体24小时滚动播报，发布紧急通告","协调周边水库联合调度，减轻压力","准备启用下游蓄滞洪区进行分洪"]:["开启全部泄洪闸，最大下泄80m³/s","提前24小时组织怀柔区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测","协调下游河道清障和分洪准备","启动应急广播和预警信号","建立现场指挥部","联系医疗救援和后勤保障队伍","向市委市政府紧急报告"]},黄松峪水库:{warning:["加密大坝巡查（2小时一次）","向下游平谷区防汛指挥部滚动报送水情","启动二级应急响应","视雨情提前6小时开启泄洪闸，控制下泄≤20m³/s","保证下游河道不超警戒流量","加强气象监测和预报","检查泄洪设施运行状态","通知平谷区防汛指挥部","准备应急抢险物资和队伍"],danger:S?["启动特级应急响应（最高级别）","泄洪闸全开，最大下泄80m³/s，启用备用泄洪设施","提前24小时组织平谷区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测，协调下游河道清障","启动国家级应急响应，请求中央支援","建立平谷区应急指挥部，协调全区力量","启用备用泄洪通道和应急溢洪道","组织武警、消防等专业救援力量进驻","启动直升机空中监测和救援","建立临时医疗救治点和物资储备中心","实施交通管制，确保救援通道畅通","启动卫星通信和应急通信系统","组织专家团队现场评估大坝安全状况","启动媒体24小时滚动播报，发布紧急通告","协调周边水库联合调度，减轻压力","准备启用下游蓄滞洪区进行分洪"]:["开启全部泄洪闸，最大下泄60m³/s","提前24小时组织平谷区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测","协调下游河道清障和分洪准备","启动应急广播和预警信号","建立现场指挥部","联系医疗救援和后勤保障队伍","向市委市政府紧急报告"]},沙厂水库:{warning:["加密大坝巡查（2小时一次）","向下游密云区防汛指挥部滚动报送水情","启动二级应急响应","视雨情提前6小时开启泄洪闸，控制下泄≤25m³/s","保证下游河道不超警戒流量","加强气象监测和预报","检查泄洪设施运行状态","通知密云区防汛指挥部","准备应急抢险物资和队伍"],danger:S?["启动特级应急响应（最高级别）","泄洪闸全开，最大下泄100m³/s，启用备用泄洪设施","提前24小时组织密云区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测，协调下游河道清障","启动国家级应急响应，请求中央支援","建立密云区应急指挥部，协调全区力量","启用备用泄洪通道和应急溢洪道","组织武警、消防等专业救援力量进驻","启动直升机空中监测和救援","建立临时医疗救治点和物资储备中心","实施交通管制，确保救援通道畅通","启动卫星通信和应急通信系统","组织专家团队现场评估大坝安全状况","启动媒体24小时滚动播报，发布紧急通告","协调周边水库联合调度，减轻压力","准备启用下游蓄滞洪区进行分洪"]:["开启全部泄洪闸，最大下泄80m³/s","提前24小时组织密云区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测","协调下游河道清障和分洪准备","启动应急广播和预警信号","建立现场指挥部","联系医疗救援和后勤保障队伍","向市委市政府紧急报告"]},桃峪口水库:{warning:["加密大坝巡查（2小时一次）","向下游昌平区防汛指挥部滚动报送水情","启动二级应急响应","视雨情提前6小时开启泄洪闸，控制下泄≤20m³/s","保证下游河道不超警戒流量","加强气象监测和预报","检查泄洪设施运行状态","通知昌平区防汛指挥部","准备应急抢险物资和队伍"],danger:S?["泄洪闸全开，最大下泄80m³/s","提前24小时组织昌平区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测，协调下游河道清障"]:["开启全部泄洪闸，最大下泄60m³/s","提前24小时组织昌平区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测","协调下游河道清障和分洪准备","启动应急广播和预警信号","建立现场指挥部","联系医疗救援和后勤保障队伍","向市委市政府紧急报告"]},西峪水库:{warning:["加密大坝巡查（2小时一次）","向下游平谷区防汛指挥部滚动报送水情","启动二级应急响应","视雨情提前6小时开启泄洪闸，控制下泄≤20m³/s","保证下游河道不超警戒流量","加强气象监测和预报","检查泄洪设施运行状态","通知平谷区防汛指挥部","准备应急抢险物资和队伍"],danger:S?["启动特级应急响应（最高级别）","泄洪闸全开，最大下泄80m³/s，启用备用泄洪设施","提前24小时组织平谷区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测，协调下游河道清障","启动国家级应急响应，请求中央支援","建立平谷区应急指挥部，协调全区力量","启用备用泄洪通道和应急溢洪道","组织武警、消防等专业救援力量进驻","启动直升机空中监测和救援","建立临时医疗救治点和物资储备中心","实施交通管制，确保救援通道畅通","启动卫星通信和应急通信系统","组织专家团队现场评估大坝安全状况","启动媒体24小时滚动播报，发布紧急通告","协调周边水库联合调度，减轻压力","准备启用下游蓄滞洪区进行分洪"]:["开启全部泄洪闸，最大下泄60m³/s","提前24小时组织平谷区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测","协调下游河道清障和分洪准备","启动应急广播和预警信号","建立现场指挥部","联系医疗救援和后勤保障队伍","向市委市政府紧急报告"]},遥桥峪水库:{warning:["加密大坝巡查（2小时一次）","向下游密云区防汛指挥部滚动报送水情","启动二级应急响应","视雨情提前6小时开启泄洪闸，控制下泄≤20m³/s","保证下游河道不超警戒流量","加强气象监测和预报","检查泄洪设施运行状态","通知密云区防汛指挥部","准备应急抢险物资和队伍"],danger:S?["泄洪闸全开，最大下泄80m³/s","提前24小时组织密云区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测，协调下游河道清障"]:["开启全部泄洪闸，最大下泄60m³/s","提前24小时组织密云区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测","协调下游河道清障和分洪准备","启动应急广播和预警信号","建立现场指挥部","联系医疗救援和后勤保障队伍","向市委市政府紧急报告"]},斋堂水库:{warning:["加密大坝巡查（2小时一次）","向下游门头沟区防汛指挥部滚动报送水情","启动二级应急响应","视雨情提前6小时开启泄洪闸，控制下泄≤20m³/s","保证下游河道不超警戒流量","加强气象监测和预报","检查泄洪设施运行状态","通知门头沟区防汛指挥部","准备应急抢险物资和队伍"],danger:S?["泄洪闸全开，最大下泄80m³/s","提前24小时组织门头沟区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测，协调下游河道清障"]:["开启全部泄洪闸，最大下泄60m³/s","提前24小时组织门头沟区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测","协调下游河道清障和分洪准备","启动应急广播和预警信号","建立现场指挥部","联系医疗救援和后勤保障队伍","向市委市政府紧急报告"]},珠窝水库:{warning:["加密大坝巡查（2小时一次）","向下游门头沟区防汛指挥部滚动报送水情","启动二级应急响应","视雨情提前6小时开启泄洪闸，控制下泄≤20m³/s","保证下游河道不超警戒流量","加强气象监测和预报","检查泄洪设施运行状态","通知门头沟区防汛指挥部","准备应急抢险物资和队伍"],danger:S?["泄洪闸全开，最大下泄80m³/s","提前24小时组织门头沟区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测，协调下游河道清障"]:["开启全部泄洪闸，最大下泄60m³/s","提前24小时组织门头沟区沿河人员转移","启动一级（最高级）应急响应","实施24小时不间断监测","协调下游河道清障和分洪准备","启动应急广播和预警信号","建立现场指挥部","联系医疗救援和后勤保障队伍","向市委市政府紧急报告"]}}[k])==null?void 0:ut[tt])||[]};u==="warning"?(_=`${p} - 警戒水位应急预案`,f=C(p,"warning",v,g)):u==="danger"&&(_=`${p} - 危险水位应急预案`,f=C(p,"danger",v,g)),f.length===0&&(u==="warning"?f=["立即启动二级应急响应","加强水位监测，每30分钟上报一次水位数据","检查并准备启用泄洪设施","通知下游相关部门和居民做好防洪准备","调度应急抢险队伍和物资到位","密切关注天气变化，做好预测预报","按规定向上级部门报告水情险情","准备启动下一级应急响应措施"]:f=["立即启动一级（最高级）应急响应","紧急开启所有泄洪设施，最大流量泄洪","立即疏散下游危险区域所有人员","24小时不间断监测水位变化","启动应急抢险救援队伍，现场待命","立即向省市防汛指挥部报告紧急情况","协调周边水库联合调度，减轻压力","准备水库大坝抢险应急措施","启动媒体预警，发布紧急通告","联系武警、消防等专业救援力量"]),m.value={title:_,type:u,reservoirName:p,currentLevel:v,measures:f},c.value=!0,requestAnimationFrame(()=>{if(w.value){const k=o.value?250:0;w.value.style.transform=`translate(${k}px, 0)`,et.value={x:k,y:0}}})},Te=()=>{if(!N.value.selectedReservoir){alert("请先选择水库");return}const u=50+Math.random()*100,p=2+Math.random()*5,v=(N.value.simWaterLevel-100)/20,g=N.value.rainfall/50;O.value={area:u*(1+v+g),maxDepth:p*(1+v),affectedSettlements:Math.floor(5+Math.random()*15),affectedPopulation:Math.floor(1e3+Math.random()*5e3),affectedFarmland:u*.3*(1+v),impactLevel:Pe(v+g),impactAnalysis:Oe(v+g)},st.value=!0,K(()=>{Vt()})},Re=()=>{N.value={selectedReservoir:"",bufferDistance:1e3,simWaterLevel:105,duration:24,rainfall:10,overlayLayers:{resident:!1,road:!1,farmland:!1}},st.value=!1},Pe=u=>u<.5?"low":u<1?"medium":"high",De=u=>{switch(u){case"low":return"impact-low";case"medium":return"impact-medium";case"high":return"impact-high";default:return"impact-low"}},Fe=u=>{switch(u){case"low":return"低风险";case"medium":return"中风险";case"high":return"高风险";default:return"低风险"}},Oe=u=>u<.5?"当前淹没情况对周边环境影响较小，主要影响低洼农田和部分道路。建议加强监测，做好防洪准备。":u<1?"淹没范围较大，可能影响部分居民区和重要基础设施。需要启动应急预案，组织人员疏散。":"淹没情况严重，可能造成重大损失。建议立即启动最高级别应急响应，全面组织救援和疏散工作。",Ct=u=>`ps:reservoir:currentLevel:${u}`,jt=(u,p)=>{try{localStorage.setItem(Ct(u),String(p))}catch{}},ke=u=>{try{const p=localStorage.getItem(Ct(u));return p!==null&&p!==""&&!isNaN(Number(p))?Number(p):null}catch{return null}},Me=()=>{try{["白河堡水库","密云水库","官厅水库","怀柔水库","半城子水库","北台上水库","崇青水库","大宁水库","大水峪水库","海子水库","黄松峪水库","沙厂水库","十三陵水库","桃峪口水库","斋堂水库","珠窝水库"].forEach(p=>{localStorage.removeItem(Ct(p))}),console.log("已清空所有水库的水位数据")}catch(u){console.error("清空水库水位数据失败:",u)}},Ee=()=>{try{const u={analysisData:h.value,showAnalysisModal:o.value,showPlanModal:c.value,planData:m.value,timestamp:Date.now()};localStorage.setItem("ps:analysisState",JSON.stringify(u)),console.log("已保存分析状态")}catch(u){console.error("保存分析状态失败:",u)}},at=()=>{try{const u=localStorage.getItem("ps:analysisState");if(u){const p=JSON.parse(u);if(Date.now()-p.timestamp<24*60*60*1e3)return h.value=p.analysisData,o.value=p.showAnalysisModal,c.value=p.showPlanModal,m.value=p.planData,console.log("已恢复分析状态"),!0;localStorage.removeItem("ps:analysisState")}return!1}catch(u){return console.error("恢复分析状态失败:",u),!1}},Be=(u,p,v)=>{if(Ee(),u==="密云水库"&&p==="warning"){const g={0:"/plans/miyun-warning-1.html",1:"/plans/miyun-warning-2.html",2:"/plans/miyun-warning-3.html"};if(v in g){const _=window.open(g[v],"_blank");if(_){const f=setInterval(()=>{_.closed&&(clearInterval(f),at())},1e3)}}}if(u==="密云水库"&&p==="danger"){const g={0:"/plans/miyun-danger-1.html",1:"/plans/miyun-danger-2.html"};if(v in g){const _=window.open(g[v],"_blank");if(_){const f=setInterval(()=>{_.closed&&(clearInterval(f),at())},1e3)}}}},Vt=async()=>{if(rt.value==="depth"&&Lt.value){nt||(nt=ct(Lt.value));const u={backgroundColor:"#fff",tooltip:{trigger:"axis"},legend:{data:["淹没深度分布"],textStyle:{color:"#333"}},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",data:["0-1m","1-2m","2-3m","3-4m","4-5m","5m以上"],axisLine:{lineStyle:{color:"#666"}},axisLabel:{color:"#333"}},yAxis:{type:"value",name:"面积 (km²)",axisLine:{lineStyle:{color:"#666"}},axisLabel:{color:"#333"},splitLine:{lineStyle:{color:"#eee"}}},series:[{name:"淹没深度分布",type:"bar",data:[{value:O.value.area*.3,itemStyle:{color:"#91cc75"}},{value:O.value.area*.25,itemStyle:{color:"#fac858"}},{value:O.value.area*.2,itemStyle:{color:"#ee6666"}},{value:O.value.area*.15,itemStyle:{color:"#73c0de"}},{value:O.value.area*.08,itemStyle:{color:"#3ba272"}},{value:O.value.area*.02,itemStyle:{color:"#fc8452"}}]}]};nt.setOption(u),nt.resize()}if(rt.value==="time"&&St.value){ot||(ot=ct(St.value));const u=[],p=[],v=[];for(let _=0;_<=N.value.duration;_+=2){u.push(_);const f=_/N.value.duration;p.push(O.value.area*f),v.push(O.value.maxDepth*f)}const g={backgroundColor:"#fff",tooltip:{trigger:"axis"},legend:{data:["淹没面积","最大深度"],textStyle:{color:"#333"}},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",data:u,name:"时间 (小时)",axisLine:{lineStyle:{color:"#666"}},axisLabel:{color:"#333"}},yAxis:[{type:"value",name:"面积 (km²)",axisLine:{lineStyle:{color:"#666"}},axisLabel:{color:"#333"},splitLine:{lineStyle:{color:"#eee"}}},{type:"value",name:"深度 (m)",axisLine:{lineStyle:{color:"#666"}},axisLabel:{color:"#333"},splitLine:{show:!1}}],series:[{name:"淹没面积",type:"line",data:p,lineStyle:{color:"#91cc75"},itemStyle:{color:"#91cc75"}},{name:"最大深度",type:"line",yAxisIndex:1,data:v,lineStyle:{color:"#ee6666"},itemStyle:{color:"#ee6666"}}]};ot.setOption(g),ot.resize()}},Ht=u=>{e.value=u,i.value=!1,s.value=!1,r.value=!1,n.value=!1,(u==="warning"||u==="waterLevelWarning"||u==="environmentWarning")&&(Object.values(y).forEach(p=>{p&&t.removeLayer(p)}),Nt())};return We(()=>{at()||Me();const p=()=>{document.hidden||at()};document.addEventListener("visibilitychange",p),setTimeout(()=>{ve(),Ht("waterLevelWarning")},100)}),$e(rt,()=>{st.value&&K(()=>{Vt()})}),Je(()=>{t&&t.remove(),Object.values(y).forEach(u=>{u&&u.remove()}),q.forEach(u=>{u&&u.remove()}),q=[],z&&(z.dispose(),z=null),U&&(U.dispose(),U=null)}),{activeFeature:e,activateFeature:Ht,showTrendDetail:i,toggleTrendDetail:be,echartsRef:X,showReservoirDetail:s,toggleReservoirDetail:fe,showMonitoringDetail:r,toggleMonitoringDetail:we,monitoringChartRef:qt,showWarningDetail:n,toggleWarningDetail:xe,warningLayers:Y,layerColors:it,toggleWarningLayer:_e,floodParams:N,floodResults:O,floodSimulationActive:st,activeTab:rt,depthChartRef:Lt,timeChartRef:St,runFloodSimulation:Te,resetFloodParams:Re,getImpactLevelClass:De,getImpactLevelText:Fe,showAnalysisModal:o,analysisData:h,analysisModalRef:d,closeAnalysisModal:Le,showEmergencyPlan:Ie,handleMeasureClick:Be,startDrag:Se,showPlanModal:c,planData:m,planModalRef:w,closePlanModal:Ce,startPlanDrag:Ae}}},Gi={class:"prediction-simulation-container"},zi={class:"prediction-simulation-content"},Ui={key:0,class:"control-panel"},qi={class:"layer-control"},Ni={class:"layer-color-control"},Zi={class:"layer-control"},Wi={class:"layer-color-control"},$i={class:"layer-control"},Ji={class:"layer-color-control"},ji={key:0,class:"analysis-modal"},Vi={class:"analysis-modal-header"},Hi={key:0,class:"analysis-modal-body"},Qi={class:"status-display-section"},Ki={class:"water-level-comparison"},Xi={class:"comparison-table"},Yi={class:"comparison-row"},ts={class:"value limit"},es={class:"comparison-row"},is={class:"value max"},ss={key:0,class:"comparison-row"},rs={class:"value avg"},ns={class:"analysis-summary"},os={class:"summary-content"},as={key:0,class:"emergency-plan-section"},ls={class:"analysis-modal-footer"},us={key:1,class:"analysis-modal plan-modal"},cs={class:"analysis-modal-header"},hs={key:0,class:"analysis-modal-body",style:{contain:"layout style"}},ds={class:"plan-info-section"},ps={class:"current-level-info"},ms={class:"level-info-content"},fs={class:"emergency-measures"},ys={class:"measures-list"},gs=["onClick"],vs={class:"measure-number"},_s={class:"measure-content"},bs={class:"analysis-modal-footer"};function ws(t,e,i,s,r,n){var h,d;const o=se("prediction-simulation-header");return R(),P("div",Gi,[W(o,{title:"预警分析"}),l("div",zi,[e[20]||(e[20]=l("div",{id:"prediction-map",class:"prediction-map"},null,-1)),s.activeFeature==="warning"||s.activeFeature==="waterLevelWarning"||s.activeFeature==="environmentWarning"?(R(),P("div",Ui,[e[19]||(e[19]=l("h3",null,"图层控制",-1)),l("div",qi,[l("label",null,[At(l("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=c=>s.warningLayers.district=c),onChange:e[1]||(e[1]=c=>s.toggleWarningLayer("district"))},null,544),[[It,s.warningLayers.district]]),e[16]||(e[16]=H(" 区县边界 ",-1))]),l("div",Ni,[l("div",{class:"color-preview",style:Tt({backgroundColor:s.layerColors.district})},null,4)])]),l("div",Zi,[l("label",null,[At(l("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=c=>s.warningLayers.waterLine=c),onChange:e[3]||(e[3]=c=>s.toggleWarningLayer("waterLine"))},null,544),[[It,s.warningLayers.waterLine]]),e[17]||(e[17]=H(" 水系线数据 ",-1))]),l("div",Wi,[l("div",{class:"color-preview",style:Tt({backgroundColor:s.layerColors.waterLine})},null,4)])]),l("div",$i,[l("label",null,[At(l("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=c=>s.warningLayers.reservoir=c),onChange:e[5]||(e[5]=c=>s.toggleWarningLayer("reservoir"))},null,544),[[It,s.warningLayers.reservoir]]),e[18]||(e[18]=H(" 北京市水库面 ",-1))]),l("div",Ji,[l("div",{class:"color-preview",style:Tt({backgroundColor:s.layerColors.reservoir})},null,4)])])])):M("",!0)]),s.showAnalysisModal?(R(),P("div",ji,[l("div",{ref:"analysisModalRef",class:"analysis-modal-content",onClick:e[10]||(e[10]=Kt(()=>{},["stop"])),onMousedown:e[11]||(e[11]=(...c)=>s.startDrag&&s.startDrag(...c))},[l("div",Vi,[e[21]||(e[21]=l("div",{class:"drag-handle"},[l("div",{class:"drag-dots"},[l("span"),l("span"),l("span"),l("span"),l("span"),l("span")])],-1)),l("h3",null,L((h=s.analysisData)==null?void 0:h.pointName)+" - 水位预警分析结果",1),l("button",{class:"close-btn",onClick:e[6]||(e[6]=(...c)=>s.closeAnalysisModal&&s.closeAnalysisModal(...c))},"×")]),s.analysisData?(R(),P("div",Hi,[l("div",Qi,[l("div",{class:Q(["status-indicator",s.analysisData.statusClass])},L(s.analysisData.status),3)]),l("div",Ki,[e[26]||(e[26]=l("h5",null,"水位对比分析",-1)),l("div",Xi,[e[25]||(e[25]=l("div",{class:"comparison-row header"},[l("div",{class:"label"},"项目"),l("div",{class:"value"},"水位(米)"),l("div",{class:"difference"},"与输入水位差值")],-1)),l("div",Yi,[e[22]||(e[22]=l("div",{class:"label"},"汛限水位",-1)),l("div",ts,L(s.analysisData.floodLimit),1),l("div",{class:Q(["difference",s.analysisData.inputValue>=s.analysisData.floodLimit?"above":"below"])},L(s.analysisData.inputValue>=s.analysisData.floodLimit?"+":"-")+L(Math.abs(s.analysisData.inputValue-s.analysisData.floodLimit).toFixed(2))+"米 ",3)]),l("div",es,[e[23]||(e[23]=l("div",{class:"label"},"历史最高水位",-1)),l("div",is,L(s.analysisData.maxLevel),1),l("div",{class:Q(["difference",s.analysisData.inputValue>=s.analysisData.maxLevel?"above":"below"])},L(s.analysisData.inputValue>=s.analysisData.maxLevel?"+":"-")+L(Math.abs(s.analysisData.inputValue-s.analysisData.maxLevel).toFixed(2))+"米 ",3)]),s.analysisData.avgLevel?(R(),P("div",ss,[e[24]||(e[24]=l("div",{class:"label"},"多年平均水位",-1)),l("div",rs,L(s.analysisData.avgLevel),1),l("div",{class:Q(["difference",s.analysisData.inputValue>=s.analysisData.avgLevel?"above":"below"])},L(s.analysisData.inputValue>=s.analysisData.avgLevel?"+":"-")+L(Math.abs(s.analysisData.inputValue-s.analysisData.avgLevel).toFixed(2))+"米 ",3)])):M("",!0)])]),l("div",ns,[e[29]||(e[29]=l("h5",null,"分析结论",-1)),l("div",os,L(s.analysisData.summary),1),s.analysisData.status==="警戒"||s.analysisData.status==="危险"?(R(),P("div",as,[s.analysisData.status==="警戒"?(R(),P("button",{key:0,class:"emergency-plan-btn warning-plan",onClick:e[7]||(e[7]=c=>s.showEmergencyPlan("warning"))},e[27]||(e[27]=[l("i",{class:"plan-icon"},"⚠️",-1),l("span",null,"预案",-1),l("i",{class:"arrow-icon"},"→",-1)]))):M("",!0),s.analysisData.status==="危险"?(R(),P("button",{key:1,class:"emergency-plan-btn danger-plan",onClick:e[8]||(e[8]=c=>s.showEmergencyPlan("danger"))},e[28]||(e[28]=[l("i",{class:"plan-icon"},"🚨",-1),l("span",null,"预案",-1),l("i",{class:"arrow-icon"},"→",-1)]))):M("",!0)])):M("",!0)])])):M("",!0),l("div",ls,[l("button",{class:"btn-close",onClick:e[9]||(e[9]=(...c)=>s.closeAnalysisModal&&s.closeAnalysisModal(...c))},"关闭")])],544)])):M("",!0),s.showPlanModal?(R(),P("div",us,[l("div",{ref:"planModalRef",class:"analysis-modal-content",onClick:e[14]||(e[14]=Kt(()=>{},["stop"])),onMousedown:e[15]||(e[15]=(...c)=>s.startPlanDrag&&s.startPlanDrag(...c))},[l("div",cs,[e[30]||(e[30]=l("div",{class:"drag-handle"},[l("div",{class:"drag-dots"},[l("span"),l("span"),l("span"),l("span"),l("span"),l("span")])],-1)),l("h3",null,L((d=s.planData)==null?void 0:d.title),1),l("button",{class:"close-btn",onClick:e[12]||(e[12]=(...c)=>s.closePlanModal&&s.closePlanModal(...c))},"×")]),s.planData?(R(),P("div",hs,[l("div",ds,[l("div",{class:Q(["plan-status-indicator",s.planData.type==="warning"?"status-warning":"status-danger"])},L(s.planData.type==="warning"?"警戒水位预案":"危险水位预案"),3)]),l("div",ps,[e[34]||(e[34]=l("h5",null,"当前状况",-1)),l("div",ms,[l("p",null,[e[31]||(e[31]=l("strong",null,"水库名称：",-1)),H(L(s.planData.reservoirName),1)]),l("p",null,[e[32]||(e[32]=l("strong",null,"输入水位：",-1)),H(L(s.planData.currentLevel)+"米",1)]),l("p",null,[e[33]||(e[33]=l("strong",null,"预警等级：",-1)),H(L(s.planData.type==="warning"?"二级（警戒）":"一级（危险）"),1)])])]),l("div",fs,[e[35]||(e[35]=l("h5",null,"应急措施",-1)),l("div",ys,[(R(!0),P(je,null,Ve(s.planData.measures,(c,m)=>(R(),P("div",{key:`measure-${m}`,class:Q(["measure-item",s.planData.type==="warning"?"warning-measure":"danger-measure"]),style:{contain:"layout style"},onClick:w=>s.handleMeasureClick(s.planData.reservoirName,s.planData.type,m)},[l("div",vs,L(m+1),1),l("div",_s,L(c),1)],10,gs))),128))])])])):M("",!0),l("div",bs,[l("button",{class:"btn-close",onClick:e[13]||(e[13]=(...c)=>s.closePlanModal&&s.closePlanModal(...c))},"关闭")])],544)])):M("",!0),e[36]||(e[36]=He('<div class="legend-container" data-v-efa112e6><div class="legend-items" data-v-efa112e6><div class="legend-item" data-v-efa112e6><div class="legend-color danger-color" data-v-efa112e6></div><span class="legend-text" data-v-efa112e6>危险水位</span></div><div class="legend-item" data-v-efa112e6><div class="legend-color warning-color" data-v-efa112e6></div><span class="legend-text" data-v-efa112e6>警戒水位</span></div><div class="legend-item" data-v-efa112e6><div class="legend-color normal-color" data-v-efa112e6></div><span class="legend-text" data-v-efa112e6>正常水位</span></div></div></div>',1))])}const Cs=ie(Bi,[["render",ws],["__scopeId","data-v-efa112e6"]]);export{Cs as default};
