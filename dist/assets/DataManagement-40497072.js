import{_ as $e}from"./返回 (2)-cc03bce6.js";import{_ as te,r as g,o as N,c as I,a as d,b as l,w as a,t as fe,d as Ue,e as De,f as Le,g as Pe,h as Re,i as _,j as G,k as we,G as ye,H as be,I as z,J as xe,u as f,K as he,L as Ve,D as ge,F as ee,A as le,M as T,N as Me,q as Ce,O as Ne,P as v,Q as ke,p as _e,z as Se}from"./index-76b2310c.js";import{a as C}from"./axios-b5ee139b.js";const Fe={name:"DataManagementHeader",props:{title:{type:String,default:"数据管理"}}},Oe={class:"header"},ze={class:"header-content"},Ie={class:"logo-container"},Ee={class:"title"},Be={class:"title-icons"};function je(Q,w,L,b,P,B){const y=g("router-link");return N(),I("header",Oe,[d("div",ze,[d("div",Ie,[l(y,{to:"/",class:"back-button",title:"返回主页"},{default:a(()=>w[0]||(w[0]=[d("img",{src:$e,alt:"返回",width:"32",height:"32"},null,-1)])),_:1,__:[0]})]),d("h1",Ee,fe(L.title),1),d("div",Be,[l(y,{to:"/map-editor",class:"action-icon",title:"电子地图编辑"},{default:a(()=>w[1]||(w[1]=[d("img",{src:Ue,alt:"电子地图编辑",width:"32",height:"32"},null,-1)])),_:1,__:[1]}),l(y,{to:"/data-management",class:"action-icon",title:"数据管理"},{default:a(()=>w[2]||(w[2]=[d("img",{src:De,alt:"数据管理",width:"32",height:"32"},null,-1)])),_:1,__:[2]}),l(y,{to:"/statistics-analysis",class:"action-icon",title:"统计分析"},{default:a(()=>w[3]||(w[3]=[d("img",{src:Le,alt:"统计分析",width:"32",height:"32"},null,-1)])),_:1,__:[3]}),l(y,{to:"/prediction-simulation",class:"action-icon",title:"预测模拟"},{default:a(()=>w[4]||(w[4]=[d("img",{src:Pe,alt:"预测模拟",width:"32",height:"32"},null,-1)])),_:1,__:[4]}),l(y,{to:"/water-pollution-simulation",class:"action-icon",title:"水污染扩散模拟"},{default:a(()=>w[5]||(w[5]=[d("img",{src:Re,alt:"水污染扩散模拟",width:"32",height:"32"},null,-1)])),_:1,__:[5]})])])])}const Ye=te(Fe,[["render",je],["__scopeId","data-v-e52f4cd2"]]);const Te={class:"water-situation-list"},qe={class:"page-header"},Ae={class:"header-actions"},He={class:"search-bar"},Ke={style:{"margin-left":"8px",color:"#909399","font-size":"12px"}},Je={class:"table-container"},Ge={class:"pagination-container"},Qe={class:"dialog-footer"},We={style:{"text-align":"center",padding:"20px"}},Xe={style:{"margin-top":"20px"}},Ze={class:"dialog-footer"},el={style:{"text-align":"center",padding:"20px"}},ll={class:"dialog-footer"},tl={__name:"List",setup(Q){const w=_(!1),L=_([]),b=_(1),P=_(10),B=_(0),y=_(!1),$=_(!1),U=_(!1),R=_(""),j=_(null),S=_(!1),o=G({id:null,reservoirName:"",date:"",waterLevel:null,storage:null,avgInflow:null,avgOutflow:null,yoyIncrease:null,totalCapacity:null,floodLevel:null}),ae={reservoirName:[{required:!0,message:"请输入库名",trigger:"blur"}],date:[{required:!0,message:"请选择日期",trigger:"blur"}]},i=G({reservoirName:"",dateRange:null,waterLevelMin:null,waterLevelMax:null,storageMin:null,storageMax:null,avgInflowMin:null,avgInflowMax:null,avgOutflowMin:null,avgOutflowMax:null,yoyIncreaseMin:null,yoyIncreaseMax:null,totalCapacityMin:null,totalCapacityMax:null,floodLevelMin:null,floodLevelMax:null}),q=_([{label:"库水位",value:"waterLevel",min:null,max:null,step:.1,unit:"米"},{label:"蓄水量",value:"storage",min:null,max:null,step:1e3,unit:"万立方米"},{label:"日平均入库流量",value:"avgInflow",min:null,max:null,step:.1,unit:"立方米/秒"},{label:"日平均出库流量",value:"avgOutflow",min:null,max:null,step:.1,unit:"立方米/秒"},{label:"比去年同期增减",value:"yoyIncrease",min:null,max:null,step:1e3,unit:"万立方米"},{label:"总库容",value:"totalCapacity",min:null,max:null,step:1e3,unit:"万立方米"},{label:"汛限水位",value:"floodLevel",min:null,max:null,step:.1,unit:"米"}]),h=_([]),V=async()=>{w.value=!0;try{const e={page:b.value,pageSize:P.value,reservoirName:i.reservoirName,...i.dateRange&&i.dateRange.length===2?{startDate:i.dateRange[0],endDate:i.dateRange[1]}:{},...Object.fromEntries(h.value.map(s=>[s.value+"Min",i[s.value+"Min"]])),...Object.fromEntries(h.value.map(s=>[s.value+"Max",i[s.value+"Max"]]))},t=await C.get("http://localhost:8080/api/waterSituation/list",{params:e});L.value=t.data.list,B.value=t.data.total}catch(e){console.error("获取数据失败:",e),e.response?v.error(`获取数据失败: ${e.response.status} - ${JSON.stringify(e.response.data)}`):e.request?v.error("网络连接失败，请检查后端服务是否启动"):v.error("获取数据失败: "+e.message)}finally{w.value=!1}},F=()=>{b.value=1,V()},oe=()=>{Object.keys(i).forEach(e=>{e==="dateRange"||e.includes("Min")||e.includes("Max")?i[e]=null:e==="reservoirName"&&(i[e]="")}),h.value=[],R.value="",b.value=1,V()},ne=e=>{if(e&&!h.value.some(t=>t.value===e)){const t=q.value.find(s=>s.value===e);t&&(h.value.push(t),R.value="")}},se=e=>{P.value=e,V()},re=e=>{b.value=e,V()},ie=()=>{A(),y.value=!0},ue=e=>{S.value=!0,Object.assign(o,e),o.date&&(o.date=W(o.date)),y.value=!0},de=async()=>{try{if(await j.value.validate(),o.date&&(o.date=W(o.date)),!S.value&&(await C.get("http://localhost:8080/api/waterSituation/checkReservoirName",{params:{reservoirName:o.reservoirName}})).data){v.error("该库名已存在");return}S.value?(await C.post("http://localhost:8080/api/waterSituation/update",o),v.success("更新成功")):(await C.post("http://localhost:8080/api/waterSituation/create",o),v.success("添加成功")),y.value=!1,A(),V()}catch(e){console.error("提交失败:",e),e.response?v.error(`提交失败: ${e.response.data.message||"未知错误"}`):v.error("提交失败: "+e.message)}},A=()=>{var e;o.id=null,o.reservoirName="",o.date="",o.waterLevel=null,o.storage=null,o.avgInflow=null,o.avgOutflow=null,o.yoyIncrease=null,o.totalCapacity=null,o.floodLevel=null,S.value=!1,(e=j.value)==null||e.clearValidate()},W=e=>e&&!e.includes(":")?e+" 00:00:00":e,me=async e=>{var t,s;try{const m=new FormData;m.append("file",e.raw);const c=await C.post("http://localhost:8080/api/waterSituation/batchImport",m,{headers:{"Content-Type":"multipart/form-data"}});if(c.data.success){const p=c.data,M=p.importedData?p.importedData.length:0,x=p.skippedReservoirs?p.skippedReservoirs.length:0;x>0?v({message:`导入完成！成功导入 ${M} 条数据，跳过 ${x} 条重复数据。${p.message}`,type:"warning",duration:6e3}):v.success(`导入成功！共导入 ${M} 条数据`),$.value=!1,V()}else v.warning(c.data.message||"部分数据导入成功")}catch(m){console.error("导入失败:",m),v.error("导入失败: "+(((s=(t=m.response)==null?void 0:t.data)==null?void 0:s.message)||m.message))}},pe=async()=>{try{const e=await C.get("http://localhost:8080/api/waterSituation/template/download",{responseType:"blob"}),t=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=window.URL.createObjectURL(t),m=document.createElement("a");m.href=s,m.download="水情数据模板.xlsx",document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(s),v.success("模板下载成功")}catch(e){console.error("下载失败:",e),v.error("模板下载失败")}},ce=async()=>{var e,t;try{const s={reservoirName:i.reservoirName,...i.dateRange&&i.dateRange.length===2?{startDate:i.dateRange[0],endDate:i.dateRange[1]}:{},...Object.fromEntries(h.value.map(x=>[x.value+"Min",i[x.value+"Min"]])),...Object.fromEntries(h.value.map(x=>[x.value+"Max",i[x.value+"Max"]]))},m=await C.get("http://localhost:8080/api/waterSituation/export",{params:s,responseType:"blob"}),c=new Blob([m.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),p=window.URL.createObjectURL(c),M=document.createElement("a");M.href=p,M.download="水情数据.xlsx",document.body.appendChild(M),M.click(),document.body.removeChild(M),window.URL.revokeObjectURL(p),v.success("导出成功"),U.value=!1}catch(s){console.error("导出失败:",s),v.error("导出失败: "+(((t=(e=s.response)==null?void 0:e.data)==null?void 0:t.message)||s.message))}},H=async e=>{try{await ke.confirm("确定要删除这条记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await C.delete(`http://localhost:8080/api/waterSituation/delete/${e.id}`),v.success("删除成功"),V()}catch(t){t!=="cancel"&&v.error("删除失败")}},Y=e=>{h.value=h.value.filter(t=>t.value!==e),i[e+"Min"]=null,i[e+"Max"]=null},u=e=>{i[e+"Min"]===null&&i[e+"Max"]===null&&Y(e)};return we(()=>{V()}),ye(i,e=>{h.value.forEach(t=>{const s=e[t.value+"Min"],m=e[t.value+"Max"];s===null&&m===null&&Y(t.value)})},{deep:!0}),(e,t)=>{const s=g("el-icon"),m=g("el-button"),c=g("el-input"),p=g("el-form-item"),M=g("el-date-picker"),x=g("el-input-number"),X=g("el-option"),k=g("el-select"),Z=g("el-form"),D=g("el-table-column"),K=g("el-table"),ve=g("el-pagination"),J=g("el-dialog"),n=g("el-upload"),O=be("loading");return N(),I("div",Te,[d("div",qe,[t[25]||(t[25]=d("h2",null,"水情管理",-1)),d("div",Ae,[l(m,{type:"primary",onClick:t[0]||(t[0]=r=>$.value=!0)},{default:a(()=>[l(s,null,{default:a(()=>[l(z(xe))]),_:1}),t[22]||(t[22]=f(" 数据导入 ",-1))]),_:1,__:[22]}),l(m,{type:"success",onClick:t[1]||(t[1]=r=>U.value=!0)},{default:a(()=>[l(s,null,{default:a(()=>[l(z(he))]),_:1}),t[23]||(t[23]=f(" 数据导出 ",-1))]),_:1,__:[23]}),l(m,{type:"primary",onClick:ie},{default:a(()=>[l(s,null,{default:a(()=>[l(z(Ve))]),_:1}),t[24]||(t[24]=f(" 新增水情 ",-1))]),_:1,__:[24]})])]),d("div",He,[l(Z,{model:i,inline:""},{default:a(()=>[l(p,{label:"库名"},{default:a(()=>[l(c,{modelValue:i.reservoirName,"onUpdate:modelValue":t[2]||(t[2]=r=>i.reservoirName=r),placeholder:"请输入库名",clearable:"",onKeyup:ge(F,["enter"]),onClear:F},null,8,["modelValue"])]),_:1}),l(p,{label:"日期范围"},{default:a(()=>[l(M,{modelValue:i.dateRange,"onUpdate:modelValue":t[3]||(t[3]=r=>i.dateRange=r),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",clearable:"",onChange:F},null,8,["modelValue"])]),_:1}),(N(!0),I(ee,null,le(h.value,r=>(N(),T(p,{key:r.value,label:r.label},{default:a(()=>[l(x,{modelValue:i[r.value+"Min"],"onUpdate:modelValue":E=>i[r.value+"Min"]=E,placeholder:"最小值",min:0,step:r.step,style:{width:"120px"},clearable:"",onClear:E=>u(r.value)},null,8,["modelValue","onUpdate:modelValue","step","onClear"]),t[26]||(t[26]=d("span",{style:{margin:"0 8px"}},"-",-1)),l(x,{modelValue:i[r.value+"Max"],"onUpdate:modelValue":E=>i[r.value+"Max"]=E,placeholder:"最大值",min:0,step:r.step,style:{width:"120px"},clearable:"",onClear:E=>u(r.value)},null,8,["modelValue","onUpdate:modelValue","step","onClear"]),d("span",Ke,"("+fe(r.unit)+")",1),l(m,{type:"text",size:"small",style:{"margin-left":"8px"},onClick:E=>Y(r.value)},{default:a(()=>[l(s,null,{default:a(()=>[l(z(Me))]),_:1})]),_:2},1032,["onClick"])]),_:2,__:[26]},1032,["label"]))),128)),l(p,{label:"添加筛选"},{default:a(()=>[l(k,{modelValue:R.value,"onUpdate:modelValue":t[4]||(t[4]=r=>R.value=r),placeholder:"请选择查询字段",onChange:ne,clearable:""},{default:a(()=>[(N(!0),I(ee,null,le(q.value,r=>(N(),T(X,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,null,{default:a(()=>[l(m,{type:"primary",onClick:F},{default:a(()=>t[27]||(t[27]=[f("查询",-1)])),_:1,__:[27]}),l(m,{onClick:oe},{default:a(()=>t[28]||(t[28]=[f("重置",-1)])),_:1,__:[28]})]),_:1})]),_:1},8,["model"])]),d("div",Je,[Ce((N(),T(K,{data:L.value,border:"",style:{width:"100%"}},{default:a(()=>[l(D,{prop:"reservoirName",label:"库名"}),l(D,{prop:"date",label:"日期"}),l(D,{prop:"waterLevel",label:"库水位(米)"}),l(D,{prop:"storage",label:"蓄水量(万立方米)"}),l(D,{prop:"avgInflow",label:"日平均入库流量(立方米/秒)"}),l(D,{prop:"avgOutflow",label:"日平均出库流量(立方米/秒)"}),l(D,{prop:"yoyIncrease",label:"比去年同期增减(万立方米)"}),l(D,{prop:"totalCapacity",label:"总库容(万立方米)"}),l(D,{prop:"floodLevel",label:"汛限水位(米)"}),l(D,{label:"操作",width:"150",fixed:"right"},{default:a(r=>[l(m,{size:"small",onClick:E=>ue(r.row)},{default:a(()=>t[29]||(t[29]=[f("编辑",-1)])),_:2,__:[29]},1032,["onClick"]),l(m,{size:"small",type:"danger",onClick:E=>H(r.row)},{default:a(()=>t[30]||(t[30]=[f("删除",-1)])),_:2,__:[30]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,w.value]])]),d("div",Ge,[l(ve,{"current-page":b.value,"onUpdate:currentPage":t[5]||(t[5]=r=>b.value=r),"page-size":P.value,"onUpdate:pageSize":t[6]||(t[6]=r=>P.value=r),"page-sizes":[10,20,50,100],total:B.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:se,onCurrentChange:re},null,8,["current-page","page-size","total"])]),l(J,{modelValue:y.value,"onUpdate:modelValue":t[17]||(t[17]=r=>y.value=r),title:S.value?"编辑水情":"新增水情",width:"700px","close-on-click-modal":!1},{footer:a(()=>[d("span",Qe,[l(m,{onClick:t[16]||(t[16]=r=>y.value=!1)},{default:a(()=>t[31]||(t[31]=[f("取消",-1)])),_:1,__:[31]}),l(m,{type:"primary",onClick:de},{default:a(()=>t[32]||(t[32]=[f("确定",-1)])),_:1,__:[32]})])]),default:a(()=>[l(Z,{ref_key:"formRef",ref:j,model:o,rules:ae,"label-width":"140px"},{default:a(()=>[l(p,{label:"库名",prop:"reservoirName"},{default:a(()=>[l(c,{modelValue:o.reservoirName,"onUpdate:modelValue":t[7]||(t[7]=r=>o.reservoirName=r),placeholder:"请输入库名"},null,8,["modelValue"])]),_:1}),l(p,{label:"日期",prop:"date"},{default:a(()=>[l(M,{modelValue:o.date,"onUpdate:modelValue":t[8]||(t[8]=r=>o.date=r),type:"datetime",placeholder:"选择日期时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(p,{label:"库水位(米)",prop:"waterLevel"},{default:a(()=>[l(x,{modelValue:o.waterLevel,"onUpdate:modelValue":t[9]||(t[9]=r=>o.waterLevel=r),min:0,step:.1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(p,{label:"蓄水量(万立方米)",prop:"storage"},{default:a(()=>[l(x,{modelValue:o.storage,"onUpdate:modelValue":t[10]||(t[10]=r=>o.storage=r),min:0,step:1e3,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(p,{label:"日平均入库流量(立方米/秒)",prop:"avgInflow"},{default:a(()=>[l(x,{modelValue:o.avgInflow,"onUpdate:modelValue":t[11]||(t[11]=r=>o.avgInflow=r),min:0,step:.1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(p,{label:"日平均出库流量(立方米/秒)",prop:"avgOutflow"},{default:a(()=>[l(x,{modelValue:o.avgOutflow,"onUpdate:modelValue":t[12]||(t[12]=r=>o.avgOutflow=r),min:0,step:.1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(p,{label:"比去年同期增减(万立方米)",prop:"yoyIncrease"},{default:a(()=>[l(x,{modelValue:o.yoyIncrease,"onUpdate:modelValue":t[13]||(t[13]=r=>o.yoyIncrease=r),step:1e3,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(p,{label:"总库容(万立方米)",prop:"totalCapacity"},{default:a(()=>[l(x,{modelValue:o.totalCapacity,"onUpdate:modelValue":t[14]||(t[14]=r=>o.totalCapacity=r),min:0,step:1e3,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(p,{label:"汛限水位(米)",prop:"floodLevel"},{default:a(()=>[l(x,{modelValue:o.floodLevel,"onUpdate:modelValue":t[15]||(t[15]=r=>o.floodLevel=r),min:0,step:.1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(J,{modelValue:$.value,"onUpdate:modelValue":t[19]||(t[19]=r=>$.value=r),title:"数据导入",width:"600px","close-on-click-modal":!1},{footer:a(()=>[d("span",Ze,[l(m,{onClick:t[18]||(t[18]=r=>$.value=!1)},{default:a(()=>t[36]||(t[36]=[f("取消",-1)])),_:1,__:[36]})])]),default:a(()=>[d("div",We,[l(n,{class:"upload-demo",drag:"",action:"#","auto-upload":!1,"on-change":me,"show-file-list":!1,accept:".xlsx,.xls"},{tip:a(()=>t[33]||(t[33]=[d("div",{class:"el-upload__tip"}," 只能上传 xlsx/xls 文件，且不超过 10MB ",-1)])),default:a(()=>[l(s,{class:"el-icon--upload"},{default:a(()=>[l(z(Ne))]),_:1}),t[34]||(t[34]=d("div",{class:"el-upload__text"},[f(" 将文件拖到此处，或"),d("em",null,"点击上传")],-1))]),_:1,__:[34]}),d("div",Xe,[l(m,{type:"primary",onClick:pe},{default:a(()=>t[35]||(t[35]=[f("下载模板",-1)])),_:1,__:[35]})])])]),_:1},8,["modelValue"]),l(J,{modelValue:U.value,"onUpdate:modelValue":t[21]||(t[21]=r=>U.value=r),title:"数据导出",width:"400px","close-on-click-modal":!1},{footer:a(()=>[d("span",ll,[l(m,{onClick:t[20]||(t[20]=r=>U.value=!1)},{default:a(()=>t[38]||(t[38]=[f("取消",-1)])),_:1,__:[38]})])]),default:a(()=>[d("div",el,[l(m,{type:"primary",onClick:ce},{default:a(()=>t[37]||(t[37]=[f("导出Excel",-1)])),_:1,__:[37]})])]),_:1},8,["modelValue"])])}}},al=te(tl,[["__scopeId","data-v-a6c46f0c"]]);const ol={class:"section-monitor-list"},nl={class:"page-header"},sl={class:"header-actions"},rl={class:"search-bar"},il={style:{"margin-left":"8px",color:"#909399","font-size":"12px"}},ul={class:"table-container"},dl={class:"pagination-container"},ml={class:"dialog-footer"},pl={style:{"text-align":"center",padding:"20px"}},cl={style:{"margin-top":"20px"}},vl={class:"dialog-footer"},gl={style:{"text-align":"center",padding:"20px"}},fl={class:"dialog-footer"},_l={__name:"List",setup(Q){const w=_(!1),L=_([]),b=_(1),P=_(10),B=_(0),y=_(!1),$=_(!1),U=_(!1),R=_(""),j=_(null),S=_(!1),o=G({id:null,monitorPointName:"",reservoirName:"",year:new Date().getFullYear(),month:new Date().getMonth()+1,ammoniaNitrogen:null,potassiumPermanganate:null,cod:null,flow:null,waterDepth:null,totalNitrogen:null,totalPhosphorus:null}),ae={monitorPointName:[{required:!0,message:"请输入监测点名称",trigger:"blur"}],reservoirName:[{required:!0,message:"请输入水库名称",trigger:"blur"}],year:[{required:!0,message:"请输入年份",trigger:"blur"}],month:[{required:!0,message:"请输入月份",trigger:"blur"}]},i=G({monitorPointName:"",reservoirName:"",yearMin:null,yearMax:null,monthMin:null,monthMax:null,ammoniaNitrogenMin:null,ammoniaNitrogenMax:null,potassiumPermanganateMin:null,potassiumPermanganateMax:null,codMin:null,codMax:null,flowMin:null,flowMax:null,waterDepthMin:null,waterDepthMax:null,totalNitrogenMin:null,totalNitrogenMax:null,totalPhosphorusMin:null,totalPhosphorusMax:null}),q=G([{label:"年份",value:"year",min:1900,max:2100,step:1,unit:"年"},{label:"月份",value:"month",min:1,max:12,step:1,unit:"月"},{label:"氨氮",value:"ammoniaNitrogen",min:0,max:100,step:.1,unit:"mg/l"},{label:"高锰酸盐",value:"potassiumPermanganate",min:0,max:100,step:.1,unit:"mg/l"},{label:"化学需氧量",value:"cod",min:0,max:100,step:.1,unit:"mg/l"},{label:"流量",value:"flow",min:0,max:1e3,step:.1,unit:"m³/s"},{label:"水深",value:"waterDepth",min:0,max:10,step:.1,unit:"m"},{label:"总氮",value:"totalNitrogen",min:0,max:100,step:.1,unit:"mg/l"},{label:"总磷",value:"totalPhosphorus",min:0,max:10,step:.1,unit:"mg/l"}]),h=_([]),V=async()=>{var u,e;w.value=!0;try{const t={page:b.value,pageSize:P.value,monitorPointName:i.monitorPointName,reservoirName:i.reservoirName,...i},s=await C.get("/api/sectionMonitor/list",{params:t});L.value=s.data.list.map(m=>({...m,ammoniaNitrogen:m.oxygen})),B.value=s.data.total,console.log("监测断面数据获取结果:",{totalCount:s.data.total,actualCount:s.data.list.length,mappedCount:L.value.length,sampleData:L.value[0]||{},fieldMapping:{originalOxygen:(u=s.data.list[0])==null?void 0:u.oxygen,mappedAmmoniaNitrogen:(e=L.value[0])==null?void 0:e.ammoniaNitrogen}})}catch(t){console.error("获取数据失败:",t),t.response?v.error(`获取数据失败: ${t.response.status} - ${JSON.stringify(t.response.data)}`):t.request?v.error("网络连接失败，请检查后端服务是否启动"):v.error("获取数据失败: "+t.message)}finally{w.value=!1}},F=()=>{b.value=1,V()},oe=()=>{Object.keys(i).forEach(u=>{i[u]=u==="monitorPointName"||u==="reservoirName"?"":null}),h.value=[],R.value="",b.value=1,V()},ne=u=>{if(u&&!h.value.some(e=>e.value===u)){const e=q.find(t=>t.value===u);e&&(h.value.push(e),R.value="")}},se=u=>{P.value=u,V()},re=u=>{b.value=u,V()},ie=()=>{A(),y.value=!0},ue=u=>{S.value=!0,Object.assign(o,{...u,ammoniaNitrogen:u.oxygen}),y.value=!0},de=async()=>{try{if(await j.value.validate(),!S.value&&(await C.get("/api/sectionMonitor/checkMonitorPointName",{params:{monitorPointName:o.monitorPointName,reservoirName:o.reservoirName}})).data){v.error("该监测点名称已存在");return}const u={...o,oxygen:o.ammoniaNitrogen,monitorPointName:o.monitorPointName,reservoirName:o.reservoirName,year:o.year,month:o.month,potassiumPermanganate:o.potassiumPermanganate,cod:o.cod,flow:o.flow,waterDepth:o.waterDepth,totalNitrogen:o.totalNitrogen,totalPhosphorus:o.totalPhosphorus};S.value?(await C.post("/api/sectionMonitor/update",u),v.success("更新成功")):(await C.post("/api/sectionMonitor/create",u),v.success("添加成功")),y.value=!1,A(),V()}catch(u){console.error("提交失败:",u),u.response?v.error(`提交失败: ${u.response.data.message||"未知错误"}`):v.error("提交失败: "+u.message)}},A=()=>{var u;o.id=null,o.monitorPointName="",o.reservoirName="",o.year=new Date().getFullYear(),o.month=new Date().getMonth()+1,o.ammoniaNitrogen=null,o.potassiumPermanganate=null,o.cod=null,o.flow=null,o.waterDepth=null,o.totalNitrogen=null,o.totalPhosphorus=null,S.value=!1,(u=j.value)==null||u.clearValidate()},W=async u=>{var e,t;try{const s=new FormData;s.append("file",u.raw);const m=await C.post("/api/sectionMonitor/batchImport",s,{headers:{"Content-Type":"multipart/form-data"}});if(m.data.success){const c=m.data,p=c.importedData?c.importedData.length:0,M=c.skippedReservoirs?c.skippedReservoirs.length:0;M>0?v({message:`导入完成！成功导入 ${p} 条数据，跳过 ${M} 条重复数据。${c.message}`,type:"warning",duration:6e3}):v.success(`导入成功！共导入 ${p} 条数据`),$.value=!1,V()}else v.warning(m.data.message||"部分数据导入成功")}catch(s){console.error("导入失败:",s),v.error("导入失败: "+(((t=(e=s.response)==null?void 0:e.data)==null?void 0:t.message)||s.message))}},me=async()=>{try{const u=await C.get("/api/sectionMonitor/template",{responseType:"blob"}),e=new Blob([u.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),t=window.URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="监测断面数据模板.xlsx",document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(t),v.success("模板下载成功")}catch(u){console.error("下载失败:",u),v.error("模板下载失败")}},pe=async()=>{var u,e;try{const t=await C.post("/api/sectionMonitor/export",{monitorPointName:i.monitorPointName,reservoirName:i.reservoirName,...i},{responseType:"blob"}),s=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),m=window.URL.createObjectURL(s),c=document.createElement("a");c.href=m,c.download="监测断面数据.xlsx",document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(m),v.success("导出成功"),U.value=!1}catch(t){console.error("导出失败:",t),v.error("导出失败: "+(((e=(u=t.response)==null?void 0:u.data)==null?void 0:e.message)||t.message))}},ce=async u=>{try{await ke.confirm("确定要删除这条记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await C.delete(`/api/sectionMonitor/delete/${u.id}`),v.success("删除成功"),V()}catch(e){e!=="cancel"&&v.error("删除失败")}},H=u=>{h.value=h.value.filter(e=>e.value!==u),i[u+"Min"]=null,i[u+"Max"]=null},Y=u=>{i[u+"Min"]===null&&i[u+"Max"]===null&&H(u)};return we(()=>{V()}),ye(i,u=>{h.value.forEach(e=>{const t=u[e.value+"Min"],s=u[e.value+"Max"];t===null&&s===null&&H(e.value)})},{deep:!0}),(u,e)=>{const t=g("el-icon"),s=g("el-button"),m=g("el-input"),c=g("el-form-item"),p=g("el-input-number"),M=g("el-option"),x=g("el-select"),X=g("el-form"),k=g("el-table-column"),Z=g("el-table"),D=g("el-pagination"),K=g("el-dialog"),ve=g("el-upload"),J=be("loading");return N(),I("div",ol,[d("div",nl,[e[27]||(e[27]=d("h2",null,"监测断面管理",-1)),d("div",sl,[l(s,{type:"primary",onClick:e[0]||(e[0]=n=>$.value=!0)},{default:a(()=>[l(t,null,{default:a(()=>[l(z(xe))]),_:1}),e[24]||(e[24]=f(" 数据导入 ",-1))]),_:1,__:[24]}),l(s,{type:"success",onClick:e[1]||(e[1]=n=>U.value=!0)},{default:a(()=>[l(t,null,{default:a(()=>[l(z(he))]),_:1}),e[25]||(e[25]=f(" 数据导出 ",-1))]),_:1,__:[25]}),l(s,{type:"primary",onClick:ie},{default:a(()=>[l(t,null,{default:a(()=>[l(z(Ve))]),_:1}),e[26]||(e[26]=f(" 新增监测断面 ",-1))]),_:1,__:[26]})])]),d("div",rl,[l(X,{model:i,inline:""},{default:a(()=>[l(c,{label:"监测点名称"},{default:a(()=>[l(m,{modelValue:i.monitorPointName,"onUpdate:modelValue":e[2]||(e[2]=n=>i.monitorPointName=n),placeholder:"请输入监测点名称",clearable:"",onKeyup:ge(F,["enter"]),onClear:F},null,8,["modelValue"])]),_:1}),l(c,{label:"水库名称"},{default:a(()=>[l(m,{modelValue:i.reservoirName,"onUpdate:modelValue":e[3]||(e[3]=n=>i.reservoirName=n),placeholder:"请输入水库名称",clearable:"",onKeyup:ge(F,["enter"]),onClear:F},null,8,["modelValue"])]),_:1}),(N(!0),I(ee,null,le(h.value,n=>(N(),T(c,{key:n.value,label:n.label},{default:a(()=>[l(p,{modelValue:i[n.value+"Min"],"onUpdate:modelValue":O=>i[n.value+"Min"]=O,placeholder:"最小值",min:n.min,max:n.max,step:n.step,style:{width:"120px"},clearable:"",onClear:O=>Y(n.value)},null,8,["modelValue","onUpdate:modelValue","min","max","step","onClear"]),e[28]||(e[28]=d("span",{style:{margin:"0 8px"}},"-",-1)),l(p,{modelValue:i[n.value+"Max"],"onUpdate:modelValue":O=>i[n.value+"Max"]=O,placeholder:"最大值",min:n.min,max:n.max,step:n.step,style:{width:"120px"},clearable:"",onClear:O=>Y(n.value)},null,8,["modelValue","onUpdate:modelValue","min","max","step","onClear"]),d("span",il,"("+fe(n.unit)+")",1),l(s,{type:"text",size:"small",style:{"margin-left":"8px"},onClick:O=>H(n.value)},{default:a(()=>[l(t,null,{default:a(()=>[l(z(Me))]),_:1})]),_:2},1032,["onClick"])]),_:2,__:[28]},1032,["label"]))),128)),l(c,{label:"添加筛选"},{default:a(()=>[l(x,{modelValue:R.value,"onUpdate:modelValue":e[4]||(e[4]=n=>R.value=n),placeholder:"请选择查询字段",onChange:ne,clearable:""},{default:a(()=>[(N(!0),I(ee,null,le(q,n=>(N(),T(M,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(c,null,{default:a(()=>[l(s,{type:"primary",onClick:F},{default:a(()=>e[29]||(e[29]=[f("查询",-1)])),_:1,__:[29]}),l(s,{onClick:oe},{default:a(()=>e[30]||(e[30]=[f("重置",-1)])),_:1,__:[30]})]),_:1})]),_:1},8,["model"])]),d("div",ul,[Ce((N(),T(Z,{data:L.value,border:"",style:{width:"100%"}},{default:a(()=>[l(k,{prop:"monitorPointName",label:"监测点名称"}),l(k,{prop:"reservoirName",label:"水库名称"}),l(k,{prop:"year",label:"年份"}),l(k,{prop:"month",label:"月份"}),l(k,{prop:"ammoniaNitrogen",label:"氨氮(mg/L)"}),l(k,{prop:"potassiumPermanganate",label:"高锰酸盐指数(mg/L)"}),l(k,{prop:"cod",label:"化学需氧量(mg/L)"}),l(k,{prop:"flow",label:"流量(m³/s)"}),l(k,{prop:"waterDepth",label:"水深(m)"}),l(k,{prop:"totalNitrogen",label:"总氮(mg/L)"}),l(k,{prop:"totalPhosphorus",label:"总磷(mg/L)"}),l(k,{label:"操作",width:"150",fixed:"right"},{default:a(n=>[l(s,{size:"small",onClick:O=>ue(n.row)},{default:a(()=>e[31]||(e[31]=[f("编辑",-1)])),_:2,__:[31]},1032,["onClick"]),l(s,{size:"small",type:"danger",onClick:O=>ce(n.row)},{default:a(()=>e[32]||(e[32]=[f("删除",-1)])),_:2,__:[32]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,w.value]])]),d("div",dl,[l(D,{"current-page":b.value,"onUpdate:currentPage":e[5]||(e[5]=n=>b.value=n),"page-size":P.value,"onUpdate:pageSize":e[6]||(e[6]=n=>P.value=n),"page-sizes":[10,20,50,100],total:B.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:se,onCurrentChange:re},null,8,["current-page","page-size","total"])]),l(K,{modelValue:y.value,"onUpdate:modelValue":e[19]||(e[19]=n=>y.value=n),title:S.value?"编辑监测断面":"新增监测断面",width:"600px","close-on-click-modal":!1},{footer:a(()=>[d("span",ml,[l(s,{onClick:e[18]||(e[18]=n=>y.value=!1)},{default:a(()=>e[33]||(e[33]=[f("取消",-1)])),_:1,__:[33]}),l(s,{type:"primary",onClick:de},{default:a(()=>e[34]||(e[34]=[f("确定",-1)])),_:1,__:[34]})])]),default:a(()=>[l(X,{ref_key:"formRef",ref:j,model:o,rules:ae,"label-width":"120px",style:{"max-width":"500px"}},{default:a(()=>[l(c,{label:"监测点名称",prop:"monitorPointName"},{default:a(()=>[l(m,{modelValue:o.monitorPointName,"onUpdate:modelValue":e[7]||(e[7]=n=>o.monitorPointName=n),placeholder:"请输入监测点名称"},null,8,["modelValue"])]),_:1}),l(c,{label:"水库名称",prop:"reservoirName"},{default:a(()=>[l(m,{modelValue:o.reservoirName,"onUpdate:modelValue":e[8]||(e[8]=n=>o.reservoirName=n),placeholder:"请输入水库名称"},null,8,["modelValue"])]),_:1}),l(c,{label:"年份",prop:"year"},{default:a(()=>[l(p,{modelValue:o.year,"onUpdate:modelValue":e[9]||(e[9]=n=>o.year=n),min:1900,max:2100,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(c,{label:"月份",prop:"month"},{default:a(()=>[l(p,{modelValue:o.month,"onUpdate:modelValue":e[10]||(e[10]=n=>o.month=n),min:1,max:12,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(c,{label:"氨氮(mg/L)",prop:"ammoniaNitrogen"},{default:a(()=>[l(p,{modelValue:o.ammoniaNitrogen,"onUpdate:modelValue":e[11]||(e[11]=n=>o.ammoniaNitrogen=n),min:0,step:.1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(c,{label:"高锰酸盐指数(mg/L)",prop:"potassiumPermanganate"},{default:a(()=>[l(p,{modelValue:o.potassiumPermanganate,"onUpdate:modelValue":e[12]||(e[12]=n=>o.potassiumPermanganate=n),min:0,step:.1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(c,{label:"化学需氧量(mg/L)",prop:"cod"},{default:a(()=>[l(p,{modelValue:o.cod,"onUpdate:modelValue":e[13]||(e[13]=n=>o.cod=n),min:0,step:.1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(c,{label:"流量(m³/s)",prop:"flow"},{default:a(()=>[l(p,{modelValue:o.flow,"onUpdate:modelValue":e[14]||(e[14]=n=>o.flow=n),min:0,step:.1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(c,{label:"水深(m)",prop:"waterDepth"},{default:a(()=>[l(p,{modelValue:o.waterDepth,"onUpdate:modelValue":e[15]||(e[15]=n=>o.waterDepth=n),min:0,step:.1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(c,{label:"总氮(mg/L)",prop:"totalNitrogen"},{default:a(()=>[l(p,{modelValue:o.totalNitrogen,"onUpdate:modelValue":e[16]||(e[16]=n=>o.totalNitrogen=n),min:0,step:.1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(c,{label:"总磷(mg/L)",prop:"totalPhosphorus"},{default:a(()=>[l(p,{modelValue:o.totalPhosphorus,"onUpdate:modelValue":e[17]||(e[17]=n=>o.totalPhosphorus=n),min:0,step:.1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(K,{modelValue:$.value,"onUpdate:modelValue":e[21]||(e[21]=n=>$.value=n),title:"数据导入",width:"600px","close-on-click-modal":!1},{footer:a(()=>[d("span",vl,[l(s,{onClick:e[20]||(e[20]=n=>$.value=!1)},{default:a(()=>e[38]||(e[38]=[f("取消",-1)])),_:1,__:[38]})])]),default:a(()=>[d("div",pl,[l(ve,{class:"upload-demo",drag:"",action:"#","auto-upload":!1,"on-change":W,"show-file-list":!1,accept:".xlsx,.xls"},{tip:a(()=>e[35]||(e[35]=[d("div",{class:"el-upload__tip"}," 只能上传 xlsx/xls 文件，且不超过 10MB ",-1)])),default:a(()=>[l(t,{class:"el-icon--upload"},{default:a(()=>[l(z(Ne))]),_:1}),e[36]||(e[36]=d("div",{class:"el-upload__text"},[f(" 将文件拖到此处，或"),d("em",null,"点击上传")],-1))]),_:1,__:[36]}),d("div",cl,[l(s,{type:"primary",onClick:me},{default:a(()=>e[37]||(e[37]=[f("下载模板",-1)])),_:1,__:[37]})])])]),_:1},8,["modelValue"]),l(K,{modelValue:U.value,"onUpdate:modelValue":e[23]||(e[23]=n=>U.value=n),title:"数据导出",width:"400px","close-on-click-modal":!1},{footer:a(()=>[d("span",fl,[l(s,{onClick:e[22]||(e[22]=n=>U.value=!1)},{default:a(()=>e[40]||(e[40]=[f("取消",-1)])),_:1,__:[40]})])]),default:a(()=>[d("div",gl,[l(s,{type:"primary",onClick:pe},{default:a(()=>e[39]||(e[39]=[f("导出Excel",-1)])),_:1,__:[39]})])]),_:1},8,["modelValue"])])}}},wl=te(_l,[["__scopeId","data-v-5c95ff52"]]);const yl={name:"DataManagement",components:{DataManagementHeader:Ye,WaterSituationList:al,SectionMonitorList:wl},setup(){return{activeBox:_("waterSituation")}}},bl={class:"data-management-container"},xl={class:"data-management-main"},hl={class:"data-management-sidebar"},Vl={class:"data-management-content"},Ml={key:0,class:"water-situation-panel"},Cl={key:1,class:"section-monitor-panel"};function Nl(Q,w,L,b,P,B){const y=g("data-management-header"),$=g("water-situation-list"),U=g("section-monitor-list");return N(),I("div",bl,[l(y,{title:"数据管理"}),d("div",xl,[d("div",hl,[d("div",{class:_e(["sidebar-box",{active:b.activeBox==="waterSituation"}]),onClick:w[0]||(w[0]=R=>b.activeBox="waterSituation")},"水情管理",2),d("div",{class:_e(["sidebar-box",{active:b.activeBox==="sectionMonitor"}]),onClick:w[1]||(w[1]=R=>b.activeBox="sectionMonitor")},"监测断面管理",2)]),d("div",Vl,[b.activeBox==="waterSituation"?(N(),I("div",Ml,[l($)])):b.activeBox==="sectionMonitor"?(N(),I("div",Cl,[l(U)])):Se("",!0)])])])}const Dl=te(yl,[["render",Nl],["__scopeId","data-v-91549f8f"]]);export{Dl as default};
