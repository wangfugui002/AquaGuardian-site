import{_ as Uo,r as Cn,o as v,c as g,a as n,b as ke,w as Fe,t as L,d as En,e as An,f as $n,g as Sn,h as Pn,i as b,j as me,k as Oo,l as Fn,n as Be,m as Dn,p as W,q as k,v as zn,s as G,u as z,x as fe,y as O,z as f,F as we,A as xe,B as Le,C as Zo,D as Tn,E}from"./index-cd00da37.js";import{_ as In}from"./返回 (2)-4856710b.js";const Nn="/icons/打开mxd.png",_n="/icons/放大.png",jn="/icons/缩小.png",Vn="/icons/全图.png",Bn="/icons/手.png",Rn="/icons/选择要素.png",On="/icons/查询.png",Zn="/icons/渲染.png",Un="/icons/识别要素.png",Wn="/icons/标注.png",Yn="/icons/左箭头.png",Hn="/icons/右箭头.png";const Xn={name:"MapEditorHeader",props:{title:{type:String,default:"电子地图编辑"}}},qn={class:"header"},Gn={class:"header-content"},Qn={class:"logo-container"},Jn={class:"title"},Kn={class:"title-icons"};function el(Wo,s,re,ye,Me,Ce){const I=Cn("router-link");return v(),g("header",qn,[n("div",Gn,[n("div",Qn,[ke(I,{to:"/",class:"back-button",title:"返回主页"},{default:Fe(()=>s[0]||(s[0]=[n("img",{src:In,alt:"返回",width:"32",height:"32"},null,-1)])),_:1,__:[0]})]),n("h1",Jn,L(re.title),1),n("div",Kn,[ke(I,{to:"/map-editor",class:"action-icon",title:"电子地图编辑"},{default:Fe(()=>s[1]||(s[1]=[n("img",{src:En,alt:"电子地图编辑",width:"32",height:"32"},null,-1)])),_:1,__:[1]}),ke(I,{to:"/data-management",class:"action-icon",title:"数据管理"},{default:Fe(()=>s[2]||(s[2]=[n("img",{src:An,alt:"数据管理",width:"32",height:"32"},null,-1)])),_:1,__:[2]}),ke(I,{to:"/statistics-analysis",class:"action-icon",title:"统计分析"},{default:Fe(()=>s[3]||(s[3]=[n("img",{src:$n,alt:"统计分析",width:"32",height:"32"},null,-1)])),_:1,__:[3]}),ke(I,{to:"/prediction-simulation",class:"action-icon",title:"水位预警"},{default:Fe(()=>s[4]||(s[4]=[n("img",{src:Sn,alt:"水位预警",width:"32",height:"32"},null,-1)])),_:1,__:[4]}),ke(I,{to:"/water-pollution-simulation",class:"action-icon",title:"水污染扩散模拟"},{default:Fe(()=>s[5]||(s[5]=[n("img",{src:Pn,alt:"水污染扩散模拟",width:"32",height:"32"},null,-1)])),_:1,__:[5]})])])])}const ol=Uo(Xn,[["render",el],["__scopeId","data-v-7f81c3ed"]]);const tl={class:"map-editor-container"},nl={class:"map-editor-content"},ll={class:"panel-header"},sl={class:"panel-content"},al={class:"layer-control"},il={class:"layer-color-control"},rl={class:"layer-control"},ul={class:"layer-color-control"},cl={class:"layer-control"},dl={class:"layer-color-control"},vl={class:"layer-control"},gl={class:"layer-color-control"},pl={class:"layer-control"},ml={class:"layer-color-control"},fl={key:0,class:"reservoir-img-panel"},yl=["src","alt"],hl={class:"reservoir-img-title"},bl={key:1,class:"reservoir-details"},wl={class:"details-table"},xl={class:"detail-row"},Ll={class:"detail-value"},kl={class:"detail-row"},Ml={class:"detail-value"},Cl={class:"detail-row"},El={class:"detail-value"},Al={class:"detail-row"},$l={class:"detail-value"},Sl={class:"detail-row"},Pl={class:"detail-value"},Fl={class:"detail-row"},Dl={class:"detail-value"},zl={class:"detail-row"},Tl={class:"detail-value"},Il={class:"detail-row"},Nl={class:"detail-value"},_l={class:"reservoir-buttons"},jl={key:2,class:"monitoring-point-details"},Vl={class:"details-table"},Bl={class:"detail-row"},Rl={class:"detail-value"},Ol={key:0,class:"detail-row"},Zl={class:"detail-value"},Ul={key:1,class:"detail-row"},Wl={class:"detail-value"},Yl={key:2,class:"detail-row"},Hl={class:"detail-value"},Xl={key:3,class:"detail-row"},ql={class:"detail-value"},Gl={key:4,class:"detail-row"},Ql={class:"detail-value"},Jl={key:5,class:"detail-row"},Kl={class:"detail-value"},es={key:6,class:"detail-row"},os={class:"detail-value"},ts={key:1,class:"reservoir-params-panel"},ns={class:"params-title"},ls={class:"params-content"},ss={key:0,class:"params-table"},as={key:0},is={class:"param-label"},rs={class:"param-value"},us={key:1},cs={class:"param-label"},ds={class:"param-value"},vs={key:1,class:"no-data"},gs={key:2,class:"flood-history-panel"},ps={class:"history-content"},ms={key:0,class:"history-section"},fs={key:1,class:"history-section"},ys={key:2,class:"history-section"},hs={key:3,class:"history-section"},bs={key:4,class:"history-section"},ws={key:5,class:"history-section"},xs={key:6,class:"history-section"},Ls={key:7,class:"history-section"},ks={key:8,class:"history-section"},Ms={key:9,class:"history-section"},Cs={key:10,class:"history-section"},Es={key:11,class:"history-section"},As={key:12,class:"history-section"},$s={key:13,class:"history-section"},Ss={key:14,class:"history-section"},Ps={key:15,class:"history-section"},Fs={key:16,class:"history-section"},Ds={key:17,class:"history-section"},zs={key:18,class:"history-section"},Ts={key:19,class:"history-section"},Is={key:20,class:"history-section"},Ns={key:21,class:"history-section"},_s={key:22,class:"history-section"},js={key:23,class:"history-section"},Vs={key:24,class:"history-section"},Bs={key:25,class:"history-section"},Rs={class:"custom-toolbar"},Os={class:"zoom-dropdown-container"},Zs={key:0,class:"zoom-dropdown"},Us={class:"zoom-dropdown-container zoom-out-container"},Ws={key:0,class:"zoom-dropdown"},Ys={class:"search-bar-container"},Hs={class:"search-header-controls"},Xs={class:"layer-selection"},qs={class:"search-input-container"},Gs=["placeholder"],Qs={key:0,class:"search-error"},Js={key:4,class:"loading-overlay"},Ks={class:"loading-progress"},ea={class:"progress-bar"},oa={class:"progress-text"},ta={key:5,class:"mxd-control-panel"},na={class:"mxd-panel-header"},la={class:"mxd-panel-content"},sa={class:"mxd-layer-list"},aa={class:"mxd-layer-group"},ia={class:"mxd-layer-items"},ra=["id","onUpdate:modelValue","onChange"],ua=["for"],ca={class:"layer-name"},da={key:0,class:"mxd-layer-item"},va={class:"render-modal-content"},ga={class:"render-modal-controls"},pa={class:"render-modal-body"},ma={class:"render-row"},fa={class:"render-row"},ya=["value"],ha={class:"render-row"},ba=["value"],wa={key:0,class:"render-error"},xa={key:7,class:"legend-panel"},La={class:"legend-header"},ka={class:"legend-content"},Ma={class:"legend-text"},Ca={class:"legend-range"},Ea={class:"legend-count"},Aa={class:"annotation-panel-controls"},$a={class:"annotation-panel-content"},Sa={class:"annotation-section"},Pa={class:"control-item"},Fa={class:"control-item"},Da=["value"],za={class:"annotation-section"},Ta={class:"control-item"},Ia={class:"control-item"},Na={class:"control-item"},_a={class:"annotation-section"},ja={class:"control-item"},Va={class:"control-item"},Ba={class:"annotation-section"},Ra={class:"control-item"},Oa={class:"control-item"},Za={class:"control-item"},Ua={class:"control-item"},Wa={class:"control-item"},Ya={class:"control-item"},Ha={class:"control-item"},Xa={class:"control-item"},qa={__name:"MapEditor",setup(Wo){const s=b(null),re=b(!0),ye=b(0),Me=b(null),Ce=b(null),I=b(new Set),Ee=b(new Map),De=b(!0),F=me({districts:!0,waterLines:!0,beijingReservoirs:!0,settlements:!1,monitoringPoints:!0}),M=me({districts:"#b3e5fc",waterLines:"#64B5F6",beijingReservoirs:"#26C6DA",settlements:"#FFF176",monitoringPoints:"#FF5722"}),P=me({districts:null,waterLines:null,beijingReservoirs:null,settlements:null,monitoringPoints:null}),Yo=()=>{console.log("开始初始化地图...");try{if(!document.getElementById("editor-map")){console.error("地图容器不存在");return}s.value=E.map("editor-map",{zoomControl:!1,attributionControl:!1,preferCanvas:!0,updateWhenZooming:!1,updateWhenIdle:!0,keepBuffer:2,maxZoom:18,minZoom:5,inertia:!0,inertiaDeceleration:3e3,inertiaMaxSpeed:3e3,renderer:E.canvas({padding:.5})}).setView([39.9042,116.4074],10),console.log("地图对象创建成功:",s.value);try{E.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors",updateWhenIdle:!0,updateWhenZooming:!1,keepBuffer:2,maxNativeZoom:18,maxZoom:18}).addTo(s.value),console.log("底图添加成功")}catch(t){console.log("底图加载失败，使用空白地图:",t)}let e;s.value.on("move",()=>{clearTimeout(e),e=setTimeout(()=>{if(s.value){const t=s.value.getCenter(),l=s.value.getZoom();Te(t,l)}},100)}),Te([39.9042,116.4074],10),et(),console.log("地图初始化完成")}catch(o){console.error("地图初始化失败:",o),h("❌ 地图初始化失败，请刷新页面重试","warning")}},Ho=async()=>{console.log("=== 开始加载地理数据 ===");const e=setTimeout(()=>{console.log("数据加载超时，强制关闭加载状态"),re.value=!1,Re()},5e3),t={districts:"./Beijing-GeoJson-Tzy/北京区县界.json",waterLines:"./Beijing-GeoJson-Tzy/北京市_水系线数据.json",beijingReservoirs:"./Beijing-GeoJson-Tzy/北京市水库面.geojson",settlements:"./Beijing-GeoJson-Tzy/居民地地名.json",monitoringPoints:"./Beijing-GeoJson-Tzy/监测点.geojson"};console.log("数据文件配置:",t);let l=0;const i=Object.keys(t).length;let a=!1;for(const[u,c]of Object.entries(t))try{console.log(`正在加载${u}数据:`,c);const p=await Promise.race([fetch(c),new Promise((y,D)=>setTimeout(()=>D(new Error("请求超时")),3e3))]);if(!p.ok)throw new Error(`HTTP ${p.status}: ${p.statusText}`);const d=await p.json();console.log(`${u}数据加载成功，要素数量:`,d.features?d.features.length:"未知"),d.features&&d.features.length>0&&(console.log("  - 第一个要素属性:",d.features[0].properties),console.log("  - 属性字段列表:",Object.keys(d.features[0].properties)));const m=Xo(u,d);m?(console.log("  - 图层创建成功:",m),console.log("  - 图层类型:",m.constructor.name),console.log("  - 是否有eachLayer方法:",!!m.eachLayer),P[u]=m,a=!0,F[u]?(m.addTo(s.value),u==="beijingReservoirs"&&m.bringToFront(),console.log("  - 图层已添加到地图")):console.log(`  - 图层未添加到地图（layers[${u}] = false）`)):console.error("  - 图层创建失败"),l++,ye.value=Math.round(l/i*100),console.log(`进度: ${l}/${i} (${ye.value}%)`)}catch(p){console.error(`❌ 加载${u}数据失败:`,p),l++,ye.value=Math.round(l/i*100)}if(clearTimeout(e),re.value=!1,console.log("=== 数据加载完成 ==="),console.log("成功加载的图层数量:",Object.keys(P).length),console.log("图层对象状态:",P),!a)console.warn("❌ 所有数据加载失败，显示基本地图"),Re();else try{Lo(),console.log("✅ 地图边界计算完成")}catch(u){console.error("❌ 计算地图边界失败:",u)}},Xo=(o,e)=>{try{const t={renderer:E.canvas({padding:.5}),interactive:!0,smoothFactor:1,simplifyTolerance:.5};let l;return o==="monitoringPoints"?l=E.geoJSON(e,{...t,pointToLayer:(i,a)=>E.circleMarker(a,Oe(o)),onEachFeature:(i,a)=>{i.properties&&a.bindPopup(Ze(o,i.properties))}}):o==="beijingReservoirs"?l=E.geoJSON(e,{...t,style:Oe(o),onEachFeature:(i,a)=>{i.properties&&a.bindPopup(Ze("reservoirArea",i.properties))}}):o==="settlements"?l=E.geoJSON(e,{...t,pointToLayer:(i,a)=>E.circleMarker(a,Oe(o)),onEachFeature:(i,a)=>{i.properties&&a.bindPopup(Ze(o,i.properties))}}):l=E.geoJSON(e,{...t,style:Oe(o),onEachFeature:(i,a)=>{i.properties&&a.bindPopup(Ze(o,i.properties))}}),l}catch(t){return console.error(`创建${o}图层失败:`,t),null}},Re=()=>{if(!s.value)return;console.log("显示基本地图");const o=[39.9042,116.4074];E.marker(o).addTo(s.value).bindPopup("北京市中心").openPopup();const e=E.latLngBounds([39.4,115.7],[40.4,117.4]);E.rectangle(e,{color:"#1890ff",weight:2,fillOpacity:.1}).addTo(s.value),s.value.fitBounds(e),h("✅ 地图已加载完成，可以正常使用","success")},Oe=o=>({districts:{fillColor:M.districts,weight:2.5,opacity:.8,color:M.districts,fillOpacity:.5,dashArray:"5, 8"},waterLines:{color:M.waterLines,weight:2.5,opacity:.9},beijingReservoirs:{fillColor:M.beijingReservoirs,weight:1.5,opacity:.9,color:M.beijingReservoirs,fillOpacity:.8},settlements:{radius:6,fillColor:M.settlements,color:"#ffffff",weight:1.5,opacity:1,fillOpacity:.9},monitoringPoints:{radius:8,fillColor:M.monitoringPoints,color:"#fff",weight:2,opacity:1,fillOpacity:.95}})[o]||{},Ze=(o,e)=>{let t='<div class="popup-content">';const l=["Id","Shape__"];o==="reservoirArea"&&l.push("osm_id","code","fclass","name","FID_1","F11");const i={name:"水库名",NAME:"水库名",年平均氨氮:"年平均氨氮",年平均高猛酸盐:"年平均高猛酸盐",年平均化学需氧量:"年平均化学需氧量",年平均流量:"年平均流量",年平均水深:"年平均水深",年平均总氮:"年平均总氮",年平均总磷:"年平均总磷"},a={库名:"",多年平均库水位:"m",多年平均蓄水量:"万m³",多年日平均入库流量:"m³/s",多年日平均出库流量:"m³/s",总库容:"万m³",汛限水位:"m"},u={库名:"水库名称",多年平均库水位:"多年平均库水位",多年平均蓄水量:"多年平均蓄水量",多年日平均入库流量:"多年日平均入库流量",多年日平均出库流量:"多年日平均出库流量",总库容:"总库容",汛限水位:"汛限水位"};if(o==="reservoirArea"){const c=e.name||e.库名||e.NAME;c&&(t+=`<div style="font-size: 18px; font-weight: bold; color: #2c3e50; margin-bottom: 15px; text-align: center; border-bottom: 2px solid #3498db; padding-bottom: 8px;">🏞️ ${c}</div>`);const p=["总库容","多年平均库水位","多年平均蓄水量","汛限水位"];for(const d of p)if(e[d]&&e[d]!==0){const m=a[d]||"",y=u[d]||d;t+=`<div style="margin: 8px 0; padding: 5px; background: #f8f9fa; border-radius: 4px;"><strong>${d==="总库容"?"📊":d==="多年平均库水位"?"🌊":d==="多年平均蓄水量"?"💧":"⚠️"} ${y}:</strong> <span style="color: #e74c3c; font-weight: bold;">${e[d]}${m?` ${m}`:""}</span></div>`}for(const[d,m]of Object.entries(e))if(!(l.includes(d)||p.includes(d))&&m!=null&&m!==0){const y=a[d]||"",D=u[d]||d;t+=`<div style="margin: 5px 0;"><strong>${D}:</strong> ${m}${y?` ${y}`:""}</div>`}c&&["怀柔水库","密云水库","北台上水库","十三陵水库","官厅水库","崇青水库","斋堂水库"].includes(c)&&(t+='<div style="margin-top: 10px; padding: 8px; background: #e8f4fd; border-left: 4px solid #3498db; border-radius: 4px;"><strong>📚 防洪历史:</strong> 该水库有详细的防洪历史记录，请查看右侧面板。</div>')}else if(o==="monitoringPoints")for(const[c,p]of Object.entries(e)){if(l.includes(c))continue;const d=i[c]||c,m=fo[c]||"";t+=`<div><strong>${d}:</strong> ${p??"未知"}${m?` ${m}`:""}</div>`}else for(const[c,p]of Object.entries(e)){if(l.includes(c))continue;let d="";o==="reservoirArea"?d=a[c]||"":d=fo[c]||"",t+=`<div><strong>${c}:</strong> ${p??"未知"}${d?` ${d}`:""}</div>`}return t+="</div>",t},ze=o=>{const e=P[o];e&&(F[o]?s.value.hasLayer(e)||(e.addTo(s.value),(o==="waterAreas"||o==="reservoirs")&&e.bringToFront()):s.value.hasLayer(e)&&s.value.removeLayer(e),setTimeout(()=>{Lo()},100))},qo=()=>{H(),ce.value=!1,console.log("激活按点放大模式，等待用户单击"),Be(()=>{const o=document.getElementById("editor-map");o&&(console.log("地图容器CSS类:",o.className),console.log("是否包含zoom-in-cursor类:",o.classList.contains("zoom-in-cursor")),console.log("当前鼠标样式:",getComputedStyle(o).cursor))}),s.value&&(s.value.dragging.disable(),console.log("已禁用地图拖拽功能")),setTimeout(()=>{cn();const o=document.getElementById("editor-map");o&&o.classList.add("zoom-in-cursor")},100),h("🔍 请在地图上单击进行放大","info")},Go=()=>{H(),ne.value=!1,console.log("激活按点缩小模式，等待用户单击"),Be(()=>{const o=document.getElementById("editor-map");o&&(console.log("地图容器CSS类:",o.className),console.log("是否包含zoom-out-cursor类:",o.classList.contains("zoom-out-cursor")),console.log("当前鼠标样式:",getComputedStyle(o).cursor))}),s.value&&(s.value.dragging.disable(),console.log("已禁用地图拖拽功能")),setTimeout(()=>{dn();const o=document.getElementById("editor-map");o&&o.classList.add("zoom-out-cursor")},100),h("🔍 请在地图上单击进行缩小","info")},Qo=()=>{console.log("=== 激活拉框缩小模式 ==="),console.log("激活前的状态:",{zoomMode:N.value,isDrawing:T.value}),H(),ne.value=!1,console.log("激活后的状态:",{zoomMode:N.value,isDrawing:T.value}),N.value="rectangle",console.log("设置zoomMode为rectangle后的状态:",{zoomMode:N.value,isDrawing:T.value}),Bo()},Jo=()=>{if(H(),console.log("激活平移模式"),s.value){s.value.dragging.enable(),_t();const o=document.getElementById("editor-map");o&&(o.style.cursor="grab",o.classList.add("panning")),console.log("平移模式已激活，性能优化已应用")}},Ko=()=>{De.value=!De.value},Ae=b(!1),et=()=>{if(s.value){console.log("设置地图事件监听器");let o;s.value.on("dragstart",()=>{Ae.value=!0,o=Date.now(),console.log("开始拖拽")}),s.value.on("drag",()=>{Ae.value||(Ae.value=!0)}),s.value.on("dragend",()=>{Ae.value=!1;const t=Date.now()-o;console.log(`拖拽结束，持续时间: ${t}ms`),setTimeout(()=>{s.value},50)}),s.value.on("click",no),console.log("地图点击事件监听器已绑定");let e;s.value.on("move",()=>{e||(e=setTimeout(()=>{e=null},16))}),s.value.on("zoomend",()=>{ro(),setTimeout(()=>{r.annotations.forEach(t=>{t.isVisible&&t.layer&&io(t)})},100)}),s.value.on("resize",()=>{console.log("地图大小变化，重新定位标注"),setTimeout(()=>{So()},100)}),console.log("地图事件监听器设置完成，性能优化已应用")}else console.error("地图未初始化，无法设置事件监听器")},ot=()=>{H(),console.log("激活要素选择模式");const o=document.getElementById("editor-map");o&&(o.style.cursor="pointer",console.log("已设置选择要素鼠标样式为pointer")),h("👆 请点击地图上的要素进行选择，再次点击可取消选择","info")},tt=()=>{H(),console.log("激活要素识别模式");const o=document.getElementById("editor-map");o&&(o.style.cursor="help",console.log("已设置识别要素鼠标样式为help")),h("❓ 请点击地图上的要素进行识别","info")},wo=()=>{if(s.value){if(console.log("执行全图视图功能"),te.value){console.log("使用预计算的完整边界:",te.value),lo(te.value,"预计算边界");return}console.log("没有预计算的边界，实时计算...");const o=[];if(Object.keys(F).forEach(e=>{if(F[e]&&P[e]){const t=P[e];if(t&&t.getBounds)try{const l=t.getBounds();l&&l.isValid&&l.isValid()&&(console.log(`${e}图层边界:`,l),o.push(l))}catch(l){console.log(`获取${e}图层边界失败:`,l)}}}),console.log("收集到的边界数量:",o.length),o.length>0){let e=o[0];for(let t=1;t<o.length;t++)e=e.extend(o[t]);console.log("合并后的边界:",e),e&&e.isValid&&e.isValid()?lo(e,"实时计算边界"):(console.log("合并后的边界无效，回退到默认视图"),xo())}else console.log("没有有效的边界，回退到默认视图"),xo()}},lo=(o,e)=>{if(!s.value||!o)return;console.log(`使用${e}显示全图:`,o);const t=document.getElementById("editor-map"),l=t?t.offsetWidth:800,i=t?t.offsetHeight:600,a=o.getSouthWest(),u=o.getNorthEast(),c=Math.abs(u.lat-a.lat),p=Math.abs(u.lng-a.lng);console.log("边界范围:",{latDiff:c.toFixed(6),lngDiff:p.toFixed(6),containerSize:`${l}x${i}`});let d,m,y;c<.1&&p<.1?(d=[80,80],m=16,y=10,console.log("小范围边界，使用大边距和高缩放")):c<.5&&p<.5?(d=[60,60],m=14,y=8,console.log("中等范围边界，使用适中边距和缩放")):c<2&&p<2?(d=[40,40],m=12,y=6,console.log("大范围边界，使用小边距和限制缩放")):(d=[20,20],m=10,y=5,console.log("超大范围边界，使用最小边距和严格限制缩放"));const D=nt(o,l,i,d);console.log("计算的最佳缩放级别:",D),s.value.fitBounds(o,{padding:d,maxZoom:Math.min(m,D),minZoom:y,animate:!0,duration:.8}),st(`✅ 已显示${e}全图视图 (缩放: ${Math.min(m,D)})`),setTimeout(()=>{const j=s.value.getCenter(),C=s.value.getZoom();Te(j,C)},1e3)},nt=(o,e,t,l)=>{if(!o||!e||!t)return 10;const i=o.getSouthWest(),a=o.getNorthEast(),u=Math.abs(a.lat-i.lat),c=Math.abs(a.lng-i.lng),p=e-l[1]*2,d=t-l[0]*2,m=d/u,y=p/c,D=Math.min(m,y),j=111e3/D,C=Math.log2(156543.03392/j),x=Math.max(5,Math.min(18,Math.round(C)));return console.log("缩放计算详情:",{latDiff:u.toFixed(6),lngDiff:c.toFixed(6),availableSize:`${p}x${d}`,pixelsPerDegree:D.toFixed(2),metersPerPixel:j.toFixed(2),calculatedZoom:C.toFixed(2),finalZoom:x}),x},xo=()=>{if(s.value){console.log("使用默认北京市视图范围");const o=E.latLngBounds([39.4,115.7],[40.4,117.4]);console.log("默认边界范围:",o),lo(o,"北京市默认")}},lt=()=>{console.log("用户强制关闭加载状态并显示基本地图"),re.value=!1,ye.value=0,Re()},te=b(null),Lo=()=>{console.log("开始预计算地图完整边界");const o=[];if(Object.keys(P).forEach(e=>{const t=P[e];if(t&&t.getBounds)try{const l=t.getBounds();l&&l.isValid&&l.isValid()&&(console.log(`${e}图层边界:`,l),o.push(l))}catch(l){console.log(`预计算${e}图层边界失败:`,l)}}),o.length>0){let e=o[0];for(let t=1;t<o.length;t++)e=e.extend(o[t]);if(e&&e.isValid&&e.isValid()){const t=e.getSouthWest(),l=e.getNorthEast(),i=Math.abs(l.lat-t.lat),a=Math.abs(l.lng-t.lng);if(i>10||a>10)console.log("边界过大，使用北京市范围"),te.value=E.latLngBounds([39.4,115.7],[40.4,117.4]);else if(i<.01||a<.01){console.log("边界过小，扩展范围");const u=e.getCenter(),c=E.latLngBounds([u.lat-.1,u.lng-.1],[u.lat+.1,u.lng+.1]);te.value=c}else te.value=e;console.log("预计算完成，最终边界:",te.value),console.log("边界范围:",{latDiff:i.toFixed(6),lngDiff:a.toFixed(6)})}else console.log("合并后的边界无效，使用默认边界"),te.value=E.latLngBounds([39.4,115.7],[40.4,117.4])}else console.log("没有有效的边界，使用默认边界"),te.value=E.latLngBounds([39.4,115.7],[40.4,117.4])},st=o=>{const e=document.createElement("div");e.className="full-extent-message",e.textContent=o;const t=document.getElementById("editor-map");t&&(t.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},2e3))},at=()=>{if(vo.value&&ee.value>0){ee.value--;const o=ve.value[ee.value];s.value&&o&&s.value.setView(o.center,o.zoom,{animate:!0}),so()}},it=()=>{if(go.value&&ee.value<ve.value.length-1){ee.value++;const o=ve.value[ee.value];s.value&&o&&s.value.setView(o.center,o.zoom,{animate:!0}),so()}},so=()=>{vo.value=ee.value>0,go.value=ee.value<ve.value.length-1},Te=(o,e)=>{ve.value=ve.value.slice(0,ee.value+1),ve.value.push({center:o,zoom:e}),ee.value=ve.value.length-1,so()},rt=()=>{Io.value.click()},ut=o=>{const e=o.target.files[0];e&&(mo.value=e,po.value=!0)},ko=o=>{console.log("Toggle MXD layer:",o.name,o.visible)},ct=o=>({point:{backgroundColor:"#ff7800"},line:{backgroundColor:"#0066ff"},polygon:{backgroundColor:"#00ff00"}})[o.type]||{backgroundColor:"#999"},Ie=o=>{const e=document.querySelector(`input[data-layer="${o}"]`);e&&e.click()},Ne=o=>{const e=P[o];if(e&&F[o]){const t=dt(o);e.setStyle(t)}},dt=o=>({districts:{fillColor:M.districts,weight:2.5,opacity:.8,color:M.districts,fillOpacity:.5,dashArray:"5, 8"},waterLines:{color:M.waterLines,weight:2.5,opacity:.9},waterAreas:{fillColor:M.waterAreas,weight:1.5,opacity:.9,color:M.waterAreas,fillOpacity:.7},reservoirs:{fillColor:M.reservoirs,weight:1.5,opacity:.9,color:M.reservoirs,fillOpacity:.8},settlements:{radius:6,fillColor:M.settlements,color:"#ffffff",weight:1.5,opacity:1,fillOpacity:.9},reservoirPoints:{radius:7,fillColor:M.reservoirPoints,color:"#fff",weight:2,opacity:1,fillOpacity:.95}})[o]||{},vt=()=>{H(),console.log("激活查询模式");const o=document.getElementById("editor-map");o&&(o.style.cursor="default",console.log("已设置查询模式鼠标样式为default")),h("🔍 请在地图上点击要素进行查询","info")},gt=()=>{H(),console.log("激活渲染模式");const o=document.getElementById("editor-map");o&&(o.style.cursor="default",console.log("已设置渲染模式鼠标样式为default")),h("🎨 请在地图上点击要素进行渲染","info")},pt=()=>{H(),r.isActive=!0,console.log("激活标注模式"),r.availableFields.length===0&&eo(),oo();const o=document.getElementById("editor-map");o&&(o.style.cursor="crosshair",console.log("已设置标注模式鼠标样式为crosshair")),h("📍 请在地图上点击位置进行标注，或使用控制面板管理字段标注","info")},r=me({isActive:!1,annotations:[],autoAnnotations:[],manualAnnotations:[],currentStyle:{fontSize:16,fontFamily:"Arial, sans-serif",color:"#000000",backgroundColor:"transparent",borderColor:"#000000",borderWidth:0,padding:0,borderRadius:0,shadow:!1},showAutoLabels:!0,showManualLabels:!0,minZoom:1,maxZoom:20,overlapAvoidance:!0,selectedLayer:"monitoringPoints",selectedField:"年平均氨氮",availableFields:[{value:"年平均氨氮",label:"年平均氨氮"},{value:"年平均高猛酸盐",label:"年平均高猛酸盐"},{value:"年平均化学需氧量",label:"年平均化学需氧量"},{value:"年平均流量",label:"年平均流量"},{value:"年平均水深",label:"年平均水深"},{value:"年平均总氮",label:"年平均总氮"},{value:"年平均总磷",label:"年平均总磷"}]}),mt=o=>{if(!s.value){console.error("地图未初始化");return}try{console.log("开始添加标注，位置:",o);const e=ft(o);r.manualAnnotations.push(e),r.annotations.push(e),h("✅ 手动标注添加成功","success"),je()}catch(e){console.error("添加标注失败:",e),h("❌ 添加标注失败","warning")}},ft=o=>{const e={id:"manual_"+Date.now(),type:"manual",latlng:o,text:"新标注",style:{...r.currentStyle},isEditing:!1,isVisible:!0,layer:null};return e.layer=ao(e),e},yt=(o,e)=>{const t=o.properties,l=e.getLatLng?e.getLatLng():e.getBounds().getCenter();let i="";const a=r.selectedField;if(a&&t[a]!==void 0&&t[a]!==null){const u=t[a];if(typeof u=="number"||!isNaN(parseFloat(u))){const p=ht(a);i=`${u}${p?` ${p}`:""}`}else i=u.toString();return{id:"auto_"+Date.now()+"_"+Math.random(),type:"auto",latlng:l,text:i,style:{...r.currentStyle},isVisible:!0,layer:null,feature:o,sourceLayer:e}}return null},ht=o=>({年平均氨氮:"mg/L",年平均高猛酸盐:"mg/L",年平均化学需氧量:"mg/L",年平均流量:"m³/s",年平均水深:"m",年平均总氮:"mg/L",年平均总磷:"mg/L",多年平均库水位:"m",多年平均蓄水量:"万m³",多年日平均入库流量:"m³/s",多年日平均出库流量:"m³/s",总库容:"万m³",汛限水位:"m"})[o]||"",bt=o=>{const e=document.querySelector(`[data-annotation-id="${o}"]`);if(!e)return;const t=e.closest(".leaflet-popup");if(!t)return;let l=!1,i,a,u,c;t.style.cursor="move",t.style.userSelect="none";const p=x=>{if(!x.target.closest(".annotation-popup-header"))return;l=!0,i=x.clientX,a=x.clientY;const V=t.getBoundingClientRect();u=V.left,c=V.top,t.style.transition="none",t.style.zIndex="10000",x.preventDefault(),x.stopPropagation()},d=x=>{if(!l)return;const V=x.clientX-i,ie=x.clientY-a,be=u+V,R=c+ie,pe=window.innerWidth-t.offsetWidth,yo=window.innerHeight-t.offsetHeight,ho=Math.max(0,Math.min(be,pe)),bo=Math.max(0,Math.min(R,yo));t.style.left=ho+"px",t.style.top=bo+"px",x.preventDefault(),x.stopPropagation()},m=x=>{l&&(l=!1,t.style.transition="all 0.3s ease",t.style.zIndex="1000",x.preventDefault(),x.stopPropagation())},y=x=>{if(!x.target.closest(".annotation-popup-header"))return;l=!0;const V=x.touches[0];i=V.clientX,a=V.clientY;const ie=t.getBoundingClientRect();u=ie.left,c=ie.top,t.style.transition="none",t.style.zIndex="10000",x.preventDefault(),x.stopPropagation()},D=x=>{if(!l)return;const V=x.touches[0],ie=V.clientX-i,be=V.clientY-a,R=u+ie,pe=c+be,yo=window.innerWidth-t.offsetWidth,ho=window.innerHeight-t.offsetHeight,bo=Math.max(0,Math.min(R,yo)),Mn=Math.max(0,Math.min(pe,ho));t.style.left=bo+"px",t.style.top=Mn+"px",x.preventDefault(),x.stopPropagation()},j=x=>{l&&(l=!1,t.style.transition="all 0.3s ease",t.style.zIndex="1000",x.preventDefault(),x.stopPropagation())};t.addEventListener("mousedown",p),document.addEventListener("mousemove",d),document.addEventListener("mouseup",m),t.addEventListener("touchstart",y,{passive:!1}),document.addEventListener("touchmove",D,{passive:!1}),document.addEventListener("touchend",j,{passive:!1});const C=()=>{t.removeEventListener("mousedown",p),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",m),t.removeEventListener("touchstart",y),document.removeEventListener("touchmove",D),document.removeEventListener("touchend",j)};t._dragCleanup=C},wt=o=>{const e=r.annotations.find(t=>t.id===o);if(e&&e.layer){const t=document.querySelector(`[data-annotation-id="${o}"]`);if(t){const l=t.closest(".leaflet-popup");l&&l._dragCleanup&&(l._dragCleanup(),delete l._dragCleanup)}e.layer.closePopup()}},Ue=b(!1),Q=me({x:0,y:0,left:0,top:0}),_e=b(null),We=b(!1),J=me({x:0,y:0,left:0,top:0}),Ye=b(!1),K=me({x:0,y:0,left:0,top:0}),Mo=o=>{if(o.target.closest(".annotation-panel-close"))return;Ue.value=!0,o.type==="mousedown"?(Q.x=o.clientX,Q.y=o.clientY):o.type==="touchstart"&&(Q.x=o.touches[0].clientX,Q.y=o.touches[0].clientY);const e=Me.value;if(e){e.style.transform="none",e.style.transition="none",e.style.zIndex="10000";const t=e.getBoundingClientRect();Q.left=t.left,Q.top=t.top,e.style.left=t.left+"px",e.style.top=t.top+"px",e.classList.add("dragging")}o.type==="mousedown"?(document.addEventListener("mousemove",He),document.addEventListener("mouseup",Xe)):o.type==="touchstart"&&(document.addEventListener("touchmove",He,{passive:!1}),document.addEventListener("touchend",Xe)),o.preventDefault(),o.stopPropagation()},He=o=>{if(!Ue.value)return;const e=Me.value;if(!e)return;let t,l;o.type==="mousemove"?(t=o.clientX,l=o.clientY):o.type==="touchmove"&&(t=o.touches[0].clientX,l=o.touches[0].clientY);const i=t-Q.x,a=l-Q.y,u=Q.left+i,c=Q.top+a,p=window.innerWidth-e.offsetWidth,d=window.innerHeight-e.offsetHeight,m=Math.max(0,Math.min(u,p)),y=Math.max(0,Math.min(c,d));e.style.left=m+"px",e.style.top=y+"px",o.preventDefault(),o.stopPropagation()},Xe=o=>{if(!Ue.value)return;Ue.value=!1;const e=Me.value;e&&(e.style.transition="all 0.3s ease",e.style.zIndex="2000",e.classList.remove("dragging")),document.removeEventListener("mousemove",He),document.removeEventListener("mouseup",Xe),document.removeEventListener("touchmove",He),document.removeEventListener("touchend",Xe),o.preventDefault(),o.stopPropagation()},xt=()=>{const o=Me.value;o&&(o.classList.remove("dragging"),o.style.left="",o.style.top="",o.style.transform="translate(-50%, -50%)",o.style.transition="all 0.3s ease",o.style.zIndex="2000")},Co=o=>{if(o.target.closest(".search-close"))return;Ye.value=!0,o.type==="mousedown"?(K.x=o.clientX,K.y=o.clientY):o.type==="touchstart"&&(K.x=o.touches[0].clientX,K.y=o.touches[0].clientY);const e=Ce.value;if(e){e.style.transform="none",e.style.transition="none",e.style.zIndex="10000";const t=e.getBoundingClientRect();K.left=t.left,K.top=t.top,e.style.left=t.left+"px",e.style.top=t.top+"px",e.classList.add("dragging")}o.type==="mousedown"?(document.addEventListener("mousemove",$e),document.addEventListener("mouseup",Se)):o.type==="touchstart"&&(document.addEventListener("touchmove",$e,{passive:!1}),document.addEventListener("touchend",Se)),o.preventDefault(),o.stopPropagation()},$e=o=>{if(!Ye.value)return;const e=Ce.value;if(!e)return;let t,l;o.type==="mousemove"?(t=o.clientX,l=o.clientY):o.type==="touchmove"&&(t=o.touches[0].clientX,l=o.touches[0].clientY);const i=t-K.x,a=l-K.y,u=K.left+i,c=K.top+a,p=window.innerWidth-e.offsetWidth,d=window.innerHeight-e.offsetHeight,m=Math.max(0,Math.min(u,p)),y=Math.max(0,Math.min(c,d));e.style.left=m+"px",e.style.top=y+"px",o.preventDefault(),o.stopPropagation()},Se=o=>{if(!Ye.value)return;Ye.value=!1;const e=Ce.value;e&&(e.style.transition="all 0.3s ease",e.style.zIndex="2001",e.classList.remove("dragging")),document.removeEventListener("mousemove",$e),document.removeEventListener("mouseup",Se),document.removeEventListener("touchmove",$e),document.removeEventListener("touchend",Se),o.preventDefault(),o.stopPropagation()},Lt=()=>{const o=Ce.value;o&&(o.classList.remove("dragging"),o.style.left="",o.style.top="",o.style.transform="translateX(-50%)",o.style.transition="all 0.3s ease",o.style.zIndex="2001")},Eo=o=>{if(o.target.closest(".render-modal-close")||o.target.closest(".render-modal-reset"))return;We.value=!0,o.type==="mousedown"?(J.x=o.clientX,J.y=o.clientY):o.type==="touchstart"&&(J.x=o.touches[0].clientX,J.y=o.touches[0].clientY);const e=_e.value;if(e){e.style.transform="none",e.style.transition="none",e.style.zIndex="10000";const t=e.getBoundingClientRect();J.left=t.left,J.top=t.top,e.style.left=t.left+"px",e.style.top=t.top+"px",e.classList.add("dragging")}o.type==="mousedown"?(document.addEventListener("mousemove",qe),document.addEventListener("mouseup",Ge)):o.type==="touchstart"&&(document.addEventListener("touchmove",qe,{passive:!1}),document.addEventListener("touchend",Ge)),o.preventDefault(),o.stopPropagation()},qe=o=>{if(!We.value)return;const e=_e.value;if(!e)return;let t,l;o.type==="mousemove"?(t=o.clientX,l=o.clientY):o.type==="touchmove"&&(t=o.touches[0].clientX,l=o.touches[0].clientY);const i=t-J.x,a=l-J.y,u=J.left+i,c=J.top+a,p=window.innerWidth-e.offsetWidth,d=window.innerHeight-e.offsetHeight,m=Math.max(0,Math.min(u,p)),y=Math.max(0,Math.min(c,d));e.style.left=m+"px",e.style.top=y+"px",o.preventDefault(),o.stopPropagation()},Ge=o=>{if(!We.value)return;We.value=!1;const e=_e.value;e&&(e.style.transition="all 0.3s ease",e.style.zIndex="2002",e.classList.remove("dragging")),document.removeEventListener("mousemove",qe),document.removeEventListener("mouseup",Ge),document.removeEventListener("touchmove",qe),document.removeEventListener("touchend",Ge),o.preventDefault(),o.stopPropagation()},kt=()=>{const o=_e.value;o&&(o.classList.remove("dragging"),o.style.left="",o.style.top="",o.style.transform="translateX(-50%)",o.style.transition="all 0.3s ease",o.style.zIndex="2002")},ao=o=>{console.log("创建标注图层:",o.text,"位置:",o.latlng);const{fontSize:e,fontFamily:t,color:l,backgroundColor:i,borderColor:a,borderWidth:u,padding:c,borderRadius:p,shadow:d}=o.style,m=document.createElement("div");m.style.fontSize=e+"px",m.style.fontFamily=t,m.style.visibility="hidden",m.style.position="absolute",m.style.whiteSpace="nowrap",m.textContent=o.text,document.body.appendChild(m);const y=m.offsetWidth;document.body.removeChild(m);const D=E.divIcon({className:"annotation-label",html:`
      <div class="annotation-text" 
           style="
             font-size: ${e}px;
             font-family: ${t};
             color: ${l};
             background-color: transparent;
             border: none;
             padding: 0;
             border-radius: 0;
             box-shadow: none;
             white-space: nowrap;
             cursor: pointer;
             user-select: none;
             font-weight: 700;
             letter-spacing: 0.3px;
             text-shadow: 
               2px 2px 0px rgba(255,255,255,1),
               1px 1px 0px rgba(255,255,255,1),
               -1px -1px 0px rgba(255,255,255,1),
               -2px -2px 0px rgba(255,255,255,1);
             line-height: 1.2;
             position: relative;
             z-index: 1000;
             display: block;
             width: ${y}px;
             height: ${e}px;
             text-align: center;
           "
           data-annotation-id="${o.id}"
      >
        ${o.text}
      </div>
    `,iconSize:[y,e],iconAnchor:[y/2,e/2],popupAnchor:[0,-e/2]}),j=E.marker(o.latlng,{icon:D,interactive:!0,keyboard:!1,title:o.text}).addTo(s.value);return console.log("标注图层已添加到地图:",j),j.on("click",()=>Mt(o)),j.on("dblclick",()=>Ct(o)),j},Mt=o=>{o.type==="manual"?Et(o):At(o)},Ct=o=>{o.type==="manual"&&Ao(o)},Et=o=>{const e=`
    <div class="annotation-popup" data-annotation-id="${o.id}">
      <div class="annotation-popup-header" data-annotation-id="${o.id}">
        <h4>标注信息</h4>
        <span class="annotation-popup-close" onclick="window.closeAnnotationPopup('${o.id}')">×</span>
      </div>
      <div class="annotation-popup-content">
        <p><strong>类型:</strong> ${o.type==="manual"?"手动标注":"自动标注"}</p>
        <p><strong>文本:</strong> ${o.text}</p>
        <p><strong>位置:</strong> ${o.latlng.lat.toFixed(6)}, ${o.latlng.lng.toFixed(6)}</p>
        <p><strong>时间:</strong> ${new Date().toLocaleString()}</p>
        ${o.type==="manual"?`
          <div class="annotation-actions">
            <button onclick="window.editAnnotation('${o.id}')">编辑</button>
            <button onclick="window.deleteAnnotation('${o.id}')">删除</button>
          </div>
        `:""}
      </div>
    </div>
  `;o.layer.bindPopup(e,{closeButton:!1,className:"draggable-annotation-popup",maxWidth:300,autoPan:!1}).openPopup(),setTimeout(()=>{bt(o.id)},100)},At=o=>{o.sourceLayer&&(o.originalStyle||(o.originalStyle=o.sourceLayer.options),o.sourceLayer.setStyle({color:"#ff0000",fillColor:"#ffcccc",weight:3,fillOpacity:.8}),setTimeout(()=>{o.sourceLayer&&o.originalStyle&&o.sourceLayer.setStyle(o.originalStyle)},3e3))},Ao=o=>{o.isEditing=!0;const e=document.createElement("input");e.type="text",e.value=o.text,e.className="annotation-edit-input",e.style.cssText=`
    position: absolute;
    z-index: 10000;
    font-size: ${o.style.fontSize}px;
    font-family: ${o.style.fontFamily};
    color: ${o.style.color};
    background-color: ${o.style.backgroundColor};
    border: 2px solid #1890ff;
    border-radius: 4px;
    padding: 4px;
    outline: none;
  `;const l=document.getElementById("editor-map").getBoundingClientRect(),i=o.latlng,a=s.value.latLngToLayerPoint(i);e.style.left=l.left+a.x-50+"px",e.style.top=l.top+a.y-15+"px",document.body.appendChild(e),e.focus(),e.addEventListener("blur",()=>{$o(o,e.value)}),e.addEventListener("keypress",u=>{u.key==="Enter"&&$o(o,e.value)})},$o=(o,e)=>{o.text=e,o.isEditing=!1;const t=document.querySelector(".annotation-edit-input");t&&t.remove(),je(),h("✅ 标注编辑完成","success")},$t=o=>{const e=r.annotations.findIndex(t=>t.id===o);if(e>-1){const t=r.annotations[e];if(t.layer&&s.value.removeLayer(t.layer),r.annotations.splice(e,1),t.type==="manual"){const l=r.manualAnnotations.findIndex(i=>i.id===o);l>-1&&r.manualAnnotations.splice(l,1)}else{const l=r.autoAnnotations.findIndex(i=>i.id===o);l>-1&&r.autoAnnotations.splice(l,1)}h("✅ 标注删除成功","success")}},St=()=>{r.showAutoLabels&&Vo()},je=()=>{console.log("开始更新标注显示，当前标注数量:",r.annotations.length),r.annotations.forEach(o=>{o.layer&&(s.value.removeLayer(o.layer),o.layer=null)}),r.annotations.forEach(o=>{o.isVisible&&(console.log("创建标注:",o.text,"位置:",o.latlng),o.layer=ao(o),io(o))}),console.log("标注显示更新完成，当前可见标注数量:",r.annotations.filter(o=>o.isVisible&&o.layer).length),r.overlapAvoidance&&Pt()},io=o=>{if(o.layer&&o.layer.getElement){const e=o.layer.getElement();if(e){e.style.imageRendering="crisp-edges",e.style.imageRendering="-webkit-optimize-contrast",e.style.imageRendering="optimize-contrast",e.style.transform="translateZ(0)",e.style.backfaceVisibility="hidden";const t=e.querySelector(".annotation-text");t&&(t.style.textRendering="optimizeLegibility",t.style.webkitFontSmoothing="antialiased",t.style.mozOsxFontSmoothing="grayscale")}}},So=()=>{console.log("开始重新定位标注，当前标注数量:",r.annotations.length),r.annotations.forEach(o=>{if(o.isVisible&&o.layer&&o.latlng)try{o.layer.setLatLng(o.latlng),console.log(`重新定位标注: ${o.text} 到位置:`,o.latlng)}catch(e){console.error(`重新定位标注失败: ${o.text}`,e)}}),console.log("标注重新定位完成")},Po=()=>{console.log("窗口大小变化，重新调整地图和标注"),setTimeout(()=>{s.value&&(s.value.invalidateSize(),So(),console.log("地图和标注调整完成"))},200)},Pt=()=>{const o=r.annotations.filter(t=>t.isVisible),e=5;for(let t=0;t<o.length;t++)for(let l=t+1;l<o.length;l++){const i=o[t],a=o[l];Ft(i,a,e)&&Dt(i,a)}},Ft=(o,e,t)=>{const l=s.value.latLngToLayerPoint(o.latlng),i=s.value.latLngToLayerPoint(e.latlng);return Math.sqrt(Math.pow(l.x-i.x,2)+Math.pow(l.y-i.y,2))<t},Dt=(o,e)=>{const l=e.latlng.lng-o.latlng.lng,i=e.latlng.lat-o.latlng.lat;e.latlng.lng+=l>0?20/1e5:-20/1e5,e.latlng.lat+=i>0?20/1e5:-20/1e5,e.layer&&e.layer.setLatLng(e.latlng)},ro=()=>{if(!s.value)return;const o=s.value.getZoom(),e=o>=r.minZoom&&o<=r.maxZoom;console.log(`缩放级别检查: 当前=${o}, 最小=${r.minZoom}, 最大=${r.maxZoom}, 应该显示=${e}`),r.annotations.forEach(t=>{t.isVisible=e,t.layer&&(e?(t.layer.addTo(s.value),io(t)):(console.log(`隐藏标注: ${t.text} (缩放级别: ${o})`),s.value.removeLayer(t.layer)))})},ue=()=>{r.annotations.forEach(o=>{o.style={...r.currentStyle}}),je()},zt=()=>{confirm("确定要清除所有标注吗？此操作不可撤销。")&&(r.annotations.forEach(o=>{const e=document.querySelector(`[data-annotation-id="${o.id}"]`);if(e){const t=e.closest(".leaflet-popup");t&&t._dragCleanup&&(t._dragCleanup(),delete t._dragCleanup)}}),r.annotations.forEach(o=>{o.layer&&s.value.removeLayer(o.layer)}),r.annotations=[],r.autoAnnotations=[],r.manualAnnotations=[],r.selectedLayer="monitoringPoints",r.selectedField="年平均氨氮",eo(),h("✅ 所有标注已清除","success"))};window.editAnnotation=o=>{const e=r.annotations.find(t=>t.id===o);e&&Ao(e)},window.deleteAnnotation=o=>{$t(o)},window.closeAnnotationPopup=o=>{wt(o)};const S=b(""),A=me({query:{isActive:!1,panels:["query"]},render:{isActive:!1,panels:["render"]},identifyFeature:{isActive:!1,panels:["identifyFeature"]},annotation:{isActive:!1,panels:["annotation"]},selectFeature:{isActive:!1,panels:["selectFeature"]},pan:{isActive:!1,panels:["pan"]},zoomIn:{isActive:!1,panels:["zoomIn"]},zoomOut:{isActive:!1,panels:["zoomOut"]},rectangleZoom:{isActive:!1,panels:["rectangleZoom"]},rectangleZoomOut:{isActive:!1,panels:["rectangleZoomOut"]}}),B=o=>{const e=A[o];if(!e){console.error(`未知工具: ${o}`);return}e.isActive?(console.log(`关闭工具: ${o}`),Fo(o)):(console.log(`激活工具: ${o}`),Tt(o))},Tt=o=>{switch(Object.keys(A).forEach(e=>{e!==o&&A[e].isActive&&Fo(e)}),A[o].isActive=!0,S.value=o,o){case"query":vt();break;case"render":gt();break;case"identifyFeature":tt();break;case"annotation":pt();break;case"selectFeature":ot();break;case"pan":Jo();break;case"zoomIn":qo(),ce.value=!0;break;case"zoomOut":Go(),ne.value=!0;break;case"rectangleZoom":jt(),ce.value=!0;break;case"rectangleZoomOut":Qo(),ne.value=!0;break;default:console.warn(`未处理的工具类型: ${o}`)}},Fo=o=>{const e=A[o];if(e){switch(e.isActive=!1,S.value===o&&(S.value=""),o){case"query":break;case"render":break;case"identifyFeature":break;case"annotation":r.isActive=!1;break;case"selectFeature":break;case"pan":Ae.value=!1;break;case"zoomIn":case"zoomOut":case"rectangleZoom":case"rectangleZoomOut":ce.value=!1,ne.value=!1;break}H(),console.log(`工具已关闭: ${o}`)}},ce=b(!1),ne=b(!1),N=b(""),T=b(!1),Y=b(null),It=()=>{ce.value=!1},Nt=()=>{console.log("关闭缩小菜单"),ne.value=!1};Oo(()=>{document.addEventListener("click",o=>{const e=document.querySelector(".zoom-dropdown-container:not(.zoom-out-container)");e&&!e.contains(o.target)&&It();const t=document.querySelector(".zoom-dropdown-container.zoom-out-container");t&&!t.contains(o.target)&&Nt()})});const Do={rectangleZoom:o=>{if(console.log("执行拉框放大，geometry:",o),console.log("地图对象:",s.value),console.log("几何对象类型:",o?o.constructor.name:"null"),!s.value){console.error("地图未初始化"),h("❌ 地图未初始化","warning");return}if(!o){console.error("几何对象为空"),h("❌ 绘制的区域无效，请重新绘制","warning");return}try{if(typeof o.getBounds!="function"){console.error("几何对象没有getBounds方法:",o),h("❌ 绘制的区域类型不支持，请重新绘制","warning");return}const e=o.getBounds();if(console.log("获取到的边界:",e),!e){console.error("无法获取边界"),h("❌ 无法获取绘制区域的边界，请重新绘制","warning");return}zo(e)?(console.log("边界验证通过，执行放大"),s.value.fitBounds(e,{padding:[50,50],maxZoom:Math.min(s.value.getMaxZoom(),18),animate:!0}),h("✅ 拉框放大成功","success"),setTimeout(()=>{const t=s.value.getCenter(),l=s.value.getZoom();Te(t,l)},300)):(console.log("边界验证失败"),h("⚠️ 绘制的区域无效，请重新绘制","warning"))}catch(e){console.error("拉框放大过程中出错:",e),h("❌ 放大失败，请重新绘制","warning")}},rectangleZoomOut:o=>{if(console.log("执行拉框缩小，geometry:",o),console.log("地图对象:",s.value),console.log("几何对象类型:",o?o.constructor.name:"null"),!s.value){console.error("地图未初始化"),h("❌ 地图未初始化","warning");return}if(!o){console.error("几何对象为空"),h("❌ 绘制的区域无效，请重新绘制","warning");return}try{if(typeof o.getBounds!="function"){console.error("几何对象没有getBounds方法:",o),h("❌ 绘制的区域类型不支持，请重新绘制","warning");return}const e=o.getBounds();if(console.log("获取到的边界:",e),!e){console.error("无法获取边界"),h("❌ 无法获取绘制区域的边界，请重新绘制","warning");return}if(zo(e)){console.log("边界验证通过，执行缩小");const t=s.value.getCenter(),l=s.value.getZoom(),i=e.getCenter(),a=Math.max(s.value.getMinZoom(),l-1.5);s.value.setView(i,a,{animate:!0,duration:.8}),h(`✅ 拉框缩小成功 (缩放: ${l.toFixed(1)} → ${a.toFixed(1)})`,"success"),setTimeout(()=>{const u=s.value.getCenter(),c=s.value.getZoom();Te(u,c)},300)}else console.log("边界验证失败"),h("⚠️ 绘制的区域无效，请重新绘制","warning")}catch(e){console.error("拉框缩小过程中出错:",e),h("❌ 缩小失败，请重新绘制","warning")}}},zo=o=>{if(!o||!s.value)return!1;try{if(!o.isValid||!o.isValid())return console.log("边界对象无效"),!1;const e=o.getSouthWest(),t=o.getNorthEast();if(!e||!t)return console.log("无法获取边界坐标"),!1;if(isNaN(e.lat)||isNaN(e.lng)||isNaN(t.lat)||isNaN(t.lng))return console.log("边界坐标包含无效值"),!1;const l=Math.abs(t.lat-e.lat),i=Math.abs(t.lng-e.lng);return l<1e-4||i<1e-4?(console.log("边界太小:",{latDiff:l,lngDiff:i}),!1):l>10||i>10?(console.log("边界太大:",{latDiff:l,lngDiff:i}),!1):(console.log("边界验证通过:",{latDiff:l,lngDiff:i}),!0)}catch(e){return console.error("边界验证出错:",e),!1}},H=()=>{console.log("重置工具状态"),(A.zoomIn.isActive||A.zoomOut.isActive||A.rectangleZoomOut.isActive)&&s.value&&(s.value.dragging.enable(),console.log("已恢复地图拖拽功能")),ce.value=!1,ne.value=!1;const o=document.getElementById("editor-map");if(o){A.selectFeature.isActive?o.style.cursor="pointer":A.identifyFeature.isActive?o.style.cursor="help":o.style.cursor="default",o.classList.remove("panning"),o.classList.remove("zoom-in-cursor","zoom-out-cursor"),o.querySelectorAll(".leaflet-pane, .leaflet-overlay-pane, .leaflet-tile-pane, .leaflet-marker-pane, .leaflet-tooltip-pane, .leaflet-popup-pane").forEach(a=>{a.style.cursor=""}),o.querySelectorAll("*").forEach(a=>{a.style&&!a.classList.contains("custom-toolbar")&&!a.classList.contains("control-panel")&&(a.style.cursor="")});const l=a=>{if(A.zoomIn.isActive){const u=a.target;u&&u.style&&(u.style.cursor="zoom-in")}},i=a=>{if(A.zoomOut.isActive){const u=a.target;u&&u.style&&(u.style.cursor="zoom-out")}};o.removeEventListener("mousemove",l),o.removeEventListener("mousemove",i),console.log("已恢复鼠标样式，已移除鼠标移动监听器，已移除平移CSS类")}},_t=()=>{if(s.value){console.log("=== 应用平移性能优化 ==="),s.value.options.inertia=!0,s.value.options.inertiaDeceleration=3e3,s.value.options.inertiaMaxSpeed=3e3,s.value.options.updateWhenZooming=!1,s.value.options.updateWhenIdle=!0,s.value.options.keepBuffer=2;const o=s.value._tileLayers;o&&Object.values(o).forEach(e=>{e.options&&(e.options.updateWhenIdle=!0,e.options.updateWhenZooming=!1,e.options.keepBuffer=2)}),Object.values(P).forEach(e=>{e&&e.setStyle&&e.setStyle({smoothFactor:1,simplifyTolerance:.5})}),console.log("平移性能优化已应用")}},uo=o=>{o.key==="Escape"&&T.value&&(q(),h("❌ 已取消绘制","warning")),(o.key==="f"||o.key==="F")&&(o.preventDefault(),wo()),o.key==="Delete"&&I.value.size>0&&(o.preventDefault(),to(),h("🗑️ 已清除所有要素选择","info"))},jt=()=>{if(console.log("激活矩形框放大模式"),console.log("当前地图状态:",{map:!!s.value,activeMapTool:S.value,zoomMode:N.value}),!s.value){console.error("地图未初始化，无法启动绘制模式"),h("❌ 地图未初始化","warning");return}H(),N.value="rectangle",ce.value=!1,ne.value=!1,console.log("启动绘制模式前的状态:",{zoomMode:N.value}),Bo()},Vt=()=>{console.log("设置矩形绘制模式"),console.log("当前激活工具:",S.value),console.log("当前缩放模式:",N.value);let o=null,e=null;const t=a=>{if(console.log("矩形绘制 - 鼠标按下事件触发"),console.log("当前isDrawing状态:",T.value),console.log("当前activeMapTool:",S.value),console.log("当前zoomMode:",N.value),!T.value){console.log("isDrawing为false，退出");return}o=a.latlng,console.log("开始绘制矩形，起始点:",o);try{e=E.rectangle([o,o],{color:"#ff0000",weight:2,fillColor:"#ff0000",fillOpacity:.2}).addTo(Y.value),console.log("矩形对象已创建:",e),console.log("矩形类型:",e.constructor.name)}catch(u){console.error("创建矩形对象失败:",u),h("❌ 创建绘制区域失败","warning"),q();return}},l=a=>{if(!(!T.value||!o||!e))try{const u=a.latlng;e.setBounds([o,u]),console.log("更新矩形，当前点:",u)}catch(u){console.error("更新矩形失败:",u)}},i=a=>{if(!T.value||!o||!e){console.log("绘制条件不满足:",{isDrawing:T.value,startPoint:!!o,rectangle:!!e});return}console.log("完成矩形绘制");try{const u=e.getBounds();if(console.log("矩形边界:",u),!u){console.error("无法获取矩形边界"),h("❌ 无法获取绘制区域边界","warning"),q();return}const c=u.getSouthWest(),p=u.getNorthEast();if(!c||!p){console.error("边界坐标无效"),h("❌ 边界坐标无效","warning"),q();return}const d=Math.abs(p.lat-c.lat),m=Math.abs(p.lng-c.lng);if(console.log("矩形尺寸:",{latDiff:d,lngDiff:m}),d<1e-4||m<1e-4){console.log("矩形太小，重新绘制"),h("⚠️ 绘制的区域太小，请重新绘制","warning"),q();return}console.log("绘制完成，当前工具类型:",S.value),console.log("矩形对象:",e),S.value==="rectangleZoomOut"?(console.log("✅ 调用缩小方法，矩形对象:",e),Do.rectangleZoomOut(e),setTimeout(()=>{console.log("缩小完成，重置状态"),S.value="",q()},100)):S.value==="rectangleZoom"?(console.log("✅ 调用放大方法，矩形对象:",e),Do.rectangleZoom(e),setTimeout(()=>{console.log("放大完成，重置状态"),S.value="",q()},100)):(console.log("❌ 未知的工具类型:",S.value),console.log("当前activeMapTool值:",S.value),console.log("当前zoomMode值:",N.value),h("❌ 未知的缩放模式","warning"),q())}catch(u){console.error("处理矩形绘制完成时出错:",u),h("❌ 处理绘制结果失败","warning"),q()}};console.log("绑定矩形绘制事件监听器");try{s.value.off("mousedown"),s.value.off("mousemove"),s.value.off("mouseup"),s.value.on("mousedown",t),s.value.on("mousemove",l),s.value.on("mouseup",i),console.log("矩形绘制事件监听器绑定完成")}catch(a){console.error("绑定事件监听器失败:",a),h("❌ 设置绘制模式失败","warning"),q()}},Ve=b(""),de=b(""),Qe=b("monitoringPoints"),Bt=()=>({monitoringPoints:"请输入水库名称",beijingReservoirs:"请输入水库名称",settlements:"请输入居民点名称",districts:"请输入行政区划名称",waterLines:"请输入河流名称"})[Qe.value]||"请输入查询内容",To=()=>{if(console.log("handleSearch函数被调用"),de.value="",!Ve.value.trim()){de.value="请输入查询内容";return}const o=Qe.value;console.log("选择的图层:",o);const e=P[o];if(console.log("图层对象:",e),!e){de.value=`${Je(o)}图层未加载`;return}console.log("开始查询，搜索文本:",Ve.value.trim()),se.value=o;let t=!1,l=0;if(!e.getLayers||e.getLayers().length===0){de.value=`${Je(o)}图层没有数据`;return}const i=e.getLayers?e.getLayers():[];console.log(`图层${o}有${i.length}个要素`),i.forEach((a,u)=>{const c=a.feature&&a.feature.properties;if(c){l++;let p=!1;const d=Ve.value.trim();switch(l<=3&&console.log(`要素${l}的属性:`,c),o){case"monitoringPoints":p=c.name&&(c.name===d||c.name.includes(d))||c.NAME&&(c.NAME===d||c.NAME.includes(d))||c.库名&&(c.库名===d||c.库名.includes(d));break;case"beijingReservoirs":p=c.name&&(c.name===d||c.name.includes(d))||c.库名&&(c.库名===d||c.库名.includes(d))||c.NAME&&(c.NAME===d||c.NAME.includes(d));break;case"settlements":p=c.NAME&&(c.NAME===d||c.NAME.includes(d));break;case"districts":p=c.NAME&&(c.NAME===d||c.NAME.includes(d));break;case"waterLines":p=c.name&&(c.name===d||c.name.includes(d));break;default:console.log("未知的图层类型:",o);break}if(l<=5&&console.log(`要素${l}匹配结果:`,p,"搜索值:",d,"属性:",c),p){console.log("找到匹配的要素:",c),t=!0;const m=a.getBounds?a.getBounds():null;if(m)s.value.fitBounds(m,{padding:[50,50]});else{const y=a.getLatLng?a.getLatLng():null;y&&s.value.setView(y,14,{animate:!0})}if(a.setStyle&&(a.setStyle({color:"#ff0000",fillColor:"#ffcccc",weight:4}),setTimeout(()=>e.resetStyle&&e.resetStyle(a),2e3)),de.value="",console.log("查询成功，面板状态:",{showReservoirImgPanel:le.value,showFloodHistoryPanel:he.value,reservoirImgName:w.value,reservoirImgUrl:Ke.value}),o==="beijingReservoirs"){const y=c.name||c.库名||c.NAME;y&&(console.log("显示水库面板:",y),Ke.value=`/reservoir-images/${y}.jpg`,w.value=y,$.value=c,console.log("保存水库属性数据:",c),le.value=!1,Be(()=>{le.value=!0}),y==="怀柔水库"||y==="密云水库"||y==="北台上水库"||y==="十三陵水库"||y==="官厅水库"||y==="崇青水库"||y==="斋堂水库"?console.log("水库支持防洪历史:",y):he.value=!1)}else if(o==="monitoringPoints"){const y=c.name||c.库名||c.NAME;y&&(console.log("显示监测点面板:",y),w.value=y,$.value=c,console.log("保存监测点属性数据:",c),le.value=!1,Be(()=>{le.value=!0}))}else le.value=!1,he.value=!1}}}),t||(de.value=`未找到对应的${Je(o)}`,le.value=!1,he.value=!1)},Je=o=>({monitoringPoints:"水库监测点",beijingReservoirs:"水库",settlements:"居民点",districts:"行政区划",waterLines:"河流"})[o]||"要素",Rt=o=>({name:"名称",NAME:"名称",库名:"库名",area:"面积",AREA:"面积",面积:"面积",region:"所属地区",REGION:"所属地区",所属地区:"所属地区",depth:"平均水深",DEPTH:"平均水深",平均水深:"平均水深",buildTime:"建库时间",BUILD_TIME:"建库时间",建库时间:"建库时间",waterSystem:"水系",WATER_SYSTEM:"水系",水系:"水系",useTime:"投用时间",USE_TIME:"投用时间",投用时间:"投用时间",capacity:"库容",CAPACITY:"库容",库容:"库容",maxFloodYear:"最大洪峰年份",MAX_FLOOD_YEAR:"最大洪峰年份",最大洪峰年份:"最大洪峰年份",maxFloodFlow:"最大洪峰流量",MAX_FLOOD_FLOW:"最大洪峰流量",最大洪峰流量:"最大洪峰流量",type:"类型",TYPE:"类型",类型:"类型",status:"状态",STATUS:"状态",状态:"状态",description:"描述",DESCRIPTION:"描述",描述:"描述"})[o]||o,Ot=o=>o==null||o===""?"暂无数据":typeof o=="number"?o>1e6?(o/1e6).toFixed(2)+"百万":o>1e3?(o/1e3).toFixed(2)+"千":o.toString():o.toString(),Zt=()=>[{key:"库名",label:"库名"},{key:"多年平均库水位",label:"多年平均库水位"},{key:"多年平均蓄水量",label:"多年平均蓄水量"},{key:"多年日平均入库流量",label:"多年日平均入库径流"},{key:"多年日平均出库流量",label:"多年日平均出库径流"},{key:"总库容",label:"总库容"},{key:"汛限水位",label:"汛限水位"}],Ut=(o,e)=>{if(o==="多年日平均入库流量"&&w.value==="密云水库")return"73.42 万立方米";if(o==="多年日平均出库流量"&&w.value==="密云水库")return"69.12 万立方米";if(e==null||e==="")return"暂无数据";switch(o){case"库名":return e.toString();case"多年平均库水位":case"汛限水位":return e.toString()+" 米";case"多年平均蓄水量":case"总库容":return e.toString()+" 万立方米";case"多年日平均入库流量":case"多年日平均出库流量":return e.toString()+" m³/s";default:return e.toString()}},Wt=()=>se.value==="monitoringPoints"?"监测点信息":se.value==="beijingReservoirs"?`${w.value} - 水库信息`:w.value,Yt=()=>se.value==="monitoringPoints"?"监测点参数详情":se.value==="beijingReservoirs"?"水库基本信息详情":"参数详情",Ht=o=>({name:"监测点名称",NAME:"监测点名称",库名:"监测点名称",年平均氨氮:"年平均氨氮",年平均高猛酸盐:"年平均高猛酸盐",年平均化学需氧量:"年平均化学需氧量",年平均流量:"年平均流量",年平均水深:"年平均水深",年平均总氮:"年平均总氮",年平均总磷:"年平均总磷",type:"类型",TYPE:"类型",status:"状态",STATUS:"状态",description:"描述",DESCRIPTION:"描述"})[o]||o,Xt=(o,e)=>{if(e==null||e==="")return"暂无数据";switch(o){case"年平均氨氮":case"年平均高猛酸盐":case"年平均化学需氧量":case"年平均总氮":case"年平均总磷":return e.toString()+" mg/L";case"年平均流量":return e.toString()+" m³/s";case"年平均水深":return e.toString()+" m";default:return e.toString()}},qt=()=>{if(console.log("playReservoirVideo 函数被调用"),console.log("当前水库名称:",w.value),w.value==="密云水库"){console.log("开始创建视频播放模态框");const o="/videos/密云水库.mp4",e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="rgba(0, 0, 0, 0.8)",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.zIndex="10000";const t=document.createElement("div");t.style.backgroundColor="white",t.style.padding="20px",t.style.borderRadius="8px",t.style.position="relative",t.style.boxShadow="0 4px 20px rgba(0, 0, 0, 0.3)",t.style.maxWidth="90vw",t.style.maxHeight="90vh",t.style.overflow="auto";const l=document.createElement("div");l.innerHTML=`
      <div style="text-align: center; padding: 20px;">
        <h3>正在加载视频...</h3>
        <p>请稍候</p>
      </div>
    `,t.appendChild(l);const i=document.createElement("video");i.src=o,i.controls=!0,i.style.width="100%",i.style.maxWidth="800px",i.style.height="auto",i.addEventListener("loadeddata",()=>{l.parentNode&&l.parentNode.removeChild(l)});const a=document.createElement("button");a.innerHTML="×",a.style.position="absolute",a.style.top="10px",a.style.right="15px",a.style.background="none",a.style.border="none",a.style.fontSize="24px",a.style.cursor="pointer",a.style.color="#666",a.onclick=()=>{document.body.removeChild(e)},t.appendChild(a),t.appendChild(i),e.appendChild(t),document.body.appendChild(e),i.play().catch(u=>{console.log("视频播放失败，可能是本地文件路径问题:",u);const c=document.createElement("div");c.innerHTML=`
        <div style="text-align: center; padding: 20px;">
          <h3>视频播放失败</h3>
          <p>无法播放视频文件: ${o}</p>
          <p>请确保视频文件存在且路径正确</p>
          <button onclick="this.parentElement.parentElement.parentElement.remove()" style="margin-top: 10px; padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">确定</button>
        </div>
      `,t.innerHTML="",t.appendChild(c)})}},le=b(!1),Ke=b(""),w=b(""),he=b(!1),co=b(!1),$=b(null),se=b(""),ve=b([]),ee=b(-1),vo=b(!1),go=b(!1),po=b(!1),mo=b(null),Io=b(null),Pe=b([{id:"group-1",name:"图展",type:"group",visible:!0,children:[{id:"beijing-resident-places",name:"居民点",type:"point",visible:!0}]},{id:"layer-1",name:"行政区划",type:"polygon",visible:!0},{id:"layer-2",name:"河流",type:"line",visible:!0},{id:"layer-3",name:"水系面数据",type:"polygon",visible:!0},{id:"layer-4",name:"水库数据",type:"polygon",visible:!0}]),ae={怀柔水库:{中文名:"怀柔水库",面积:"12 km²",所属地区:"北京",平均水深:"6.00米",建库时间:"1958年3月",水系:"海河支流潮白河支流怀河水系",投用时间:"1958年7月20日",库容:"1亿立方米",最大洪峰年份:"1972年",最大洪峰流量:"4245立方米/秒"},密云水库:{中文名:"密云水库",面积:"188 km²",所属地区:"北京",平均水深:"30米",建库时间:"1958年9月",水系:"海河支流潮白河水系",投用时间:"1960年9月",库容:"43.75亿立方米",最大洪峰年份:"1976年",最大洪峰流量:"3670立方米/秒"},北台上水库:{中文名:"北台上水库",面积:"8.5 km²",所属地区:"北京",平均水深:"12米",建库时间:"1973年",水系:"海河支流潮白河水系",投用时间:"1975年",库容:"1.2亿立方米",最大洪峰年份:"1980年",最大洪峰流量:"850立方米/秒"},十三陵水库:{中文名:"十三陵水库",面积:"15.2 km²",所属地区:"北京",平均水深:"18米",建库时间:"1958年",水系:"海河支流温榆河水系",投用时间:"1960年",库容:"2.8亿立方米",最大洪峰年份:"1975年",最大洪峰流量:"1200立方米/秒"},官厅水库:{中文名:"官厅水库",面积:"280 km²",所属地区:"北京",平均水深:"25米",建库时间:"1951年",水系:"海河支流永定河水系",投用时间:"1954年",库容:"41.6亿立方米",最大洪峰年份:"1963年",最大洪峰流量:"3200立方米/秒"},崇青水库:{中文名:"崇青水库",面积:"6.8 km²",所属地区:"北京",平均水深:"10米",建库时间:"1976年",水系:"海河支流潮白河水系",投用时间:"1978年",库容:"0.8亿立方米",最大洪峰年份:"1982年",最大洪峰流量:"650立方米/秒"},斋堂水库:{中文名:"斋堂水库",面积:"12.5 km²",所属地区:"北京",平均水深:"15米",建库时间:"1974年",水系:"海河支流永定河水系",投用时间:"1976年",库容:"1.5亿立方米",最大洪峰年份:"1981年",最大洪峰流量:"950立方米/秒"},桃峪口水库:{中文名:"桃峪口水库",面积:"8.2 km²",所属地区:"北京",平均水深:"12米",建库时间:"1975年",水系:"海河支流潮白河水系",投用时间:"1977年",库容:"1.0亿立方米",最大洪峰年份:"1983年",最大洪峰流量:"780立方米/秒"},沙厂水库:{中文名:"沙厂水库",面积:"6.5 km²",所属地区:"北京",平均水深:"14米",建库时间:"1976年",水系:"海河支流潮白河水系",投用时间:"1978年",库容:"0.9亿立方米",最大洪峰年份:"1984年",最大洪峰流量:"620立方米/秒"},海子水库:{中文名:"海子水库",面积:"5.8 km²",所属地区:"北京",平均水深:"11米",建库时间:"1977年",水系:"海河支流潮白河水系",投用时间:"1979年",库容:"0.7亿立方米",最大洪峰年份:"1985年",最大洪峰流量:"580立方米/秒"},白河堡水库:{中文名:"白河堡水库",面积:"7.2 km²",所属地区:"北京",平均水深:"13米",建库时间:"1978年",水系:"海河支流潮白河水系",投用时间:"1980年",库容:"1.1亿立方米",最大洪峰年份:"1986年",最大洪峰流量:"720立方米/秒"},遥桥峪水库:{中文名:"遥桥峪水库",面积:"4.6 km²",所属地区:"北京",平均水深:"9米",建库时间:"1979年",水系:"海河支流潮白河水系",投用时间:"1981年",库容:"0.5亿立方米",最大洪峰年份:"1987年",最大洪峰流量:"450立方米/秒"},黄松峪水库:{中文名:"黄松峪水库",面积:"3.8 km²",所属地区:"北京",平均水深:"8米",建库时间:"1980年",水系:"海河支流潮白河水系",投用时间:"1982年",库容:"0.4亿立方米",最大洪峰年份:"1988年",最大洪峰流量:"380立方米/秒"}},_=b("monitoringPoints"),Gt=b(["年平均氨氮","年平均高猛酸盐","年平均化学需氧量","年平均流量","年平均水深","年平均总氮","年平均总磷"]),Qt=b(["多年平均库水位","多年平均蓄水量","多年日平均入库流量","多年日平均出库流量","总库容","汛限水位"]),fo={年平均氨氮:"mg/L",年平均高猛酸盐:"mg/L",年平均化学需氧量:"mg/L",年平均流量:"m³/s",年平均水深:"m",年平均总氮:"mg/L",年平均总磷:"mg/L",多年平均库水位:"m",多年平均蓄水量:"万m³",多年日平均入库流量:"m³/s",多年日平均出库流量:"m³/s",总库容:"万m³",汛限水位:"m"},Jt=Fn(()=>(_.value==="monitoringPoints"?Gt.value:Qt.value).map(e=>{const t=fo[e]||"";return{value:e,label:t?`${e} (${t})`:e}})),Z=b("年平均氨氮"),U=b(""),oe=b(3),X=b([]),ge=b(!1),No=b(""),_o=b([]),jo={1:["#ff4d4f"],2:["#ff4d4f","#52c41a"],3:["#ff4d4f","#ffd700","#52c41a"],4:["#ff4d4f","#ff7a45","#ffd700","#52c41a"],5:["#ff4d4f","#ff7a45","#ffd700","#73d13d","#52c41a"],6:["#ff4d4f","#ff7a45","#ffd700","#bae637","#73d13d","#52c41a"]},Kt=()=>{_.value==="monitoringPoints"?Z.value="年平均氨氮":_.value==="beijingReservoirs"&&(Z.value="总库容"),X.value=[],ge.value=!1},en=()=>{X.value=[],ge.value=!1},on=()=>{X.value=[],ge.value=!1},tn=(o,e)=>{if(o.length===0||e<=0||e>o.length)return[];const t=[...o].sort((a,u)=>a-u);if(e>=o.length)return t.map((a,u)=>({min:parseFloat(a.toFixed(2)),max:parseFloat(a.toFixed(2)),color:jo[Math.min(e,6)][u]||"#999999"}));const l=Math.ceil(o.length/e),i=[];for(let a=0;a<e;a++){const u=a*l;let c=Math.min((a+1)*l,o.length);a===e-1&&(c=o.length);const p=t[u],d=t[c-1];i.push({min:parseFloat(p.toFixed(2)),max:parseFloat(d.toFixed(2)),color:jo[e][a]||"#999999"})}return i},nn=()=>{U.value="",console.log("=== 开始分级渲染 ==="),console.log("1. 基本参数检查:"),console.log("  - 选中的图层:",_.value),console.log("  - 选中的字段:",Z.value),console.log("  - 分级数量:",oe.value),console.log("2. 图层对象检查:"),console.log("  - 当前图层对象:",P),console.log("  - 选中的渲染图层:",_.value),console.log("  - 图层是否存在:",!!P[_.value]),console.log("  - 图层对象类型:",typeof P[_.value]);const o=P[_.value];if(!o){const e=`${_.value==="monitoringPoints"?"监测点":"水库"}图层未加载`;console.error("❌ 渲染失败:",e),U.value=e;return}if(!Z.value){const e="请选择字段";console.error("❌ 渲染失败:",e),U.value=e;return}try{console.log("3. 开始收集图层数据...");const e=[],t=[];if(console.log("  - 检查图层方法:"),console.log("    * 图层对象:",o),console.log("    * 是否有eachLayer方法:",!!o.eachLayer),console.log("    * 图层类型:",o.constructor.name),console.log("    * 图层属性:",Object.keys(o)),!o.eachLayer){const C="图层对象没有eachLayer方法";console.error("❌ 渲染失败:",C),U.value=C;return}console.log("  - 开始遍历图层要素...");let l=0,i=0;if(o.eachLayer(C=>{l++;const x=C.feature&&C.feature.properties;if(x&&x[Z.value]!==void 0&&x[Z.value]!==null){const V=parseFloat(x[Z.value]);isNaN(V)||(e.push(V),t.push(C),i++)}}),console.log("4. 数据收集结果:"),console.log("  - 遍历的要素总数:",l),console.log("  - 有效数据值数量:",e.length),console.log("  - 收集到的要素数量:",t.length),console.log("  - 数据值范围:",e.length>0?`${Math.min(...e)} - ${Math.max(...e)}`:"无数据"),console.log("  - 样本数据值:",e.slice(0,5)),e.length===0){const C="所选字段没有有效的数值数据";console.error("❌ 渲染失败:",C),U.value=C;return}if(e.length<oe.value){const C=`数据点数量(${e.length})少于分级数量(${oe.value})，无法进行等量分级`;console.error("❌ 渲染失败:",C),U.value=C;return}console.log("5. 开始计算等量分级...");const a=tn(e,oe.value);if(console.log("  - 分级算法结果:",a),!a||a.length===0){const C="分级计算失败";console.error("❌ 渲染失败:",C),U.value=C;return}X.value=a,console.log("6. 分级结果已保存:",X.value);const u=new Array(oe.value).fill(0);console.log("7. 开始应用分级渲染...");let c=0;t.forEach((C,x)=>{const V=C.feature.properties,ie=parseFloat(V[Z.value]);let be=-1;for(let R=0;R<X.value.length;R++){const pe=X.value[R];if(ie>=pe.min&&ie<=pe.max){be=R,u[R]++;break}}if(be>=0){const R=X.value[be];try{_.value==="monitoringPoints"?C.setStyle({fillColor:R.color,color:R.color,fillOpacity:.95,opacity:1,weight:2}):_.value==="beijingReservoirs"&&C.setStyle({fillColor:R.color,color:R.color,fillOpacity:.8,opacity:.9,weight:1.5}),c++}catch(pe){console.error(`样式应用失败 (要素 ${x}):`,pe)}}}),console.log("8. 渲染完成统计:"),console.log("  - 成功应用样式的要素数量:",c),console.log("  - 分级统计:",u),No.value=`${Z.value} 等量分级`,_o.value=X.value.map((C,x)=>({...C,count:u[x]})),ge.value=!0;const p=e.length,d=Math.ceil(p/oe.value),y=u.reduce((C,x)=>C+Math.pow(x-d,2),0)/oe.value,D=Math.sqrt(y),j=`✅ 等量分级渲染完成，共${p}个要素，每个级别期望${d}个，标准差${D.toFixed(2)}`;console.log("🎉 渲染成功:",j),U.value=j}catch(e){console.error("❌ 分级渲染失败:",e),console.error("错误堆栈:",e.stack),U.value="分级渲染失败: "+e.message}},ln=()=>{const o=P[_.value];o&&o.resetStyle(),X.value=[],ge.value=!1,U.value=""};Oo(()=>{console.log("MapEditor组件已挂载，开始初始化..."),Yo(),Ho(),_.value="monitoringPoints",Z.value="年平均氨氮",oe.value=3,X.value=[],ge.value=!1,r.isActive=!1,r.annotations=[],r.autoAnnotations=[],r.manualAnnotations=[],eo(),I.value.clear(),Ee.value.clear(),Be(()=>{const o=document.getElementById("editor-map");o&&(console.log("地图容器状态检查:"),console.log("地图容器元素:",o),console.log("地图容器CSS类:",o.className),console.log("地图容器样式:",o.style.cssText),console.log("地图容器尺寸:",o.offsetWidth,"x",o.offsetHeight),console.log("地图容器位置:",o.offsetLeft,o.offsetTop),console.log("地图容器z-index:",getComputedStyle(o).zIndex),o.style.willChange="transform",o.style.transform="translateZ(0)"),s.value&&(s.value.options.preferCanvas=!0,s.value.options.updateWhenZooming=!1,s.value.options.updateWhenIdle=!0,s.value.options.keepBuffer=2,console.log("全局性能优化已应用"))}),window.addEventListener("resize",Po),setTimeout(()=>{re.value&&(console.log("备用机制：强制关闭加载状态并显示基本地图"),re.value=!1,Re())},8e3)}),Dn(()=>{console.log("MapEditor组件卸载，开始清理资源..."),window.removeEventListener("resize",Po),document.removeEventListener("mousemove",$e),document.removeEventListener("mouseup",Se),document.removeEventListener("touchmove",$e),document.removeEventListener("touchend",Se),s.value&&(s.value.off("resize"),s.value.off("zoomend"),s.value.off("move"),s.value.off("moveend"),s.value.off("dragstart"),s.value.off("drag"),s.value.off("dragend"),s.value.off("click"),s.value.remove(),s.value=null),r.annotations.length>0&&(r.annotations.forEach(o=>{var e;if(o.layer)try{(e=s.value)==null||e.removeLayer(o.layer)}catch(t){console.log("清理标注图层时出错:",t)}}),r.annotations=[],r.autoAnnotations=[],r.manualAnnotations=[]),console.log("MapEditor组件资源清理完成"),to()});const sn=()=>{eo(),r.availableFields.length>0&&(r.selectedField=r.availableFields[0].value),oo(),console.log('图层已切换，请手动点击"生成字段标注"按钮')},an=()=>{oo(),console.log('字段已切换，请手动点击"生成字段标注"按钮')},eo=()=>{const o=r.selectedLayer;o==="monitoringPoints"?r.availableFields=[{value:"年平均氨氮",label:"年平均氨氮 (mg/L)"},{value:"年平均高猛酸盐",label:"年平均高猛酸盐 (mg/L)"},{value:"年平均化学需氧量",label:"年平均化学需氧量 (mg/L)"},{value:"年平均流量",label:"年平均流量 (m³/s)"},{value:"年平均水深",label:"年平均水深 (m)"},{value:"年平均总氮",label:"年平均总氮 (mg/L)"},{value:"年平均总磷",label:"年平均总磷 (mg/L)"}]:o==="beijingReservoirs"?r.availableFields=[{value:"库名",label:"库名"},{value:"多年平均库水位",label:"多年平均库水位 (m)"},{value:"多年平均蓄水量",label:"多年平均蓄水量 (万m³)"},{value:"多年日平均入库流量",label:"多年日平均入库流量 (m³/s)"},{value:"多年日平均出库流量",label:"多年日平均出库流量 (m³/s)"},{value:"总库容",label:"总库容 (万m³)"},{value:"汛限水位",label:"汛限水位 (m)"}]:o==="settlements"?r.availableFields=[{value:"NAME",label:"居民点名称"}]:o==="districts"?r.availableFields=[{value:"NAME",label:"行政区划名称"}]:o==="waterLines"&&(r.availableFields=[{value:"name",label:"河流名称"}])},oo=()=>{console.log("清除自动标注被调用，当前自动标注数量:",r.autoAnnotations.length),console.log("调用栈:",new Error().stack),r.autoAnnotations.forEach(t=>{t.layer&&(console.log("移除标注图层:",t.text),s.value.removeLayer(t.layer))}),r.autoAnnotations=[];const o=r.annotations.length;r.annotations=r.annotations.filter(t=>t.type!=="auto");const e=r.annotations.length;console.log(`总标注数组从 ${o} 减少到 ${e}`)},Vo=()=>{if(console.log("开始生成字段标注..."),!r.showAutoLabels){console.log("自动标注已禁用");return}if(!r.selectedField){console.warn("请先选择要标注的字段"),h("⚠️ 请先选择要标注的字段","warning");return}const o=P[r.selectedLayer];if(!o){console.warn("选择的图层未加载:",r.selectedLayer),h("❌ 选择的图层未加载","warning");return}console.log("选择的图层:",r.selectedLayer),console.log("选择的字段:",r.selectedField),console.log("图层对象:",o),oo();let e=0;o.eachLayer(t=>{const l=t.feature;if(l&&l.properties){console.log("处理要素:",l.properties);const i=yt(l,t);i&&(i.layer=ao(i),r.autoAnnotations.push(i),r.annotations.push(i),e++,console.log("创建标注成功:",i))}}),console.log("生成的标注数量:",e),console.log("当前标注数组:",r.annotations),e>0?h(`✅ 成功生成 ${e} 个字段标注`,"success"):h("⚠️ 未找到可标注的字段数据","warning"),console.log("标注生成完成，直接显示在地图上")},rn=o=>{try{const{type:e,feature:t,layer:l}=o;if(e==="monitoringPoints"||e==="settlements"){const i=t.geometry.coordinates,a=E.latLng(i[1],i[0]);return E.circleMarker(a,{radius:12,fillColor:"#ff0000",color:"#ffffff",weight:3,opacity:1,fillOpacity:.8})}else if(e==="waterLines"){const a=t.geometry.coordinates.map(u=>E.latLng(u[1],u[0]));return E.polyline(a,{color:"#ff0000",weight:6,opacity:1})}else{const a=t.geometry.coordinates[0].map(u=>E.latLng(u[1],u[0]));return E.polygon(a,{fillColor:"#ffcccc",color:"#ff0000",weight:3,fillOpacity:.6})}}catch(e){return console.error("创建要素高亮图层失败:",e),null}},to=()=>{I.value.clear(),Ee.value.forEach(o=>{s.value&&o&&s.value.removeLayer(o)}),Ee.value.clear(),console.log("所有要素选择已清除")},no=o=>{if(s.value)switch(console.log("地图点击事件:",o.latlng),S.value){case"zoomIn":handleZoomInClick(o.latlng);break;case"zoomOut":handleZoomOutClick(o.latlng);break;case"selectFeature":mn(o);break;case"identifyFeature":vn(o);break;case"annotation":mt(o.latlng);break}},Bo=()=>{if(console.log("开始绘制模式:",{map:!!s.value,zoomMode:N.value,isDrawing:T.value}),!s.value){console.error("地图未初始化"),h("❌ 地图未初始化","warning");return}try{T.value=!1,N.value="",s.value&&s.value.dragging.enable(),Y.value&&(s.value.removeLayer(Y.value),Y.value=null),s.value.off("mousedown"),s.value.off("mousemove"),s.value.off("mouseup"),document.removeEventListener("keydown",uo),s.value&&(s.value.off("click"),s.value.on("click",no),console.log("地图点击事件监听器已重新绑定")),T.value=!0,Y.value=E.layerGroup().addTo(s.value),N.value==="rectangle"&&Vt(),console.log("绘制模式启动成功")}catch(o){console.error("启动绘制模式失败:",o),h("❌ 启动绘制模式失败","warning"),q()}},q=()=>{console.log("finishDrawing被调用，当前activeMapTool:",S.value),T.value=!1,N.value="",s.value&&s.value.dragging.enable(),Y.value&&(s.value.removeLayer(Y.value),Y.value=null),s.value.off("mousedown"),s.value.off("mousemove"),s.value.off("mouseup"),document.removeEventListener("keydown",uo),s.value&&(s.value.off("click"),s.value.on("click",no),console.log("地图点击事件监听器已重新绑定，支持按点放大和缩小功能")),console.log("绘制模式已清理，地图点击事件已重新绑定")},un=()=>{console.log("取消绘制被调用"),T.value=!1,S.value="",N.value="",s.value&&s.value.dragging.enable(),Y.value&&(s.value.removeLayer(Y.value),Y.value=null),s.value.off("mousedown"),s.value.off("mousemove"),s.value.off("mouseup"),document.removeEventListener("keydown",uo),s.value&&(s.value.off("click"),s.value.on("click",no),console.log("地图点击事件监听器已重新绑定")),console.log("绘制模式已取消")},cn=()=>{const o=document.getElementById("editor-map");o&&(o.style.cursor="zoom-in",console.log("强制设置放大鼠标样式"))},dn=()=>{const o=document.getElementById("editor-map");o&&(o.style.cursor="zoom-out",console.log("强制设置缩小鼠标样式"))},vn=o=>{if(!s.value)return;console.log("开始处理要素识别，点击位置:",o.latlng);const e=Ro(o.latlng);console.log("找到的要素:",e),e?(gn(e),h("✅ 要素识别成功","success")):h("❌ 未找到要素","warning")},gn=o=>{const{type:e,feature:t,layer:l}=o;if(t.properties){const i=pn(t.properties,e);let a;e==="monitoringPoints"||e==="settlements"?a=l.getLatLng():a=l.getBounds().getCenter(),E.popup({closeButton:!0,maxWidth:300,className:"feature-info-popup"}).setLatLng(a).setContent(i).openOn(s.value)}},h=(o,e="info")=>{const t=document.querySelector(".zoom-message");t&&t.remove();const l=document.createElement("div");l.className=`zoom-message zoom-message-${e}`,l.textContent=o;const i=document.getElementById("editor-map");i&&(i.appendChild(l),setTimeout(()=>{l.parentNode&&l.parentNode.removeChild(l)},2e3))},pn=(o,e)=>{let t='<div class="feature-info">';t+=`<h4>${Je(e)}信息</h4>`;for(const[l,i]of Object.entries(o))if(i!=null&&i!==""){const a=Rt(l),u=Ot(i);t+=`<div class="info-row"><strong>${a}:</strong> ${u}</div>`}return t+="</div>",t},mn=o=>{if(!s.value)return;console.log("开始处理要素选择，点击位置:",o.latlng);const e=Ro(o.latlng);if(console.log("找到的要素:",e),e){const t=xn(e);console.log("生成的要素ID:",t),I.value.has(t)?(console.log("要素已被选择，执行取消选择"),kn(t,e),h("✅ 已取消选择要素","success")):(console.log("要素未被选择，执行选择"),Ln(t,e),h("✅ 已选择要素","success"))}else console.log("未找到要素，点击空白区域"),I.value.size>0&&(to(),h("🗑️ 已清除所有要素选择","info"))},Ro=o=>{if(!s.value)return null;console.log("开始查找要素，点击位置:",o),console.log("当前图层状态:",F),console.log("图层对象:",P);for(const[e,t]of Object.entries(P)){if(!F[e]||!t){console.log(`跳过${e}图层:`,{visible:F[e],layer:!!t});continue}console.log(`检查${e}图层:`,t);try{if(e==="monitoringPoints"||e==="settlements"){console.log(`在${e}图层中查找点要素`);const l=fn(t,o);if(l)return console.log(`在${e}图层中找到点要素:`,l),{type:e,feature:l,layer:t}}else if(e==="waterLines"){console.log(`在${e}图层中查找线要素`);const l=hn(t,o);if(l)return console.log(`在${e}图层中找到线要素:`,l),{type:e,feature:l,layer:t}}else{console.log(`在${e}图层中查找面要素`);const l=yn(t,o);if(l)return console.log(`在${e}图层中找到面要素:`,l),{type:e,feature:l,layer:t}}}catch(l){console.error(`查找${e}图层要素时出错:`,l)}}return console.log("未找到任何要素"),null},fn=(o,e)=>{let t=null,l=1/0;return console.log("开始查找点要素，图层:",o),console.log("点击位置:",e),o.eachLayer(i=>{if(i.getLatLng){const a=i.getLatLng(),u=e.distanceTo(a);console.log("检查子图层:",{sublayer:i,latlng:a,distance:u}),u<20&&u<l&&(l=u,t=i.feature,console.log("找到更近的点要素:",{foundFeature:t,distance:u}))}else console.log("子图层没有getLatLng方法:",i)}),console.log("点要素查找结果:",{foundFeature:t,minDistance:l}),t},yn=(o,e)=>{let t=null;return o.eachLayer(l=>{if(l.getBounds&&l.getBounds().contains(e))return t=l.feature,!1}),t},hn=(o,e)=>{let t=null,l=1/0;return o.eachLayer(i=>{if(i.getLatLngs){const a=bn(e,i.getLatLngs());a<15&&a<l&&(l=a,t=i.feature)}}),t},bn=(o,e)=>{let t=1/0;for(let l=0;l<e.length-1;l++){const i=wn(o,e[l],e[l+1]);i<t&&(t=i)}return t},wn=(o,e,t)=>{const l=o.lat-e.lat,i=o.lng-e.lng,a=t.lat-e.lat,u=t.lng-e.lng,c=l*a+i*u,p=a*a+u*u;if(p===0)return o.distanceTo(e);let d=c/p;if(d<0)return o.distanceTo(e);if(d>1)return o.distanceTo(t);const m=e.lat+d*a,y=e.lng+d*u;return o.distanceTo(E.latLng(m,y))},xn=o=>{const e=o.type,t=o.feature;return t.properties&&t.properties.id?`${t.properties.id}_${e}`:t.properties&&t.properties.NAME?`${t.properties.NAME}_${e}`:t.properties&&t.properties.name?`${t.properties.name}_${e}`:`${e}_${Date.now()}_${Math.random()}`},Ln=(o,e)=>{I.value.add(o);const t=rn(e);t&&(Ee.value.set(o,t),t.addTo(s.value)),console.log("要素已选择:",o,e)},kn=(o,e)=>{I.value.delete(o);const t=Ee.value.get(o);t&&(s.value.removeLayer(t),Ee.value.delete(o)),console.log("要素已取消选择:",o,e)};return(o,e)=>(v(),g("div",tl,[ke(ol,{title:"电子地图"}),n("div",nl,[n("div",{id:"editor-map",class:W(["editor-map",{"zoom-in-cursor":S.value==="zoomIn","zoom-out-cursor":S.value==="zoomOut","grab-cursor":S.value==="pan","grabbing-cursor":Ae.value,"pointer-cursor":S.value==="selectFeature","info-cursor":S.value==="identifyFeature","rectangle-drawing":S.value==="rectangleZoom","drawing-mode":T.value}])},null,2),n("div",{class:W(["control-panel",{"panel-hidden":!De.value}])},[n("div",ll,[e[69]||(e[69]=n("h3",null,"图层控制",-1)),n("button",{class:"panel-toggle-btn",onClick:Ko},L(De.value?"∧":"∨"),1)]),k(n("div",sl,[n("div",al,[n("label",null,[k(n("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=t=>F.districts=t),onChange:e[1]||(e[1]=t=>ze("districts"))},null,544),[[G,F.districts]]),e[70]||(e[70]=z(" 行政区划 ",-1))]),n("div",il,[n("div",{class:"color-preview",style:fe({backgroundColor:M.districts}),onClick:e[2]||(e[2]=t=>Ie("districts"))},null,4),k(n("input",{type:"color","onUpdate:modelValue":e[3]||(e[3]=t=>M.districts=t),onChange:e[4]||(e[4]=t=>Ne("districts")),class:"color-input","data-layer":"districts"},null,544),[[O,M.districts]])])]),n("div",rl,[n("label",null,[k(n("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=t=>F.waterLines=t),onChange:e[6]||(e[6]=t=>ze("waterLines"))},null,544),[[G,F.waterLines]]),e[71]||(e[71]=z(" 河流 ",-1))]),n("div",ul,[n("div",{class:"color-preview",style:fe({backgroundColor:M.waterLines}),onClick:e[7]||(e[7]=t=>Ie("waterLines"))},null,4),k(n("input",{type:"color","onUpdate:modelValue":e[8]||(e[8]=t=>M.waterLines=t),onChange:e[9]||(e[9]=t=>Ne("waterLines")),class:"color-input","data-layer":"waterLines"},null,544),[[O,M.waterLines]])])]),n("div",cl,[n("label",null,[k(n("input",{type:"checkbox","onUpdate:modelValue":e[10]||(e[10]=t=>F.beijingReservoirs=t),onChange:e[11]||(e[11]=t=>ze("beijingReservoirs"))},null,544),[[G,F.beijingReservoirs]]),e[72]||(e[72]=z(" 水库 ",-1))]),n("div",dl,[n("div",{class:"color-preview",style:fe({backgroundColor:M.beijingReservoirs}),onClick:e[12]||(e[12]=t=>Ie("beijingReservoirs"))},null,4),k(n("input",{type:"color","onUpdate:modelValue":e[13]||(e[13]=t=>M.beijingReservoirs=t),onChange:e[14]||(e[14]=t=>Ne("beijingReservoirs")),class:"color-input","data-layer":"beijingReservoirs"},null,544),[[O,M.beijingReservoirs]])])]),n("div",vl,[n("label",null,[k(n("input",{type:"checkbox","onUpdate:modelValue":e[15]||(e[15]=t=>F.monitoringPoints=t),onChange:e[16]||(e[16]=t=>ze("monitoringPoints"))},null,544),[[G,F.monitoringPoints]]),e[73]||(e[73]=z(" 监测点 ",-1))]),n("div",gl,[n("div",{class:"color-preview point-preview",style:fe({backgroundColor:M.monitoringPoints}),onClick:e[17]||(e[17]=t=>Ie("monitoringPoints"))},null,4),k(n("input",{type:"color","onUpdate:modelValue":e[18]||(e[18]=t=>M.monitoringPoints=t),onChange:e[19]||(e[19]=t=>Ne("monitoringPoints")),class:"color-input","data-layer":"monitoringPoints"},null,544),[[O,M.monitoringPoints]])])]),n("div",pl,[n("label",null,[k(n("input",{type:"checkbox","onUpdate:modelValue":e[20]||(e[20]=t=>F.settlements=t),onChange:e[21]||(e[21]=t=>ze("settlements"))},null,544),[[G,F.settlements]]),e[74]||(e[74]=z(" 居民点 ",-1))]),n("div",ml,[n("div",{class:"color-preview point-preview",style:fe({backgroundColor:M.settlements}),onClick:e[22]||(e[22]=t=>Ie("settlements"))},null,4),k(n("input",{type:"color","onUpdate:modelValue":e[23]||(e[23]=t=>M.settlements=t),onChange:e[24]||(e[24]=t=>Ne("settlements")),class:"color-input","data-layer":"settlements"},null,544),[[O,M.settlements]])])])],512),[[zn,De.value]])],2),le.value?(v(),g("div",fl,[n("span",{class:"img-panel-close",onClick:e[25]||(e[25]=t=>le.value=!1),title:"关闭"},"×"),Ke.value?(v(),g("img",{key:0,src:Ke.value,alt:w.value,class:"reservoir-img-main",onerror:"this.style.display='none'"},null,8,yl)):f("",!0),n("div",hl,L(Wt()),1),se.value==="beijingReservoirs"&&ae[w.value]?(v(),g("div",bl,[e[86]||(e[86]=n("div",{class:"details-title"},"水库详细信息",-1)),n("div",wl,[n("div",xl,[e[75]||(e[75]=n("span",{class:"detail-label"},"中文名：",-1)),n("span",Ll,L(ae[w.value].中文名),1)]),n("div",kl,[e[76]||(e[76]=n("span",{class:"detail-label"},"面积：",-1)),n("span",Ml,L(ae[w.value].面积),1)]),n("div",Cl,[e[77]||(e[77]=n("span",{class:"detail-label"},"所属地区：",-1)),n("span",El,L(ae[w.value].所属地区),1)]),n("div",Al,[e[78]||(e[78]=n("span",{class:"detail-label"},"平均水深：",-1)),n("span",$l,L(ae[w.value].平均水深),1)]),n("div",Sl,[e[79]||(e[79]=n("span",{class:"detail-label"},"建库时间：",-1)),n("span",Pl,L(ae[w.value].建库时间),1)]),n("div",Fl,[e[80]||(e[80]=n("span",{class:"detail-label"},"水系：",-1)),n("span",Dl,L(ae[w.value].水系),1)]),n("div",zl,[e[81]||(e[81]=n("span",{class:"detail-label"},"投用时间：",-1)),n("span",Tl,L(ae[w.value].投用时间),1)]),n("div",Il,[e[82]||(e[82]=n("span",{class:"detail-label"},"库容：",-1)),n("span",Nl,L(ae[w.value].库容),1)])]),n("div",_l,[n("button",{class:"reservoir-btn reservoir-params-btn",onClick:e[26]||(e[26]=t=>co.value=!0)},e[83]||(e[83]=[n("span",{class:"btn-icon"},"📊",-1),z(" 水库基本信息 ",-1)])),n("button",{class:"reservoir-btn flood-history-btn",onClick:e[27]||(e[27]=t=>he.value=!0)},e[84]||(e[84]=[n("span",{class:"btn-icon"},"📚",-1),z(" 防洪历史 ",-1)])),w.value==="密云水库"?(v(),g("button",{key:0,class:"reservoir-btn play-video-btn",onClick:qt},e[85]||(e[85]=[n("span",{class:"btn-icon"},"▶️",-1),z(" 播放视频 ",-1)]))):f("",!0)])])):f("",!0),se.value==="monitoringPoints"&&$.value?(v(),g("div",jl,[n("div",Vl,[n("div",Bl,[e[87]||(e[87]=n("span",{class:"detail-label"},"监测点名称：",-1)),n("span",Rl,L($.value.name||$.value.库名||$.value.NAME||"未知"),1)]),$.value.年平均氨氮?(v(),g("div",Ol,[e[88]||(e[88]=n("span",{class:"detail-label"},"年平均氨氮：",-1)),n("span",Zl,L($.value.年平均氨氮)+" mg/L",1)])):f("",!0),$.value.年平均高猛酸盐?(v(),g("div",Ul,[e[89]||(e[89]=n("span",{class:"detail-label"},"年平均高猛酸盐：",-1)),n("span",Wl,L($.value.年平均高猛酸盐)+" mg/L",1)])):f("",!0),$.value.年平均化学需氧量?(v(),g("div",Yl,[e[90]||(e[90]=n("span",{class:"detail-label"},"年平均化学需氧量：",-1)),n("span",Hl,L($.value.年平均化学需氧量)+" mg/L",1)])):f("",!0),$.value.年平均流量?(v(),g("div",Xl,[e[91]||(e[91]=n("span",{class:"detail-label"},"年平均流量：",-1)),n("span",ql,L($.value.年平均流量)+" m³/s",1)])):f("",!0),$.value.年平均水深?(v(),g("div",Gl,[e[92]||(e[92]=n("span",{class:"detail-label"},"年平均水深：",-1)),n("span",Ql,L($.value.年平均水深)+" m",1)])):f("",!0),$.value.年平均总氮?(v(),g("div",Jl,[e[93]||(e[93]=n("span",{class:"detail-label"},"年平均总氮：",-1)),n("span",Kl,L($.value.年平均总氮)+" mg/L",1)])):f("",!0),$.value.年平均总磷?(v(),g("div",es,[e[94]||(e[94]=n("span",{class:"detail-label"},"年平均总磷：",-1)),n("span",os,L($.value.年平均总磷)+" mg/L",1)])):f("",!0)])])):f("",!0)])):f("",!0),co.value?(v(),g("div",ts,[n("span",{class:"params-panel-close",onClick:e[28]||(e[28]=t=>co.value=!1)},"×"),n("div",ns,L(Yt()),1),n("div",ls,[$.value?(v(),g("div",ss,[se.value==="beijingReservoirs"?(v(),g("div",as,[(v(!0),g(we,null,xe(Zt(),t=>(v(),g("div",{key:t.key,class:"param-row"},[n("span",is,L(t.label)+"：",1),n("span",rs,L(Ut(t.key,$.value[t.key])),1)]))),128))])):se.value==="monitoringPoints"?(v(),g("div",us,[(v(!0),g(we,null,xe($.value,(t,l)=>(v(),g("div",{key:l,class:"param-row"},[n("span",cs,L(Ht(l))+"：",1),n("span",ds,L(Xt(l,t)),1)]))),128))])):f("",!0)])):(v(),g("div",vs,e[95]||(e[95]=[n("p",null,"暂无水库基本信息数据",-1)])))])])):f("",!0),he.value?(v(),g("div",gs,[n("span",{class:"history-panel-close",onClick:e[29]||(e[29]=t=>he.value=!1)},"×"),e[122]||(e[122]=n("div",{class:"history-title"},"防洪历史",-1)),n("div",ps,[w.value==="怀柔水库"?(v(),g("div",ms,e[96]||(e[96]=[n("h4",null,"历史防洪表现",-1),n("p",null,"怀柔水库自建成至1985年（27年间），有14年入库洪峰流量大于150立方米/秒，10年大于350立方米/秒，6年大于450立方米/秒。其中1972年入库洪峰流量达4245立方米/秒，为历史最大洪峰，比1939年洪峰2400立方米/秒多1845立方米/秒，但未发生洪水灾害。",-1)]))):f("",!0),w.value==="怀柔水库"?(v(),g("div",fs,e[97]||(e[97]=[n("h4",null,"2023年防洪总结",-1),n("p",null,'2023年8月21日，水利部召开"23·7"海河流域特大洪水防御新闻发布会。密云、怀柔水库累计拦蓄洪水14.68亿立方米，降低了潮白河水位，为北运河以西分洪创造了有利条件。',-1)]))):f("",!0),w.value==="怀柔水库"?(v(),g("div",ys,e[98]||(e[98]=[n("h4",null,"2024年蓄水情况",-1),n("p",null,"2024年6月12日，北京市利用南水北调配套密云水库调蓄工程进行反向调水，密云水库、怀柔水库、大宁调节池、十三陵水库累计蓄水约8亿立方米。",-1)]))):f("",!0),w.value==="怀柔水库"?(v(),g("div",hs,e[99]||(e[99]=[n("h4",null,"2024年泄洪情况",-1),n("p",null,"2024年7月26日12时起，怀柔水库开始向怀河有序泄洪，采用预泄方式，在确保下游安全的前提下，考虑上游来水情况。",-1)]))):f("",!0),w.value==="密云水库"?(v(),g("div",bs,e[100]||(e[100]=[n("h4",null,"防洪历史关键事件",-1),n("p",null,[n("strong",null,"建库前水患严重："),z("潮河、白河上游山势陡峭，水流湍急，下游河道平浅且无堤防，常常泛滥成灾。1958年7月中旬，密云连降暴雨，九松山地区降水量高达280.5毫米，潮河最大流量达3140立方米/秒，洪水涌进密云县城，东门、南门里积水1米多深，潮河沿岸20多个村、2700多人被洪水围困。")],-1),n("p",null,[n("strong",null,"建设期间的防洪隐患："),z("1958年密云水库动工建设，按要求1959年汛期前主副坝要修筑到143米的坝顶拦洪高程。但在建设过程中，白河主坝导流廊道的钢筋被抽掉且进水塔未建，导致泄洪存在危险。后来经过测算，估算出廊道安全泄洪的最高水位为130米高程，并千方百计补建进水塔，以保证水库安全度汛。")],-1),n("p",null,[n("strong",null,"建成后防洪成效显著："),z("1960年密云水库建成运行后，全部拦蓄了上游发生的各次洪水，使下游耕地免遭水灾，保护了下游农田600万亩。截至2020年8月底，密云水库拦蓄大于等于1000立方米/秒的入库洪峰30余次。其中，1994年7月13日出现建库以来最大洪峰流量3670立方米/秒。")],-1),n("p",null,[n("strong",null,"2025年防洪新挑战："),z("2025年7月27日3时，密云水库入库流量达到6550立方米/秒，超过1994年的历史最高值。28日8时，入库流量达4550立方米/秒，为历史第二洪峰。此次洪水过程中，密云水库充分发挥拦洪削峰作用，7月23日8时至7月29日19时，累计入库水量达8.1亿立方米，累计出库水量1.8亿立方米。")],-1)]))):f("",!0),w.value==="密云水库"?(v(),g("div",ws,e[101]||(e[101]=[n("h4",null,"历史径流量变化",-1),n("p",null,[n("strong",null,"多年平均径流量变化："),z("根据之前的分析数据，60年代以前流域多年平均径流量为15亿立方米，20世纪80年代末减少到7-8亿立方米，90年代后半期减少到2-3亿立方米。而根据2025年的信息，密云水库多年平均入库流量为27.1立方米/秒，多年平均入库径流量约为8.55亿立方米。")],-1),n("p",null,[n("strong",null,"特殊时期径流量变化："),z("2025年7月26日-8月2日，密云水库最大7天入库水量达9.8亿立方米，为历史最大值，超过1974年7月25日的7.14亿立方米。2025年7月27日3时入库流量6550立方米/秒，远超多年平均入库流量，是其242倍。")],-1)]))):f("",!0),w.value==="北台上水库"?(v(),g("div",xs,e[102]||(e[102]=[n("h4",null,"水库概况",-1),n("p",null,"北台上水库位于北京市怀柔区，是一座中型水库，总库容1.2亿立方米，主要承担防洪、供水、灌溉等综合功能。",-1)]))):f("",!0),w.value==="北台上水库"?(v(),g("div",Ls,e[103]||(e[103]=[n("h4",null,"防洪功能",-1),n("p",null,"北台上水库是潮白河流域的重要防洪工程，通过拦蓄洪水，有效保护下游地区的防洪安全，在多次洪水期间发挥了重要作用。",-1)]))):f("",!0),w.value==="北台上水库"?(v(),g("div",ks,e[104]||(e[104]=[n("h4",null,"供水作用",-1),n("p",null,"北台上水库为周边地区提供农业灌溉用水和生态补水，是区域水资源调配的重要组成部分。",-1)]))):f("",!0),w.value==="北台上水库"?(v(),g("div",Ms,e[105]||(e[105]=[n("h4",null,"生态价值",-1),n("p",null,"北台上水库周边生态环境良好，是重要的湿地生态系统，为野生动植物提供了良好的栖息环境。",-1)]))):f("",!0),w.value==="十三陵水库"?(v(),g("div",Cs,e[106]||(e[106]=[n("h4",null,"水库概况",-1),n("p",null,"十三陵水库位于北京市昌平区，是一座中型水库，总库容2.8亿立方米，主要承担防洪、供水、灌溉等综合功能，是温榆河流域的重要水利工程。",-1)]))):f("",!0),w.value==="十三陵水库"?(v(),g("div",Es,e[107]||(e[107]=[n("h4",null,"防洪功能",-1),n("p",null,"十三陵水库是温榆河流域的重要防洪工程，通过拦蓄洪水，有效保护下游北京城区和周边地区的防洪安全，在多次洪水期间发挥了重要作用。",-1)]))):f("",!0),w.value==="十三陵水库"?(v(),g("div",As,e[108]||(e[108]=[n("h4",null,"供水作用",-1),n("p",null,"十三陵水库为昌平区及周边地区提供农业灌溉用水和生态补水，是区域水资源调配的重要组成部分，保障了区域供水安全。",-1)]))):f("",!0),w.value==="十三陵水库"?(v(),g("div",$s,e[109]||(e[109]=[n("h4",null,"旅游价值",-1),n("p",null,"十三陵水库周边环境优美，是重要的旅游休闲场所，与明十三陵景区相呼应，形成了独特的人文景观。",-1)]))):f("",!0),w.value==="官厅水库"?(v(),g("div",Ss,e[110]||(e[110]=[n("h4",null,"水库概况",-1),n("p",null,"官厅水库位于北京市延庆区，是一座大型水库，总库容41.6亿立方米，是北京市最大的水库之一，主要承担防洪、供水、发电等综合功能，是永定河流域的重要水利工程。",-1)]))):f("",!0),w.value==="官厅水库"?(v(),g("div",Ps,e[111]||(e[111]=[n("h4",null,"防洪功能",-1),n("p",null,"官厅水库是永定河流域的重要防洪工程，通过拦蓄洪水，有效保护下游北京城区和周边地区的防洪安全，在多次特大洪水期间发挥了关键作用。",-1)]))):f("",!0),w.value==="官厅水库"?(v(),g("div",Fs,e[112]||(e[112]=[n("h4",null,"供水作用",-1),n("p",null,"官厅水库为北京市提供重要的饮用水源，通过南水北调工程，为北京城市供水系统提供补充水源，保障了首都供水安全。",-1)]))):f("",!0),w.value==="官厅水库"?(v(),g("div",Ds,e[113]||(e[113]=[n("h4",null,"发电功能",-1),n("p",null,"官厅水库建有水力发电站，为北京市提供清洁能源，是北京市重要的可再生能源基地之一。",-1)]))):f("",!0),w.value==="崇青水库"?(v(),g("div",zs,e[114]||(e[114]=[n("h4",null,"水库概况",-1),n("p",null,"崇青水库位于北京市怀柔区，是一座小型水库，总库容0.8亿立方米，主要承担防洪、灌溉、生态补水等综合功能，是潮白河流域的重要水利工程。",-1)]))):f("",!0),w.value==="崇青水库"?(v(),g("div",Ts,e[115]||(e[115]=[n("h4",null,"防洪功能",-1),n("p",null,"崇青水库是潮白河流域的重要防洪工程，通过拦蓄洪水，有效保护下游地区的防洪安全，在多次洪水期间发挥了重要作用。",-1)]))):f("",!0),w.value==="崇青水库"?(v(),g("div",Is,e[116]||(e[116]=[n("h4",null,"灌溉作用",-1),n("p",null,"崇青水库为周边农田提供灌溉用水，保障了农业生产的稳定，是区域农业发展的重要水源保障。",-1)]))):f("",!0),w.value==="崇青水库"?(v(),g("div",Ns,e[117]||(e[117]=[n("h4",null,"生态价值",-1),n("p",null,"崇青水库周边生态环境良好，为野生动植物提供了良好的栖息环境，是重要的生态保护区域。",-1)]))):f("",!0),w.value==="斋堂水库"?(v(),g("div",_s,e[118]||(e[118]=[n("h4",null,"水库概况",-1),n("p",null,"斋堂水库位于北京市门头沟区，是一座中型水库，总库容1.5亿立方米，主要承担防洪、供水、灌溉等综合功能，是永定河流域的重要水利工程。",-1)]))):f("",!0),w.value==="斋堂水库"?(v(),g("div",js,e[119]||(e[119]=[n("h4",null,"防洪功能",-1),n("p",null,"斋堂水库是永定河流域的重要防洪工程，通过拦蓄洪水，有效保护下游门头沟区和周边地区的防洪安全，在多次洪水期间发挥了重要作用。",-1)]))):f("",!0),w.value==="斋堂水库"?(v(),g("div",Vs,e[120]||(e[120]=[n("h4",null,"供水作用",-1),n("p",null,"斋堂水库为门头沟区及周边地区提供生活用水和农业灌溉用水，是区域水资源调配的重要组成部分。",-1)]))):f("",!0),w.value==="斋堂水库"?(v(),g("div",Bs,e[121]||(e[121]=[n("h4",null,"生态保护",-1),n("p",null,"斋堂水库周边生态环境优美，是重要的生态保护区域，为野生动植物提供了良好的栖息环境。",-1)]))):f("",!0)])])):f("",!0),n("div",Rs,[n("img",{src:Nn,alt:"打开mxd",title:"打开mxd",onClick:rt}),n("div",Os,[n("img",{src:_n,alt:"放大",title:"放大",onClick:e[30]||(e[30]=t=>B("zoomIn")),class:W({"active-tool":A.zoomIn.isActive||A.rectangleZoom.isActive})},null,2),ce.value?(v(),g("div",Zs,[n("div",{class:"zoom-option",onClick:e[31]||(e[31]=t=>B("zoomIn"))},e[123]||(e[123]=[n("span",null,"按点放大",-1)])),n("div",{class:"zoom-option",onClick:e[32]||(e[32]=t=>B("rectangleZoom"))},e[124]||(e[124]=[n("span",null,"拉框放大",-1)]))])):f("",!0)]),T.value?(v(),g("div",{key:0,class:"cancel-drawing-btn",onClick:un},e[125]||(e[125]=[n("span",null,"❌",-1)]))):f("",!0),n("div",Us,[n("img",{src:jn,alt:"缩小",title:"缩小",onClick:e[33]||(e[33]=t=>B("zoomOut")),class:W({"active-tool":A.zoomOut.isActive||A.rectangleZoomOut.isActive})},null,2),ne.value?(v(),g("div",Ws,[n("div",{class:"zoom-option",onClick:e[34]||(e[34]=t=>B("zoomOut"))},e[126]||(e[126]=[n("span",null,"按点缩小",-1)])),n("div",{class:"zoom-option",onClick:e[35]||(e[35]=t=>B("rectangleZoomOut"))},e[127]||(e[127]=[n("span",null,"拉框缩小",-1)]))])):f("",!0)]),n("img",{src:Vn,alt:"全图",title:"全图",onClick:wo}),n("img",{src:Bn,alt:"平移",title:"平移",onClick:e[36]||(e[36]=t=>B("pan")),class:W({"active-tool":A.pan.isActive})},null,2),n("img",{src:Rn,alt:"选择要素",title:"选择要素",onClick:e[37]||(e[37]=t=>B("selectFeature")),class:W({"active-tool":A.selectFeature.isActive})},null,2),I.value.size>0?(v(),g("div",{key:1,class:"clear-selection-btn",onClick:to,title:"清除所有选择"},e[128]||(e[128]=[n("span",null,"🗑️",-1)]))):f("",!0),n("img",{src:On,alt:"查询",title:"查询",onClick:e[38]||(e[38]=t=>B("query")),class:W({"active-tool":A.query.isActive})},null,2),n("img",{src:Zn,alt:"水库监测数据可视化渲染",title:"水库监测数据可视化渲染",onClick:e[39]||(e[39]=t=>B("render")),class:W({"active-tool":A.render.isActive})},null,2),n("img",{src:Un,alt:"识别要素",title:"识别要素",onClick:e[40]||(e[40]=t=>B("identifyFeature")),class:W({"active-tool":A.identifyFeature.isActive})},null,2),n("img",{src:Wn,alt:"标注",title:"标注",onClick:e[41]||(e[41]=t=>B("annotation")),class:W({"active-tool":A.annotation.isActive})},null,2),n("img",{src:Yn,alt:"返回上一视图",title:"返回上一视图",onClick:at,class:W({"disabled-tool":!vo.value})},null,2),n("img",{src:Hn,alt:"转至下一视图",title:"转至下一视图",onClick:it,class:W({"disabled-tool":!go.value})},null,2)]),A.query.isActive?(v(),g("div",{key:3,class:"search-bar-modal",ref_key:"queryPopup",ref:Ce},[n("div",Ys,[n("div",{class:"search-header",onMousedown:Co,onTouchstart:Co},[e[129]||(e[129]=n("h3",null,"图层查询",-1)),n("div",Hs,[n("span",{class:"search-reset",onClick:Lt,title:"重置位置"},"↺"),n("span",{class:"search-close",onClick:e[42]||(e[42]=t=>B("query"))},"×")])],32),n("div",Xs,[e[131]||(e[131]=n("label",{class:"layer-selection-label"},"选择查询图层：",-1)),k(n("select",{"onUpdate:modelValue":e[43]||(e[43]=t=>Qe.value=t),class:"layer-select-dropdown"},e[130]||(e[130]=[Zo('<option value="monitoringPoints" data-v-5094e410>监测点</option><option value="beijingReservoirs" data-v-5094e410>水库</option><option value="settlements" data-v-5094e410>居民点</option><option value="districts" data-v-5094e410>行政区划</option><option value="waterLines" data-v-5094e410>河流</option>',5)]),512),[[Le,Qe.value]])]),n("div",qs,[k(n("input",{"onUpdate:modelValue":e[44]||(e[44]=t=>Ve.value=t),onKeyup:Tn(To,["enter"]),class:"search-input",placeholder:Bt(),autofocus:""},null,40,Gs),[[O,Ve.value]]),n("button",{class:"search-btn",onClick:To},"查询")])]),de.value?(v(),g("div",Qs,L(de.value),1)):f("",!0)],512)):f("",!0),re.value?(v(),g("div",Js,[e[132]||(e[132]=n("div",{class:"loading-spinner"},null,-1)),e[133]||(e[133]=n("div",{class:"loading-text"},"正在加载地理数据...",-1)),n("div",Ks,[n("div",ea,[n("div",{class:"progress-fill",style:fe({width:ye.value+"%"})},null,4)]),n("div",oa,L(ye.value)+"%",1)]),n("button",{onClick:lt,class:"force-close-btn"},"跳过加载")])):f("",!0),n("input",{type:"file",ref_key:"mxdFileInput",ref:Io,style:{display:"none"},onChange:ut,accept:".mxd"},null,544),po.value?(v(),g("div",ta,[n("div",na,[n("h3",null,L(mo.value?mo.value.name:"MXD文档"),1),n("span",{class:"mxd-close-btn",onClick:e[45]||(e[45]=t=>po.value=!1)},"×")]),n("div",la,[n("div",sa,[n("div",aa,[e[135]||(e[135]=n("div",{class:"mxd-layer-group-header"},[n("img",{class:"folder-icon",src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgZmlsbD0iY3VycmVudENvbG9yIiBjbGFzcz0iYmkgYmkgZm9sZGVyMi1vcGVuIiB2aWV3Qm94PSIwIDAgMTYgMTYiPgogIDxwYXRoIGQ9Ik0xIDMuNUExLjUgMS41IDAgMCAxIDIuNSAyaDIuNzY0Yy4wNTggMCAuMTE1LjAxNy4xNjcuMDQ4LjA1Mi4wMzEuMS4wNzQuMTM0LjEyNkw2LjcwNyAzLjVIMTMuNWEuNSA1IDAgMCAxIDAgMUg2LjcwN2wtMS4xNDMgMS4zNTJBLjUuNSAwIDAgMSA1LjIzNiA2SDIuNUEuNS41IDAgMCAxIDIgNS41VjR6TTIuNSAzaDIuNzY0Yy4wNTggMCAuMTE1LjAxNy4xNjcuMDQ4LjA1Mi4wMzEuMS4wNzQuMTM0LjEyNkw2LjcwNyA0LjVIMTMuNWEuNS41IDAgMCAxIC41LjV2N2ExLjUgMS41IDAgMCAxLTEuNSAxLjVoLTlBMS41IDEuNSAwIDAgMSAyIDEyVjYuNWguNVYxMmExIDEgMCAwIDAgMSAxaDlhMSAxIDAgMCAwIDEtMVY1aC05LjVhLjUuNSAwIDAgMS0uNDI4LS4yMzJsLTEuMjQxLTEuNTM4QTEuNSAxLjUgMCAwIDAgLjk1IDNIMi41eiIvPgogPC9zdmc+"}),n("span",null,"图展")],-1)),n("div",ia,[(v(!0),g(we,null,xe(Pe.value.slice(1),t=>(v(),g("div",{key:t.id,class:"mxd-layer-item",style:{marginLeft:"20px"}},[k(n("input",{type:"checkbox",id:"mxd-layer-"+t.id,"onUpdate:modelValue":l=>t.visible=l,onChange:l=>ko(t)},null,40,ra),[[G,t.visible]]),n("label",{for:"mxd-layer-"+t.id,class:"layer-label"},[n("span",{class:"layer-icon",style:fe(ct(t))},null,4),n("span",ca,L(t.name),1)],8,ua)]))),128)),Pe.value[0].children&&Pe.value[0].children.length?(v(),g("div",da,[k(n("input",{type:"checkbox",id:"mxd-layer-beijing-resident-places","onUpdate:modelValue":e[46]||(e[46]=t=>Pe.value[0].children[0].visible=t),onChange:e[47]||(e[47]=t=>ko(Pe.value[0].children[0]))},null,544),[[G,Pe.value[0].children[0].visible]]),e[134]||(e[134]=n("label",{for:"mxd-layer-beijing-resident-places",class:"layer-label"},[n("span",{class:"layer-icon point-icon"}),n("span",{class:"layer-name"},"居民地地名")],-1))])):f("",!0)])])]),e[136]||(e[136]=n("div",{class:"mxd-properties"},[n("h4",null,"文档属性"),n("div",{class:"mxd-property-item"},[n("span",null,"文件大小:"),n("span",null,"592.00 KB")]),n("div",{class:"mxd-property-item"},[n("span",null,"修改日期:"),n("span",null,"2025/4/11 17:16:19")]),n("div",{class:"mxd-property-item"},[n("span",null,"图层数量:"),n("span",null,"8")])],-1))])])):f("",!0),A.render.isActive?(v(),g("div",{key:6,class:"render-modal",ref_key:"renderModal",ref:_e},[n("div",va,[n("div",{class:"render-modal-header",onMousedown:Eo,onTouchstart:Eo},[e[137]||(e[137]=n("span",null,"数据分级渲染",-1)),n("div",ga,[n("span",{class:"render-modal-reset",onClick:kt,title:"重置位置"},"↺"),n("span",{class:"render-modal-close",onClick:e[48]||(e[48]=t=>B("render"))},"×")])],32),n("div",pa,[n("div",ma,[e[139]||(e[139]=n("label",null,"图层：",-1)),k(n("select",{"onUpdate:modelValue":e[49]||(e[49]=t=>_.value=t),class:"render-select",onChange:Kt},e[138]||(e[138]=[n("option",{value:"monitoringPoints"},"监测点",-1),n("option",{value:"beijingReservoirs"},"水库",-1)]),544),[[Le,_.value]])]),n("div",fa,[e[140]||(e[140]=n("label",null,"字段：",-1)),k(n("select",{"onUpdate:modelValue":e[50]||(e[50]=t=>Z.value=t),class:"render-select",onChange:en},[(v(!0),g(we,null,xe(Jt.value,t=>(v(),g("option",{key:t.value,value:t.value},L(t.label),9,ya))),128))],544),[[Le,Z.value]])]),n("div",ha,[e[141]||(e[141]=n("label",null,"分级：",-1)),k(n("select",{"onUpdate:modelValue":e[51]||(e[51]=t=>oe.value=t),class:"render-select",onChange:on},[(v(),g(we,null,xe(6,t=>n("option",{key:t,value:t},L(t)+"级",9,ba)),64))],544),[[Le,oe.value]])]),n("div",{class:"render-row"},[n("button",{class:"render-btn",onClick:nn},"渲染"),n("button",{class:"render-reset-btn",onClick:ln},"重置")]),U.value?(v(),g("div",wa,L(U.value),1)):f("",!0)])])],512)):f("",!0),ge.value?(v(),g("div",xa,[n("div",La,[n("h4",null,L(No.value),1),n("span",{class:"legend-close",onClick:e[52]||(e[52]=t=>ge.value=!1)},"×")]),n("div",ka,[(v(!0),g(we,null,xe(_o.value,(t,l)=>(v(),g("div",{key:l,class:"legend-item"},[n("div",{class:"legend-color",style:fe({backgroundColor:t.color})},null,4),n("div",Ma,[n("span",Ca,L(t.min)+" - "+L(t.max),1),n("span",Ea,"("+L(t.count)+"个)",1)])]))),128))])])):f("",!0),r.isActive?(v(),g("div",{key:8,class:"annotation-control-panel",ref_key:"annotationControlPanel",ref:Me},[n("div",{class:"annotation-panel-header",onMousedown:Mo,onTouchstart:Mo},[e[142]||(e[142]=n("h4",null,"标注控制",-1)),n("div",Aa,[n("span",{class:"annotation-panel-reset",onClick:xt,title:"重置位置"},"🔄"),n("span",{class:"annotation-panel-close",onClick:e[53]||(e[53]=t=>r.isActive=!1)},"×")])],32),n("div",$a,[n("div",Sa,[e[146]||(e[146]=n("h5",null,"图层和字段选择",-1)),n("div",Pa,[e[144]||(e[144]=n("label",null,"选择图层:",-1)),k(n("select",{"onUpdate:modelValue":e[54]||(e[54]=t=>r.selectedLayer=t),onChange:sn,class:"annotation-select"},e[143]||(e[143]=[Zo('<option value="monitoringPoints" data-v-5094e410>监测点</option><option value="beijingReservoirs" data-v-5094e410>水库</option><option value="settlements" data-v-5094e410>居民点</option><option value="districts" data-v-5094e410>行政区划</option><option value="waterLines" data-v-5094e410>河流</option>',5)]),544),[[Le,r.selectedLayer]])]),n("div",Fa,[e[145]||(e[145]=n("label",null,"选择字段:",-1)),k(n("select",{"onUpdate:modelValue":e[55]||(e[55]=t=>r.selectedField=t),onChange:an,class:"annotation-select"},[(v(!0),g(we,null,xe(r.availableFields,t=>(v(),g("option",{key:t.value,value:t.value},L(t.label),9,Da))),128))],544),[[Le,r.selectedField]])]),n("div",{class:"control-item"},[n("button",{onClick:Vo,class:"annotation-btn"},"生成字段标注")])]),n("div",za,[e[150]||(e[150]=n("h5",null,"显示控制",-1)),n("div",Ta,[n("label",null,[k(n("input",{type:"checkbox","onUpdate:modelValue":e[56]||(e[56]=t=>r.showAutoLabels=t),onChange:je},null,544),[[G,r.showAutoLabels]]),e[147]||(e[147]=z(" 显示自动标注 ",-1))])]),n("div",Ia,[n("label",null,[k(n("input",{type:"checkbox","onUpdate:modelValue":e[57]||(e[57]=t=>r.showManualLabels=t)},null,512),[[G,r.showManualLabels]]),e[148]||(e[148]=z(" 显示手动标注 ",-1))])]),n("div",Na,[n("label",null,[k(n("input",{type:"checkbox","onUpdate:modelValue":e[58]||(e[58]=t=>r.overlapAvoidance=t),onChange:je},null,544),[[G,r.overlapAvoidance]]),e[149]||(e[149]=z(" 重叠避让 ",-1))])])]),n("div",_a,[e[153]||(e[153]=n("h5",null,"缩放控制",-1)),n("div",ja,[e[151]||(e[151]=n("label",null,"最小缩放:",-1)),k(n("input",{type:"number","onUpdate:modelValue":e[59]||(e[59]=t=>r.minZoom=t),min:"1",max:"20",onChange:ro},null,544),[[O,r.minZoom]])]),n("div",Va,[e[152]||(e[152]=n("label",null,"最大缩放:",-1)),k(n("input",{type:"number","onUpdate:modelValue":e[60]||(e[60]=t=>r.maxZoom=t),min:"1",max:"20",onChange:ro},null,544),[[O,r.maxZoom]])])]),n("div",Ba,[e[163]||(e[163]=n("h5",null,"样式设置",-1)),n("div",Ra,[e[154]||(e[154]=n("label",null,"字体大小:",-1)),k(n("input",{type:"number","onUpdate:modelValue":e[61]||(e[61]=t=>r.currentStyle.fontSize=t),min:"8",max:"32",onChange:ue},null,544),[[O,r.currentStyle.fontSize]])]),n("div",Oa,[e[156]||(e[156]=n("label",null,"字体:",-1)),k(n("select",{"onUpdate:modelValue":e[62]||(e[62]=t=>r.currentStyle.fontFamily=t),onChange:ue},e[155]||(e[155]=[n("option",{value:"Arial"},"Arial",-1),n("option",{value:"Times New Roman"},"Times New Roman",-1),n("option",{value:"Microsoft YaHei"},"微软雅黑",-1),n("option",{value:"SimSun"},"宋体",-1)]),544),[[Le,r.currentStyle.fontFamily]])]),n("div",Za,[e[157]||(e[157]=n("label",null,"文字颜色:",-1)),k(n("input",{type:"color","onUpdate:modelValue":e[63]||(e[63]=t=>r.currentStyle.color=t),onChange:ue},null,544),[[O,r.currentStyle.color]])]),n("div",Ua,[e[158]||(e[158]=n("label",null,"背景颜色:",-1)),k(n("input",{type:"color","onUpdate:modelValue":e[64]||(e[64]=t=>r.currentStyle.backgroundColor=t),onChange:ue},null,544),[[O,r.currentStyle.backgroundColor]])]),n("div",Wa,[e[159]||(e[159]=n("label",null,"边框颜色:",-1)),k(n("input",{type:"color","onUpdate:modelValue":e[65]||(e[65]=t=>r.currentStyle.borderColor=t),onChange:ue},null,544),[[O,r.currentStyle.borderColor]])]),n("div",Ya,[e[160]||(e[160]=n("label",null,"边框宽度:",-1)),k(n("input",{type:"number","onUpdate:modelValue":e[66]||(e[66]=t=>r.currentStyle.borderWidth=t),min:"0",max:"5",onChange:ue},null,544),[[O,r.currentStyle.borderWidth]])]),n("div",Ha,[e[161]||(e[161]=n("label",null,"圆角:",-1)),k(n("input",{type:"number","onUpdate:modelValue":e[67]||(e[67]=t=>r.currentStyle.borderRadius=t),min:"0",max:"20",onChange:ue},null,544),[[O,r.currentStyle.borderRadius]])]),n("div",Xa,[n("label",null,[k(n("input",{type:"checkbox","onUpdate:modelValue":e[68]||(e[68]=t=>r.currentStyle.shadow=t),onChange:ue},null,544),[[G,r.currentStyle.shadow]]),e[162]||(e[162]=z(" 阴影效果 ",-1))])])]),n("div",{class:"annotation-section"},[e[164]||(e[164]=n("h5",null,"操作",-1)),n("div",{class:"control-item"},[n("button",{onClick:St,class:"annotation-btn"},"生成自动标注")]),n("div",{class:"control-item"},[n("button",{onClick:zt,class:"annotation-btn annotation-btn-danger"},"清除所有标注")])])])],512)):f("",!0)])]))}},Ja=Uo(qa,[["__scopeId","data-v-5094e410"]]);export{Ja as default};
